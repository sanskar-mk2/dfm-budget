import{b as o,g as n,p as C,c as V,f as l,h as c,F as k,j as q,t as u,e as d,d as v,r as H,q as T,w as S,s as A,v as N,x as F,y as _,k as D}from"./index-BwlVtp6Q.js";const E=["value"],p={__name:"BudgetInput",props:{value:{type:[String,Number],default:0},cellClass:{type:String,default:""}},emits:["change","blur","input"],setup(t){return($,y)=>(n(),o("input",{type:"number",value:t.value,onInput:y[0]||(y[0]=B=>$.$emit("change",B)),onBlur:y[1]||(y[1]=B=>$.$emit("blur",B)),onKeypress:y[2]||(y[2]=B=>$.$emit("input",B)),class:C(["input input-sm w-24 text-right border-2 transition-all duration-200 focus:border-blue-400 focus:ring-2 focus:ring-blue-200",t.cellClass]),step:"0.01",placeholder:"0.00"},null,42,E))}},g=t=>!t&&t!==0?"0":parseFloat(t).toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:0}),w=t=>!t&&t!==0?"0.00":parseFloat(t).toFixed(2),z={class:"overflow-x-auto"},O={class:"table-md table table-zebra w-full"},U={key:0},j={key:1},L={key:2},M={key:3},P={key:4},R={key:0},Z={key:0},K={key:1},G={key:2},J={key:3},W={class:"text-right"},X={class:"text-right"},Y={class:"text-right"},tt={class:"text-right"},et={class:"text-right font-semibold"},lt={key:4,class:"text-right"},st={key:1,class:"bg-blue-50 border-t-2 border-b-4 border-primary"},at={colspan:"3",class:"font-bold text-primary text-center"},ot={class:"text-right font-bold text-primary"},nt={class:"text-right font-bold text-primary"},ut={class:"text-right font-bold text-primary"},rt={class:"text-right font-bold text-primary"},dt={class:"text-right font-bold text-primary"},it={key:0,class:"text-right font-bold text-primary"},ct={class:"text-right font-bold text-primary"},gt={class:"text-right font-bold text-primary"},ht={class:"text-right font-bold text-primary"},yt={class:"text-right font-bold text-primary"},bt=["onClick"],ft={key:0},mt={key:1},Bt={key:2},xt={key:3},Ct={key:4,class:"text-right"},$t={class:"bg-gray-100 border-t-4 border-gray-400"},vt={key:0,class:"font-bold text-lg"},pt={key:1},kt={key:2,class:"font-bold text-lg"},qt={key:3},Ft={class:"text-right font-bold text-lg"},_t={class:"text-right font-bold text-lg"},Ht={class:"text-right font-bold text-lg"},It={class:"text-right font-bold text-lg"},Tt={class:"text-right font-bold text-lg"},wt={key:4,class:"text-right font-bold text-lg"},Qt={class:"text-right font-bold text-lg"},Vt={class:"text-right font-bold text-lg"},St={class:"text-right font-bold text-lg"},At={class:"text-right font-bold text-lg"},ce={__name:"SalesTable",props:{sales:{type:Array,required:!0},customBudgets:{type:Array,default:()=>[]},getBudgetValue:{type:Function,required:!0},getCellClass:{type:Function,required:!0},handleBudgetChange:{type:Function,required:!0},handleBudgetBlur:{type:Function,required:!0},handleBudgetInput:{type:Function,required:!0},handleDeleteCustomBudget:{type:Function,required:!0},isHospitality:{type:Boolean,required:!0},getTotalQ1:{type:Function,required:!0},getTotalQ2:{type:Function,required:!0},getTotalQ3:{type:Function,required:!0},getTotalQ4:{type:Function,required:!0},getTotalSales:{type:Function,required:!0},getTotalZeroPercent:{type:Function,required:!0},getZeroPercentRate:{type:Function,required:!0},getTotalQ1Budget:{type:Function,required:!1},getTotalQ2Budget:{type:Function,required:!1},getTotalQ3Budget:{type:Function,required:!1},getTotalQ4Budget:{type:Function,required:!1},getTotalBudget:{type:Function,required:!1}},setup(t){const $=t,y=V(()=>{const B={},a=[];$.sales.forEach(s=>{const r=$.isHospitality?s.brand||"Unknown Brand":s.derived_customer_class||"Unknown Class";B[r]||(B[r]=[],a.push(r)),B[r].push(s)});const e=[];return a.forEach(s=>{const r=B[s];r.forEach(h=>{e.push({...h,isSubtotal:!1})});const i={isSubtotal:!0,groupKey:s,q1_sales:r.reduce((h,f)=>h+(parseFloat(f.q1_sales)||0),0),q2_sales:r.reduce((h,f)=>h+(parseFloat(f.q2_sales)||0),0),q3_sales:r.reduce((h,f)=>h+(parseFloat(f.q3_sales)||0),0),q4_sales:r.reduce((h,f)=>h+(parseFloat(f.q4_sales)||0),0),zero_perc_sales_total:r.reduce((h,f)=>h+(parseFloat(f.zero_perc_sales_total)||0),0),total_sales:r.reduce((h,f)=>h+(parseFloat(f.total_sales)||0),0),zero_perc_sales_percent:0,q1_budget:r.reduce((h,f)=>h+(parseFloat($.getBudgetValue(f,1))||0),0),q2_budget:r.reduce((h,f)=>h+(parseFloat($.getBudgetValue(f,2))||0),0),q3_budget:r.reduce((h,f)=>h+(parseFloat($.getBudgetValue(f,3))||0),0),q4_budget:r.reduce((h,f)=>h+(parseFloat($.getBudgetValue(f,4))||0),0)};i.zero_perc_sales_percent=i.total_sales>0?i.zero_perc_sales_total/i.total_sales*100:0,e.push(i)}),e});return(B,a)=>(n(),o("div",z,[l("table",O,[l("thead",null,[l("tr",null,[a[0]||(a[0]=l("th",null,null,-1)),t.isHospitality?(n(),o("th",U,"Brand")):c("",!0),t.isHospitality?(n(),o("th",j,"Flag")):c("",!0),t.isHospitality?c("",!0):(n(),o("th",L,"Customer Class")),t.isHospitality?c("",!0):(n(),o("th",M,"Customer Name")),a[1]||(a[1]=l("th",null,"Q1 Sales",-1)),a[2]||(a[2]=l("th",null,"Q2 Sales",-1)),a[3]||(a[3]=l("th",null,"Q3 Sales",-1)),a[4]||(a[4]=l("th",null,"Q4 Orders",-1)),a[5]||(a[5]=l("th",null,"Total Sales",-1)),t.isHospitality?(n(),o("th",P,"0% Sales (Rate)")):c("",!0),a[6]||(a[6]=l("th",null,"Budget Q1",-1)),a[7]||(a[7]=l("th",null,"Budget Q2",-1)),a[8]||(a[8]=l("th",null,"Budget Q3",-1)),a[9]||(a[9]=l("th",null,"Budget Q4",-1))])]),l("tbody",null,[(n(!0),o(k,null,q(y.value,e=>(n(),o(k,{key:e.isSubtotal?`subtotal-${e.groupKey}`:`${e.customer_name}-${e.brand||"null"}-${e.flag||"null"}`},[e.isSubtotal?(n(),o("tr",st,[l("td",at,u(e.groupKey)+" Total ",1),l("td",ot," $"+u(d(g)(e.q1_sales)),1),l("td",nt," $"+u(d(g)(e.q2_sales)),1),l("td",ut," $"+u(d(g)(e.q3_sales)),1),l("td",rt," $"+u(d(g)(e.q4_sales)),1),l("td",dt," $"+u(d(g)(e.total_sales)),1),t.isHospitality?(n(),o("td",it," $"+u(d(g)(e.zero_perc_sales_total))+" ("+u(d(w)(e.zero_perc_sales_percent))+"%) ",1)):c("",!0),l("td",ct," $"+u(d(g)(e.q1_budget)),1),l("td",gt," $"+u(d(g)(e.q2_budget)),1),l("td",ht," $"+u(d(g)(e.q3_budget)),1),l("td",yt," $"+u(d(g)(e.q4_budget)),1)])):(n(),o("tr",R,[a[10]||(a[10]=l("td",null,null,-1)),t.isHospitality?(n(),o("td",Z,u(e.brand||"N/A"),1)):c("",!0),t.isHospitality?(n(),o("td",K,u(e.flag||"N/A"),1)):c("",!0),t.isHospitality?c("",!0):(n(),o("td",G,u(e.derived_customer_class||"N/A"),1)),t.isHospitality?c("",!0):(n(),o("td",J,u(e.customer_name||"N/A"),1)),l("td",W," $"+u(d(g)(e.q1_sales)),1),l("td",X," $"+u(d(g)(e.q2_sales)),1),l("td",Y," $"+u(d(g)(e.q3_sales)),1),l("td",tt," $"+u(d(g)(e.q4_sales)),1),l("td",et," $"+u(d(g)(e.total_sales)),1),t.isHospitality?(n(),o("td",lt," $"+u(d(g)(e.zero_perc_sales_total))+" ("+u(d(w)(e.zero_perc_sales_percent))+"%) ",1)):c("",!0),l("td",{class:C(t.getCellClass(e,1))},[v(p,{value:t.getBudgetValue(e,1),"cell-class":t.getCellClass(e,1),onChange:s=>t.handleBudgetChange(s,e,1),onBlur:s=>t.handleBudgetBlur(s,e,1),onInput:s=>t.handleBudgetInput(s,e,1)},null,8,["value","cell-class","onChange","onBlur","onInput"])],2),l("td",{class:C(t.getCellClass(e,2))},[v(p,{value:t.getBudgetValue(e,2),"cell-class":t.getCellClass(e,2),onChange:s=>t.handleBudgetChange(s,e,2),onBlur:s=>t.handleBudgetBlur(s,e,2),onInput:s=>t.handleBudgetInput(s,e,2)},null,8,["value","cell-class","onChange","onBlur","onInput"])],2),l("td",{class:C(t.getCellClass(e,3))},[v(p,{value:t.getBudgetValue(e,3),"cell-class":t.getCellClass(e,3),onChange:s=>t.handleBudgetChange(s,e,3),onBlur:s=>t.handleBudgetBlur(s,e,3),onInput:s=>t.handleBudgetInput(s,e,3)},null,8,["value","cell-class","onChange","onBlur","onInput"])],2),l("td",{class:C(t.getCellClass(e,4))},[v(p,{value:t.getBudgetValue(e,4),"cell-class":t.getCellClass(e,4),onChange:s=>t.handleBudgetChange(s,e,4),onBlur:s=>t.handleBudgetBlur(s,e,4),onInput:s=>t.handleBudgetInput(s,e,4)},null,8,["value","cell-class","onChange","onBlur","onInput"])],2)]))],64))),128)),(n(!0),o(k,null,q(t.customBudgets,e=>(n(),o("tr",{key:`custom-${e.id}`,class:"bg-amber-50/30"},[l("td",null,[l("button",{onClick:s=>t.handleDeleteCustomBudget(e.id),class:"btn btn-ghost btn-xs text-error hover:bg-error hover:text-error-content",title:"Delete custom budget"},[...a[11]||(a[11]=[l("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,bt)]),t.isHospitality?(n(),o("td",ft,u(e.brand||"N/A"),1)):c("",!0),t.isHospitality?(n(),o("td",mt,u(e.flag||"N/A"),1)):c("",!0),t.isHospitality?c("",!0):(n(),o("td",Bt,u(e.customer_class||"N/A"),1)),t.isHospitality?c("",!0):(n(),o("td",xt,u(e.customer_name||"N/A"),1)),a[12]||(a[12]=l("td",{class:"text-right"},"$0.00",-1)),a[13]||(a[13]=l("td",{class:"text-right"},"$0.00",-1)),a[14]||(a[14]=l("td",{class:"text-right"},"$0.00",-1)),a[15]||(a[15]=l("td",{class:"text-right"},"$0.00",-1)),a[16]||(a[16]=l("td",{class:"text-right font-semibold"},"$0.00",-1)),t.isHospitality?(n(),o("td",Ct," $0.00 (0.00%) ")):c("",!0),l("td",{class:C(t.getCellClass(e,1))},[v(p,{value:t.getBudgetValue(e,1),"cell-class":t.getCellClass(e,1),onChange:s=>t.handleBudgetChange(s,e,1),onBlur:s=>t.handleBudgetBlur(s,e,1),onInput:s=>t.handleBudgetInput(s,e,1)},null,8,["value","cell-class","onChange","onBlur","onInput"])],2),l("td",{class:C(t.getCellClass(e,2))},[v(p,{value:t.getBudgetValue(e,2),"cell-class":t.getCellClass(e,2),onChange:s=>t.handleBudgetChange(s,e,2),onBlur:s=>t.handleBudgetBlur(s,e,2),onInput:s=>t.handleBudgetInput(s,e,2)},null,8,["value","cell-class","onChange","onBlur","onInput"])],2),l("td",{class:C(t.getCellClass(e,3))},[v(p,{value:t.getBudgetValue(e,3),"cell-class":t.getCellClass(e,3),onChange:s=>t.handleBudgetChange(s,e,3),onBlur:s=>t.handleBudgetBlur(s,e,3),onInput:s=>t.handleBudgetInput(s,e,3)},null,8,["value","cell-class","onChange","onBlur","onInput"])],2),l("td",{class:C(t.getCellClass(e,4))},[v(p,{value:t.getBudgetValue(e,4),"cell-class":t.getCellClass(e,4),onChange:s=>t.handleBudgetChange(s,e,4),onBlur:s=>t.handleBudgetBlur(s,e,4),onInput:s=>t.handleBudgetInput(s,e,4)},null,8,["value","cell-class","onChange","onBlur","onInput"])],2)]))),128)),l("tr",$t,[a[17]||(a[17]=l("td",null,null,-1)),t.isHospitality?(n(),o("td",vt," TOTAL ")):c("",!0),t.isHospitality?(n(),o("td",pt)):c("",!0),t.isHospitality?c("",!0):(n(),o("td",kt," TOTAL ")),t.isHospitality?c("",!0):(n(),o("td",qt)),l("td",Ft," $"+u(d(g)(t.getTotalQ1())),1),l("td",_t," $"+u(d(g)(t.getTotalQ2())),1),l("td",Ht," $"+u(d(g)(t.getTotalQ3())),1),l("td",It," $"+u(d(g)(t.getTotalQ4())),1),l("td",Tt," $"+u(d(g)(t.getTotalSales())),1),t.isHospitality?(n(),o("td",wt," $"+u(d(g)(t.getTotalZeroPercent()))+" ("+u(t.getZeroPercentRate().toFixed(2))+"%) ",1)):c("",!0),l("td",Qt," $"+u(d(g)(t.getTotalQ1Budget())),1),l("td",Vt," $"+u(d(g)(t.getTotalQ2Budget())),1),l("td",St," $"+u(d(g)(t.getTotalQ3Budget())),1),l("td",At," $"+u(d(g)(t.getTotalQ4Budget())),1)])])])]))}},Nt={key:0,class:"modal modal-open"},Dt={class:"modal-box w-11/12 max-w-2xl"},Et={key:0,class:"space-y-4"},zt={class:"form-control"},Ot={id:"customer-classes"},Ut=["value"],jt={key:0,class:"label"},Lt={class:"label-text-alt text-error"},Mt={class:"form-control"},Pt={id:"customer-names"},Rt=["value"],Zt={key:0,class:"label"},Kt={class:"label-text-alt text-error"},Gt={key:1,class:"space-y-4"},Jt={class:"form-control"},Wt={id:"brands"},Xt=["value"],Yt={key:0,class:"label"},te={class:"label-text-alt text-error"},ee={class:"form-control"},le={id:"flags"},se=["value"],ae={key:0,class:"label"},oe={class:"label-text-alt text-error"},ne={class:"modal-action"},ue=["disabled"],re=["disabled"],de={key:0,class:"loading loading-spinner loading-sm"},ge={__name:"AddCustomBudgetModal",props:{isOpen:{type:Boolean,default:!1},isHospitality:{type:Boolean,default:!1},autosuggestData:{type:Object,default:()=>({customer_classes:[],customer_names:[],brands:[],flags:[]})}},emits:["close","created","fetch-autosuggest"],setup(t,{emit:$}){const y=t,B=$,a=H(!1),e=H(null),s=H(null),r=T({customer_name:"",customer_class:"",brand:"",flag:""}),i=T({customer_name:"",customer_class:"",brand:"",flag:""}),h=()=>{Object.keys(i).forEach(b=>i[b]="");let x=!0;return y.isHospitality?(r.brand.trim()||(i.brand="Brand is required",x=!1),r.flag.trim()||(i.flag="Flag is required",x=!1)):(r.customer_name.trim()||(i.customer_name="Customer name is required",x=!1),r.customer_class.trim()||(i.customer_class="Customer class is required",x=!1)),x},f=async()=>{if(console.log("handleSubmit called",{isHospitality:y.isHospitality,form:{...r}}),!h()){console.log("Form validation failed",i);return}console.log("Form validation passed, proceeding with submission"),a.value=!0;try{const x={customer_name:y.isHospitality?null:r.customer_name,customer_class:y.isHospitality?"Hospitality":r.customer_class,brand:y.isHospitality?r.brand.toUpperCase():null,flag:y.isHospitality?r.flag.toUpperCase():null,is_custom:!0};console.log("Emitting budget data:",x),B("created",x),I(),B("close")}catch(x){console.error("Error creating custom budget:",x)}finally{a.value=!1}},Q=()=>{I(),B("close")},I=()=>{r.customer_name="",r.customer_class="",r.brand="",r.flag="",Object.keys(i).forEach(x=>i[x]="")};return S(()=>y.isOpen,async x=>{x&&(B("fetch-autosuggest"),await A(),y.isHospitality&&s.value?s.value.focus():!y.isHospitality&&e.value&&e.value.focus())}),(x,b)=>t.isOpen?(n(),o("div",Nt,[l("div",Dt,[b[9]||(b[9]=l("h3",{class:"font-bold text-lg mb-4"},"Add Custom Row",-1)),l("form",{onSubmit:N(f,["prevent"]),class:"space-y-4"},[t.isHospitality?(n(),o("div",Gt,[l("div",Jt,[b[6]||(b[6]=l("label",{class:"label"},[l("span",{class:"label-text"},"Brand")],-1)),F(l("input",{ref_key:"brandInput",ref:s,"onUpdate:modelValue":b[2]||(b[2]=m=>r.brand=m),type:"text",list:"brands",placeholder:"Enter or select brand",class:C(["input input-bordered w-full",{"input-error":i.brand}]),required:""},null,2),[[_,r.brand]]),l("datalist",Wt,[(n(!0),o(k,null,q(y.autosuggestData.brands,m=>(n(),o("option",{key:m,value:m},null,8,Xt))),128))]),i.brand?(n(),o("label",Yt,[l("span",te,u(i.brand),1)])):c("",!0)]),l("div",ee,[b[7]||(b[7]=l("label",{class:"label"},[l("span",{class:"label-text"},"Flag")],-1)),F(l("input",{"onUpdate:modelValue":b[3]||(b[3]=m=>r.flag=m),type:"text",list:"flags",placeholder:"Enter or select flag",class:C(["input input-bordered w-full",{"input-error":i.flag}]),required:""},null,2),[[_,r.flag]]),l("datalist",le,[(n(!0),o(k,null,q(y.autosuggestData.flags,m=>(n(),o("option",{key:m,value:m},null,8,se))),128))]),i.flag?(n(),o("label",ae,[l("span",oe,u(i.flag),1)])):c("",!0)]),b[8]||(b[8]=l("div",{class:"form-control hidden"},[l("label",{class:"label"},[l("span",{class:"label-text"},"Customer Class")]),l("input",{type:"text",value:"Hospitality",class:"input input-bordered w-full input-disabled",disabled:""})],-1))])):(n(),o("div",Et,[l("div",zt,[b[4]||(b[4]=l("label",{class:"label"},[l("span",{class:"label-text"},"Customer Class")],-1)),F(l("input",{"onUpdate:modelValue":b[0]||(b[0]=m=>r.customer_class=m),type:"text",list:"customer-classes",placeholder:"Enter or select customer class",class:C(["input input-bordered w-full",{"input-error":i.customer_class}]),required:""},null,2),[[_,r.customer_class]]),l("datalist",Ot,[(n(!0),o(k,null,q(y.autosuggestData.customer_classes,m=>(n(),o("option",{key:m,value:m},null,8,Ut))),128))]),i.customer_class?(n(),o("label",jt,[l("span",Lt,u(i.customer_class),1)])):c("",!0)]),l("div",Mt,[b[5]||(b[5]=l("label",{class:"label"},[l("span",{class:"label-text"},"Customer Name")],-1)),F(l("input",{ref_key:"customerNameInput",ref:e,"onUpdate:modelValue":b[1]||(b[1]=m=>r.customer_name=m),type:"text",list:"customer-names",placeholder:"Enter or select customer name",class:C(["input input-bordered w-full",{"input-error":i.customer_name}]),required:""},null,2),[[_,r.customer_name]]),l("datalist",Pt,[(n(!0),o(k,null,q(y.autosuggestData.customer_names,m=>(n(),o("option",{key:m,value:m},null,8,Rt))),128))]),i.customer_name?(n(),o("label",Zt,[l("span",Kt,u(i.customer_name),1)])):c("",!0)])])),l("div",ne,[l("button",{type:"button",onClick:Q,class:"btn btn-ghost",disabled:a.value}," Cancel ",8,ue),l("button",{type:"submit",class:"btn btn-primary",disabled:a.value},[a.value?(n(),o("span",de)):c("",!0),D(" "+u(a.value?"Creating...":"Add Budget"),1)],8,re)])],32)])])):c("",!0)}};export{ce as _,ge as a};
