import{_ as R,a as B,e,t as r,c as f,g as F,b as N,F as rt,h as nt,j as V,u as it,r as H,d as I,k as W,l as Z,i as K,o as J,f as X}from"./index-5HnzLnCl.js";import{L as dt}from"./LoadingError-CcIY0GoQ.js";const _t={__name:"AdminStats",props:{summaryData:{type:Array,required:!0,default:()=>[]}},setup(d,{expose:n}){n();const a=d,t=f(()=>a.summaryData.reduce((w,k)=>w+k.total_sales,0)),c=f(()=>a.summaryData.reduce((w,k)=>w+k.total_budget,0)),b=f(()=>t.value===0?0:(c.value-t.value)/t.value*100),q={props:a,totalSales:t,totalBudget:c,totalGrowthPercent:b,formatNumber:w=>new Intl.NumberFormat("en-US",{minimumFractionDigits:0,maximumFractionDigits:0}).format(w||0),computed:f};return Object.defineProperty(q,"__isScriptSetup",{enumerable:!1,value:!0}),q}},ut={class:"grid sm:grid-cols-2 lg:grid-cols-4 gap-4"},ct={class:"stat bg-base-100 shadow rounded-xl"},bt={class:"stat-value text-primary"},mt={class:"stat bg-base-100 shadow rounded-xl"},ht={class:"stat-value text-primary"},gt={class:"stat bg-base-100 shadow rounded-xl"},ft={class:"stat-value text-primary"},yt={class:"stat bg-base-100 shadow rounded-xl"},pt={class:"stat-value text-primary"};function qt(d,n,a,t,c,b){return F(),B("div",ut,[e("div",ct,[n[0]||(n[0]=e("div",{class:"stat-title"},"Total Salespeople",-1)),e("div",bt,r(a.summaryData.length),1)]),e("div",mt,[n[1]||(n[1]=e("div",{class:"stat-title"},"Total Sales",-1)),e("div",ht," $"+r(t.formatNumber(t.totalSales)),1)]),e("div",gt,[n[2]||(n[2]=e("div",{class:"stat-title"},"Total Budget",-1)),e("div",ft," $"+r(t.formatNumber(t.totalBudget)),1)]),e("div",yt,[n[3]||(n[3]=e("div",{class:"stat-title"},"Growth",-1)),e("div",pt,r(t.totalGrowthPercent.toFixed(2))+"% ",1)])])}const vt=R(_t,[["render",qt],["__file","G:/ProjectsPARA/Projects/budget-2026/frontend/src/components/AdminStats.vue"]]),St={__name:"SalespersonTable",props:{data:{type:Array,required:!0,default:()=>[]},subtotals:{type:Object,required:!0},title:{type:String,required:!0},type:{type:String,required:!0,validator:d=>["hospitality","non-hospitality"].includes(d)}},emits:["view-salesperson","download-salesperson"],setup(d,{expose:n,emit:a}){n();const l={props:d,emit:a,formatNumber:q=>new Intl.NumberFormat("en-US",{minimumFractionDigits:0,maximumFractionDigits:0}).format(q||0),computed:f};return Object.defineProperty(l,"__isScriptSetup",{enumerable:!1,value:!0}),l}},xt={key:0,class:"mt-10 bg-base-100 shadow-md rounded-xl"},wt={class:"text-lg px-6 py-3 bg-primary text-primary-content rounded-t-xl"},Nt={class:"overflow-x-auto rounded-xl"},kt={class:"table table-zebra text-sm"},Ft={class:"join"},Dt=["onClick"],Bt=["onClick"],At={class:"text-xs opacity-70"},jt={class:"text-right"},Ct={class:"text-right"},zt={class:"text-right"},Pt={class:"text-right"},Tt={class:"text-right"},Vt={class:"text-right font-bold"},Ht={class:"text-right"},Rt={class:"text-xs opacity-60"},Qt={class:"text-right"},Lt={class:"text-right"},Mt={class:"text-right"},Ot={class:"text-right"},Gt={class:"text-right"},Et={class:"text-right font-bold"},Ut={class:"text-right"},It={class:"font-bold bg-secondary text-secondary-content [&:nth-child(even)]:bg-secondary [&:nth-child(odd)]:bg-secondary"},Wt={class:"text-right"},Zt={class:"text-right"},Kt={class:"text-right"},Jt={class:"text-right"},Xt={class:"text-right"},Yt={class:"text-right"},$t={class:"text-right"},te={class:"text-xs opacity-70"},ee={class:"text-right"},se={class:"text-right"},ae={class:"text-right"},oe={class:"text-right"},le={class:"text-right"},re={class:"text-right"},ne={class:"text-right"};function ie(d,n,a,t,c,b){return a.data.length?(F(),B("div",xt,[e("h2",wt,r(a.title)+" ("+r(a.data.length)+") ",1),e("div",Nt,[e("table",kt,[n[1]||(n[1]=e("thead",null,[e("tr",null,[e("th"),e("th",null,"Salesperson"),e("th",null,"Q1 Sales"),e("th",null,"Q2 Sales"),e("th",null,"Q3 Sales"),e("th",null,"Q4 Sales"),e("th",null,"Q4 Orders"),e("th",null,"Total Sales"),e("th",null,"0% Sales (Rate)"),e("th",null,"2026 Open"),e("th",null,"Q1 Budget"),e("th",null,"Q2 Budget"),e("th",null,"Q3 Budget"),e("th",null,"Q4 Budget"),e("th",null,"Total Budget"),e("th",null,"Growth")])],-1)),e("tbody",null,[(F(!0),B(rt,null,nt(a.data,l=>(F(),B("tr",{key:l.salesperson_id,class:"hover"},[e("td",null,[e("div",Ft,[e("button",{onClick:q=>t.emit("view-salesperson",l.salesperson_id),class:"btn btn-xs btn-ghost join-item",title:"View"}," ðŸ‘ï¸ ",8,Dt),e("button",{onClick:q=>t.emit("download-salesperson",l.salesperson_id,l.salesperson_name),class:"btn btn-xs btn-ghost join-item",title:"Download"}," â¬‡ï¸ ",8,Bt)])]),e("td",null,[V(r(l.salesperson_name)+" ",1),e("div",At," ID: "+r(l.salesperson_id),1)]),e("td",jt," $"+r(t.formatNumber(l.q1_sales)),1),e("td",Ct," $"+r(t.formatNumber(l.q2_sales)),1),e("td",zt," $"+r(t.formatNumber(l.q3_sales)),1),e("td",Pt," $"+r(t.formatNumber(l.q4_sales)),1),e("td",Tt," $"+r(t.formatNumber(l.q4_orders)),1),e("td",Vt," $"+r(t.formatNumber(l.total_sales)),1),e("td",Ht,[V(" $"+r(t.formatNumber(l.zero_perc_sales))+" ",1),e("div",Rt," ("+r(l.zero_perc_sales_percent.toFixed(2))+"%) ",1)]),e("td",Qt," $"+r(t.formatNumber(l.open_2026)),1),e("td",Lt," $"+r(t.formatNumber(l.q1_budget)),1),e("td",Mt," $"+r(t.formatNumber(l.q2_budget)),1),e("td",Ot," $"+r(t.formatNumber(l.q3_budget)),1),e("td",Gt," $"+r(t.formatNumber(l.q4_budget)),1),e("td",Et," $"+r(t.formatNumber(l.total_budget)),1),e("td",Ut,r(l.total_sales!==0?((l.total_budget-l.total_sales)/l.total_sales*100).toFixed(2):"0.00")+"% ",1)]))),128)),N(" Subtotal "),e("tr",It,[n[0]||(n[0]=e("td",{colspan:"2",class:"text-center"},"Subtotal",-1)),e("td",Wt," $"+r(t.formatNumber(a.subtotals.q1_sales)),1),e("td",Zt," $"+r(t.formatNumber(a.subtotals.q2_sales)),1),e("td",Kt," $"+r(t.formatNumber(a.subtotals.q3_sales)),1),e("td",Jt," $"+r(t.formatNumber(a.subtotals.q4_sales)),1),e("td",Xt," $"+r(t.formatNumber(a.subtotals.q4_orders)),1),e("td",Yt," $"+r(t.formatNumber(a.subtotals.total_sales)),1),e("td",$t,[V(" $"+r(t.formatNumber(a.subtotals.zero_perc_sales))+" ",1),e("div",te," ("+r(a.subtotals.zero_perc_sales_percent.toFixed(2))+"%) ",1)]),e("td",ee," $"+r(t.formatNumber(a.subtotals.open_2026)),1),e("td",se," $"+r(t.formatNumber(a.subtotals.q1_budget)),1),e("td",ae," $"+r(t.formatNumber(a.subtotals.q2_budget)),1),e("td",oe," $"+r(t.formatNumber(a.subtotals.q3_budget)),1),e("td",le," $"+r(t.formatNumber(a.subtotals.q4_budget)),1),e("td",re," $"+r(t.formatNumber(a.subtotals.total_budget)),1),e("td",ne,r(a.subtotals.total_sales!==0?((a.subtotals.total_budget-a.subtotals.total_sales)/a.subtotals.total_sales*100).toFixed(2):"0.00")+"% ",1)])])])])])):N("v-if",!0)}const de=R(St,[["render",ie],["__file","G:/ProjectsPARA/Projects/budget-2026/frontend/src/components/SalespersonTable.vue"]]);function _e(d,n){if(!d||d.length===0)return"";const a=n.map(c=>`"${c.label}"`).join(","),t=d.map(c=>n.map(b=>{const l=c[b.key];return l==null?'""':`"${String(l).replace(/"/g,'""')}"`}).join(","));return[a,...t].join(`
`)}function Y(d,n,a){const t=_e(d,n),c=new Blob([t],{type:"text/csv;charset=utf-8;"}),b=document.createElement("a");if(b.download!==void 0){const l=URL.createObjectURL(c);b.setAttribute("href",l),b.setAttribute("download",a),b.style.visibility="hidden",document.body.appendChild(b),b.click(),document.body.removeChild(b),URL.revokeObjectURL(l)}}function h(d){return d==null||isNaN(d)?"0.00":parseFloat(d).toFixed(2)}function $(d,n=!1){const a=[{key:"salesperson_name",label:"Salesperson Name"},{key:"salesperson_id",label:"Salesperson ID"},{key:"role",label:"Role"}];return n?a.push({key:"brand",label:"Brand"},{key:"flag",label:"Flag"},{key:"derived_customer_class",label:"Customer Class"},{key:"customer_name",label:"Customer Name"}):d?a.push({key:"brand",label:"Brand"},{key:"flag",label:"Flag"}):a.push({key:"derived_customer_class",label:"Customer Class"},{key:"customer_name",label:"Customer Name"}),a.push({key:"q1_sales",label:"Q1 Sales"},{key:"q2_sales",label:"Q2 Sales"},{key:"q3_sales",label:"Q3 Sales"},{key:"q4_sales",label:"Q4 Sales"},{key:"q4_orders",label:"Q4 Orders"},{key:"total_sales",label:"Total Sales"},{key:"zero_perc_sales_total",label:"Zero % Sales"},{key:"zero_perc_sales_percent",label:"Zero % %"},{key:"open_2026",label:"2026 Open"},{key:"q1_budget",label:"Q1 Budget"},{key:"q2_budget",label:"Q2 Budget"},{key:"q3_budget",label:"Q3 Budget"},{key:"q4_budget",label:"Q4 Budget"},{key:"growth_percent",label:"Growth"}),a}function tt(){const d=it(),n=H(!1),a=H(null),t=H([]),c=f(()=>t.value.reduce((s,o)=>s+o.total_sales,0)),b=f(()=>t.value.reduce((s,o)=>s+o.total_budget,0)),l=f(()=>c.value===0?0:(b.value-c.value)/c.value*100),q=f(()=>t.value.filter(s=>s.role&&s.role.toLowerCase().startsWith("hospitality"))),w=f(()=>t.value.filter(s=>!s.role||!s.role.toLowerCase().startsWith("hospitality")));function k(s){if(!s.length)return{q1_sales:0,q2_sales:0,q3_sales:0,q4_sales:0,q4_orders:0,total_sales:0,zero_perc_sales:0,zero_perc_sales_percent:0,open_2026:0,q1_budget:0,q2_budget:0,q3_budget:0,q4_budget:0,total_budget:0,growth_percent:0};const o=s.reduce((i,_)=>(i.q1_sales+=_.q1_sales,i.q2_sales+=_.q2_sales,i.q3_sales+=_.q3_sales,i.q4_sales+=_.q4_sales,i.q4_orders+=_.q4_orders,i.zero_perc_sales+=_.zero_perc_sales,i.open_2026+=_.open_2026,i.q1_budget+=_.q1_budget,i.q2_budget+=_.q2_budget,i.q3_budget+=_.q3_budget,i.q4_budget+=_.q4_budget,i),{q1_sales:0,q2_sales:0,q3_sales:0,q4_sales:0,q4_orders:0,zero_perc_sales:0,open_2026:0,q1_budget:0,q2_budget:0,q3_budget:0,q4_budget:0});return o.total_sales=o.q1_sales+o.q2_sales+o.q3_sales+o.q4_sales+o.q4_orders,o.total_budget=o.q1_budget+o.q2_budget+o.q3_budget+o.q4_budget,o.growth_percent=o.total_sales!==0?(o.total_budget-o.total_sales)/o.total_sales*100:0,o.zero_perc_sales_percent=o.total_sales?o.zero_perc_sales/o.total_sales*100:0,o}const P=f(()=>k(q.value)),A=f(()=>k(w.value)),T=s=>{if(s==null)return 0;if(typeof s=="number")return s;if(typeof s=="string"){const o=s.replace(/[%$,]/g,"").trim(),i=parseFloat(o);return Number.isNaN(i)?0:i}return 0},g=(s,o)=>{const i=Array.isArray(o)?o:[o];return s.reduce((_,v)=>{for(const y of i)if(v[y]!==void 0&&v[y]!==null){_+=T(v[y]);break}return _},0)},j=(s,o={})=>{if(!s?.length)return null;const i={salesperson_name:"Total",salesperson_id:"",role:"",brand:"",flag:"",derived_customer_class:"",customer_name:""},_=g(s,"q1_sales"),v=g(s,"q2_sales"),y=g(s,"q3_sales"),m=g(s,"q4_sales"),u=g(s,"q4_orders"),S=g(s,"total_sales"),p=_+v+y+m+u,x=S!==0?S:p,D=g(s,["zero_perc_sales_total","zero_perc_sales"]),at=g(s,"open_2026"),Q=g(s,"q1_budget"),L=g(s,"q2_budget"),M=g(s,"q3_budget"),O=g(s,"q4_budget"),G=Q+L+M+O,ot=g(s,"total_budget"),lt=G!==0?G:ot,E=x!==0?D/x*100:0,U=x!==0?((lt||0)-x)/x*100:0;return{...i,...o,q1_sales:h(_),q2_sales:h(v),q3_sales:h(y),q4_sales:h(m),q4_orders:h(u),total_sales:h(x),zero_perc_sales_total:h(D),zero_perc_sales_percent:Number.isFinite(E)?E.toFixed(2):"0.00",open_2026:h(at),q1_budget:h(Q),q2_budget:h(L),q3_budget:h(M),q4_budget:h(O),growth_percent:Number.isFinite(U)?U.toFixed(2):"0.00"}};async function C(){n.value=!0,a.value=null;try{const s=await d.apiCall("/api/admin/summary");if(!s.ok)throw new Error("Failed to fetch admin summary");const o=await s.json();t.value=o.data||[]}catch(s){a.value=s.message,console.error(s)}finally{n.value=!1}}async function z(s){try{const o=await d.apiCall(`/api/sales/${s}`);if(!o.ok)throw new Error("Failed to fetch sales data");const i=await o.json(),_=await d.apiCall(`/api/budget/${s}`);if(!_.ok)throw new Error("Failed to fetch budget data");const v=await _.json(),y=t.value.find(m=>m.salesperson_id===s);return i.data.map(m=>{const u=v.data.find(D=>D.brand===m.brand&&D.flag===m.flag&&D.customer_name===m.customer_name),S=(parseFloat(m.q1_sales)||0)+(parseFloat(m.q2_sales)||0)+(parseFloat(m.q3_sales)||0)+(parseFloat(m.q4_sales)||0)+(parseFloat(m.q4_orders)||0),p=u?(parseFloat(u.quarter_1_sales)||0)+(parseFloat(u.quarter_2_sales)||0)+(parseFloat(u.quarter_3_sales)||0)+(parseFloat(u.quarter_4_sales)||0):0,x=S!==0&&!isNaN(S)&&!isNaN(p)?(p-S)/S*100:0;return{...m,salesperson_id:s,salesperson_name:y?.salesperson_name||"Unknown",role:y?.role||"Unknown",q1_budget:u?h(u.quarter_1_sales):"0.00",q2_budget:u?h(u.quarter_2_sales):"0.00",q3_budget:u?h(u.quarter_3_sales):"0.00",q4_budget:u?h(u.quarter_4_sales):"0.00",open_2026:h(m.open_2026),growth_percent:isNaN(x)?"0.00":x.toFixed(2)}})}catch(o){return console.error(o),[]}}async function et(s,o){const i=await z(s);if(!i.length)return alert("No data available");const v=t.value.find(p=>p.salesperson_id===s)?.role?.toLowerCase().startsWith("hospitality"),y=$(v),m=`${o.replace(/[^a-zA-Z0-9]/g,"_")}_budget_${new Date().toISOString().split("T")[0]}.csv`,u=j(i,{salesperson_name:"Total",role:""}),S=u?[...i,u]:i;Y(S,y,m)}async function st(){if(!t.value.length)return alert("No data available");try{const s=n.value;n.value=!0;const o=[];for(const p of t.value){const x=await z(p.salesperson_id);o.push(...x)}if(!o.length){alert("No data available");return}const i=o.some(p=>p.role?.toLowerCase().startsWith("hospitality")),_=o.some(p=>!p.role?.toLowerCase().startsWith("hospitality")),y=$(i,i&&_),m=`full_budget_sheet_${new Date().toISOString().split("T")[0]}.csv`,u=j(o,{salesperson_name:"Grand Total"}),S=u?[...o,u]:o;Y(S,y,m)}catch(s){console.error("Error downloading full budget sheet:",s),alert("Error downloading budget sheet. Please try again.")}finally{n.value=!1}}return{loading:n,error:a,summaryData:t,totalSales:c,totalBudget:b,totalGrowthPercent:l,hospitalityData:q,nonHospitalityData:w,hospitalitySubtotals:P,nonHospitalitySubtotals:A,fetchAdminSummary:C,downloadSalespersonData:et,downloadFullBudgetSheet:st}}const ue={__name:"AdminView",setup(d,{expose:n}){n();const a=Z(),t=K("navActions"),{loading:c,error:b,summaryData:l,hospitalityData:q,nonHospitalityData:w,hospitalitySubtotals:k,nonHospitalitySubtotals:P,fetchAdminSummary:A,downloadSalespersonData:T,downloadFullBudgetSheet:g}=tt();function j(z){a.push(`/salesperson/${z}`)}J(()=>{A(),t.set([{id:"division-view",text:"Division View",class:"btn btn-secondary mr-2",handler:()=>a.push("/division"),icon:'<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>'},{id:"gross-profit-view",text:"Gross Profit View",class:"btn btn-accent mr-2",handler:()=>a.push("/gross-profit"),icon:'<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"/>'},{id:"download-full-budget",text:"Download Full Budget Sheet",class:"btn btn-primary",disabled:f(()=>c.value||!l.value.length),handler:g,icon:'<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>'}])}),X(()=>t.clear());const C={router:a,navActions:t,loading:c,error:b,summaryData:l,hospitalityData:q,nonHospitalityData:w,hospitalitySubtotals:k,nonHospitalitySubtotals:P,fetchAdminSummary:A,downloadSalespersonData:T,downloadFullBudgetSheet:g,viewSalesperson:j,computed:f,onMounted:J,onUnmounted:X,inject:K,get useRouter(){return Z},AdminStats:vt,LoadingError:dt,SalespersonTable:de,get useAdminData(){return tt}};return Object.defineProperty(C,"__isScriptSetup",{enumerable:!1,value:!0}),C}},ce={class:"p-6 space-y-6"},be={key:0};function me(d,n,a,t,c,b){return F(),B("div",ce,[I(t.LoadingError,{loading:t.loading,error:t.error,onRetry:t.fetchAdminSummary},null,8,["loading","error","onRetry"]),N(" Data "),!t.loading&&!t.error?(F(),B("div",be,[N(" Stats "),I(t.AdminStats,{"summary-data":t.summaryData},null,8,["summary-data"]),N(" Hospitality Table "),t.hospitalityData.length?(F(),W(t.SalespersonTable,{key:0,data:t.hospitalityData,subtotals:t.hospitalitySubtotals,title:"Hospitality Salespeople",type:"hospitality",onViewSalesperson:t.viewSalesperson,onDownloadSalesperson:t.downloadSalespersonData},null,8,["data","subtotals","onDownloadSalesperson"])):N("v-if",!0),N(" Non-Hospitality Table "),t.nonHospitalityData.length?(F(),W(t.SalespersonTable,{key:1,data:t.nonHospitalityData,subtotals:t.nonHospitalitySubtotals,title:"Non-Hospitality Salespeople",type:"non-hospitality",onViewSalesperson:t.viewSalesperson,onDownloadSalesperson:t.downloadSalespersonData},null,8,["data","subtotals","onDownloadSalesperson"])):N("v-if",!0)])):N("v-if",!0)])}const fe=R(ue,[["render",me],["__file","G:/ProjectsPARA/Projects/budget-2026/frontend/src/views/AdminView.vue"]]);export{fe as default};
