import{b as n,g as r,p as B,c as T,r as H,o as Q,a as V,f as s,q as E,h as c,F as _,j as F,t as o,e as d,d as p,s as I,w as N,v as A,x as D,y as w,z as S,k as L}from"./index-Du_i2Gzq.js";const U=["value"],$={__name:"BudgetInput",props:{value:{type:[String,Number],default:0},cellClass:{type:String,default:""}},emits:["change","blur","input"],setup(e){return(v,b)=>(r(),n("input",{type:"number",value:e.value,onInput:b[0]||(b[0]=x=>v.$emit("change",x)),onBlur:b[1]||(b[1]=x=>v.$emit("blur",x)),onKeypress:b[2]||(b[2]=x=>v.$emit("input",x)),class:B(["input input-sm w-24 text-right border-2 transition-all duration-200 focus:border-blue-400 focus:ring-2 focus:ring-blue-200",e.cellClass]),step:"0.01",placeholder:"0.00"},null,42,U))}},i=e=>!e&&e!==0?"0":parseFloat(e).toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:0}),z=e=>!e&&e!==0?"0.00":parseFloat(e).toFixed(2),O={class:"relative"},M={class:"sticky top-0 z-20 bg-base-100 border-b border-gray-200"},R={class:"overflow-x-auto h-4"},j={class:"overflow-x-auto"},P={key:0,class:"sticky left-0 bg-base-100 z-10"},Z={key:1,class:"sticky left-16 bg-base-100 z-10"},K={key:2,class:"sticky left-0 bg-base-100 z-10"},W={key:3,class:"sticky left-32 bg-base-100 z-10"},G={key:4},J={key:0},X={key:0,class:"sticky left-0 bg-base-100 z-10"},Y={key:1,class:"sticky left-16 bg-base-100 z-10"},tt={key:2,class:"sticky left-0 bg-base-100 z-10"},et={key:3,class:"sticky left-32 bg-base-100 z-10"},st={class:"text-right"},lt={class:"text-right"},at={class:"text-right"},ot={class:"text-right"},nt={class:"text-right font-semibold"},rt={key:4,class:"text-right"},ut={key:1,class:"bg-blue-50 border-t-2 border-b-4 border-primary"},dt={colspan:"3",class:"font-bold text-secondary-content text-center sticky left-0 bg-secondary z-10"},it={class:"text-right font-bold text-base-content bg-secondary/50"},ct={class:"text-right font-bold text-base-content bg-secondary/50"},gt={class:"text-right font-bold text-base-content bg-secondary/50"},bt={class:"text-right font-bold text-base-content bg-secondary/50"},yt={class:"text-right font-bold text-base-content bg-secondary/50"},ht={key:0,class:"text-right font-bold text-base-content bg-secondary/50"},ft={class:"text-right font-bold text-base-content bg-secondary/50"},mt={class:"text-right font-bold text-base-content bg-secondary/50"},xt={class:"text-right font-bold text-base-content bg-secondary/50"},Bt={class:"text-right font-bold text-base-content bg-secondary/50"},vt=["onClick"],Ct={key:0,class:"sticky left-0 bg-base-100 z-10"},kt={key:1,class:"sticky left-16 bg-base-100 z-10"},pt={key:2,class:"sticky left-0 bg-base-100 z-10"},$t={key:3,class:"sticky left-32 bg-base-100 z-10"},qt={key:4,class:"text-right"},_t={class:"border-t-4 border-gray-400"},Ft={key:0,colspan:"3",class:"font-bold bg-primary text-center text-primary-content text-md sticky left-0 z-10"},Ht={key:1,class:"sticky left-32 text-base-content bg-primary/50 font-bold text-md z-10"},wt={class:"text-right font-bold text-md text-base-content bg-primary/50"},St={class:"text-right font-bold text-md text-base-content bg-primary/50"},It={class:"text-right font-bold text-md text-base-content bg-primary/50"},zt={class:"text-right font-bold text-md text-base-content bg-primary/50"},Tt={class:"text-right font-bold text-md text-base-content bg-primary/50"},Qt={key:2,class:"text-right font-bold text-md text-base-content bg-primary/50"},Vt={class:"text-right font-bold text-md text-base-content bg-primary/50"},Et={class:"text-right font-bold text-md text-base-content bg-primary/50"},Nt={class:"text-right font-bold text-md text-base-content bg-primary/50"},At={class:"text-right font-bold text-md text-base-content bg-primary/50"},ye={__name:"SalesTable",props:{sales:{type:Array,required:!0},customBudgets:{type:Array,default:()=>[]},getBudgetValue:{type:Function,required:!0},getCellClass:{type:Function,required:!0},handleBudgetChange:{type:Function,required:!0},handleBudgetBlur:{type:Function,required:!0},handleBudgetInput:{type:Function,required:!0},handleDeleteCustomBudget:{type:Function,required:!0},isHospitality:{type:Boolean,required:!0},getTotalQ1:{type:Function,required:!0},getTotalQ2:{type:Function,required:!0},getTotalQ3:{type:Function,required:!0},getTotalQ4:{type:Function,required:!0},getTotalSales:{type:Function,required:!0},getTotalZeroPercent:{type:Function,required:!0},getZeroPercentRate:{type:Function,required:!0},getTotalQ1Budget:{type:Function,required:!1},getTotalQ2Budget:{type:Function,required:!1},getTotalQ3Budget:{type:Function,required:!1},getTotalQ4Budget:{type:Function,required:!1}},setup(e){const v=e,b=T(()=>{const y={},l=[];v.sales.forEach(a=>{const m=v.isHospitality?a.brand||"Unknown Brand":a.derived_customer_class||"Unknown Class";y[m]||(y[m]=[],l.push(m)),y[m].push(a)});const t=[];return l.forEach(a=>{const m=y[a];m.forEach(g=>{t.push({...g,isSubtotal:!1})});const q={isSubtotal:!0,groupKey:a,q1_sales:m.reduce((g,u)=>g+(parseFloat(u.q1_sales)||0),0),q2_sales:m.reduce((g,u)=>g+(parseFloat(u.q2_sales)||0),0),q3_sales:m.reduce((g,u)=>g+(parseFloat(u.q3_sales)||0),0),q4_sales:m.reduce((g,u)=>g+(parseFloat(u.q4_sales)||0),0),zero_perc_sales_total:m.reduce((g,u)=>g+(parseFloat(u.zero_perc_sales_total)||0),0),total_sales:m.reduce((g,u)=>g+(parseFloat(u.total_sales)||0),0),zero_perc_sales_percent:0,q1_budget:m.reduce((g,u)=>g+(parseFloat(v.getBudgetValue(u,1))||0),0),q2_budget:m.reduce((g,u)=>g+(parseFloat(v.getBudgetValue(u,2))||0),0),q3_budget:m.reduce((g,u)=>g+(parseFloat(v.getBudgetValue(u,3))||0),0),q4_budget:m.reduce((g,u)=>g+(parseFloat(v.getBudgetValue(u,4))||0),0)};q.zero_perc_sales_percent=q.total_sales>0?q.zero_perc_sales_total/q.total_sales*100:0,t.push(q)}),t}),x=H(null),C=H(1200),k=(y,l)=>{y&&l&&(l.scrollLeft=y.scrollLeft)};return Q(()=>{x.value&&(C.value=x.value.scrollWidth);const y=document.querySelector(".sticky .overflow-x-auto"),l=document.querySelector(".overflow-x-auto:not(.sticky .overflow-x-auto)");y&&l&&(y.addEventListener("scroll",()=>k(y,l)),l.addEventListener("scroll",()=>k(l,y)))}),V(()=>{const y=document.querySelector(".sticky .overflow-x-auto"),l=document.querySelector(".overflow-x-auto:not(.sticky .overflow-x-auto)");y&&l&&(y.removeEventListener("scroll",()=>k(y,l)),l.removeEventListener("scroll",()=>k(l,y)))}),(y,l)=>(r(),n("div",O,[s("div",M,[s("div",R,[s("div",{class:"h-4",style:E({width:C.value+"px"})},null,4)])]),s("div",j,[s("table",{ref_key:"tableRef",ref:x,class:"table-sm table w-full"},[s("thead",null,[s("tr",null,[l[0]||(l[0]=s("th",null,null,-1)),e.isHospitality?(r(),n("th",P," Brand ")):c("",!0),e.isHospitality?(r(),n("th",Z," Flag ")):c("",!0),e.isHospitality?c("",!0):(r(),n("th",K," Customer Class ")),e.isHospitality?c("",!0):(r(),n("th",W," Customer Name ")),l[1]||(l[1]=s("th",null,"Q1 Sales",-1)),l[2]||(l[2]=s("th",null,"Q2 Sales",-1)),l[3]||(l[3]=s("th",null,"Q3 Sales",-1)),l[4]||(l[4]=s("th",null,"Q4 Orders",-1)),l[5]||(l[5]=s("th",null,"Total Sales",-1)),e.isHospitality?(r(),n("th",G,"0% Sales (Rate)")):c("",!0),l[6]||(l[6]=s("th",null,"Budget Q1",-1)),l[7]||(l[7]=s("th",null,"Budget Q2",-1)),l[8]||(l[8]=s("th",null,"Budget Q3",-1)),l[9]||(l[9]=s("th",null,"Budget Q4",-1))])]),s("tbody",null,[(r(!0),n(_,null,F(b.value,t=>(r(),n(_,{key:t.isSubtotal?`subtotal-${t.groupKey}`:`${t.customer_name}-${t.brand||"null"}-${t.flag||"null"}`},[t.isSubtotal?(r(),n("tr",ut,[s("td",dt,o(t.groupKey)+" Total ",1),s("td",it," $"+o(d(i)(t.q1_sales)),1),s("td",ct," $"+o(d(i)(t.q2_sales)),1),s("td",gt," $"+o(d(i)(t.q3_sales)),1),s("td",bt," $"+o(d(i)(t.q4_sales)),1),s("td",yt," $"+o(d(i)(t.total_sales)),1),e.isHospitality?(r(),n("td",ht," $"+o(d(i)(t.zero_perc_sales_total))+" ("+o(d(z)(t.zero_perc_sales_percent))+"%) ",1)):c("",!0),s("td",ft," $"+o(d(i)(t.q1_budget)),1),s("td",mt," $"+o(d(i)(t.q2_budget)),1),s("td",xt," $"+o(d(i)(t.q3_budget)),1),s("td",Bt," $"+o(d(i)(t.q4_budget)),1)])):(r(),n("tr",J,[l[10]||(l[10]=s("td",null,null,-1)),e.isHospitality?(r(),n("td",X,o(t.brand||"N/A"),1)):c("",!0),e.isHospitality?(r(),n("td",Y,o(t.flag||"N/A"),1)):c("",!0),e.isHospitality?c("",!0):(r(),n("td",tt,o(t.derived_customer_class||"N/A"),1)),e.isHospitality?c("",!0):(r(),n("td",et,o(t.customer_name||"N/A"),1)),s("td",st," $"+o(d(i)(t.q1_sales)),1),s("td",lt," $"+o(d(i)(t.q2_sales)),1),s("td",at," $"+o(d(i)(t.q3_sales)),1),s("td",ot," $"+o(d(i)(t.q4_sales)),1),s("td",nt," $"+o(d(i)(t.total_sales)),1),e.isHospitality?(r(),n("td",rt," $"+o(d(i)(t.zero_perc_sales_total))+" ("+o(d(z)(t.zero_perc_sales_percent))+"%) ",1)):c("",!0),s("td",{class:B([e.getCellClass(t,1),"text-right"])},[p($,{value:e.getBudgetValue(t,1),"cell-class":e.getCellClass(t,1),onChange:a=>e.handleBudgetChange(a,t,1),onBlur:a=>e.handleBudgetBlur(a,t,1),onInput:a=>e.handleBudgetInput(a,t,1)},null,8,["value","cell-class","onChange","onBlur","onInput"])],2),s("td",{class:B([e.getCellClass(t,2),"text-right"])},[p($,{value:e.getBudgetValue(t,2),"cell-class":e.getCellClass(t,2),onChange:a=>e.handleBudgetChange(a,t,2),onBlur:a=>e.handleBudgetBlur(a,t,2),onInput:a=>e.handleBudgetInput(a,t,2)},null,8,["value","cell-class","onChange","onBlur","onInput"])],2),s("td",{class:B([e.getCellClass(t,3),"text-right"])},[p($,{value:e.getBudgetValue(t,3),"cell-class":e.getCellClass(t,3),onChange:a=>e.handleBudgetChange(a,t,3),onBlur:a=>e.handleBudgetBlur(a,t,3),onInput:a=>e.handleBudgetInput(a,t,3)},null,8,["value","cell-class","onChange","onBlur","onInput"])],2),s("td",{class:B([e.getCellClass(t,4),"text-right"])},[p($,{value:e.getBudgetValue(t,4),"cell-class":e.getCellClass(t,4),onChange:a=>e.handleBudgetChange(a,t,4),onBlur:a=>e.handleBudgetBlur(a,t,4),onInput:a=>e.handleBudgetInput(a,t,4)},null,8,["value","cell-class","onChange","onBlur","onInput"])],2)]))],64))),128)),(r(!0),n(_,null,F(e.customBudgets,t=>(r(),n("tr",{key:`custom-${t.id}`},[s("td",null,[s("button",{onClick:a=>e.handleDeleteCustomBudget(t.id),class:"btn btn-ghost btn-xs text-error hover:bg-error hover:text-error-content",title:"Delete custom budget"},[...l[11]||(l[11]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,vt)]),e.isHospitality?(r(),n("td",Ct,o(t.brand||"N/A"),1)):c("",!0),e.isHospitality?(r(),n("td",kt,o(t.flag||"N/A"),1)):c("",!0),e.isHospitality?c("",!0):(r(),n("td",pt,o(t.customer_class||"N/A"),1)),e.isHospitality?c("",!0):(r(),n("td",$t,o(t.customer_name||"N/A"),1)),l[12]||(l[12]=s("td",{class:"text-right"},"$0.00",-1)),l[13]||(l[13]=s("td",{class:"text-right"},"$0.00",-1)),l[14]||(l[14]=s("td",{class:"text-right"},"$0.00",-1)),l[15]||(l[15]=s("td",{class:"text-right"},"$0.00",-1)),l[16]||(l[16]=s("td",{class:"text-right font-semibold"},"$0.00",-1)),e.isHospitality?(r(),n("td",qt," $0.00 (0.00%) ")):c("",!0),s("td",{class:B([e.getCellClass(t,1),"text-right"])},[p($,{value:e.getBudgetValue(t,1),"cell-class":e.getCellClass(t,1),onChange:a=>e.handleBudgetChange(a,t,1),onBlur:a=>e.handleBudgetBlur(a,t,1),onInput:a=>e.handleBudgetInput(a,t,1)},null,8,["value","cell-class","onChange","onBlur","onInput"])],2),s("td",{class:B([e.getCellClass(t,2),"text-right"])},[p($,{value:e.getBudgetValue(t,2),"cell-class":e.getCellClass(t,2),onChange:a=>e.handleBudgetChange(a,t,2),onBlur:a=>e.handleBudgetBlur(a,t,2),onInput:a=>e.handleBudgetInput(a,t,2)},null,8,["value","cell-class","onChange","onBlur","onInput"])],2),s("td",{class:B([e.getCellClass(t,3),"text-right"])},[p($,{value:e.getBudgetValue(t,3),"cell-class":e.getCellClass(t,3),onChange:a=>e.handleBudgetChange(a,t,3),onBlur:a=>e.handleBudgetBlur(a,t,3),onInput:a=>e.handleBudgetInput(a,t,3)},null,8,["value","cell-class","onChange","onBlur","onInput"])],2),s("td",{class:B([e.getCellClass(t,4),"text-right"])},[p($,{value:e.getBudgetValue(t,4),"cell-class":e.getCellClass(t,4),onChange:a=>e.handleBudgetChange(a,t,4),onBlur:a=>e.handleBudgetBlur(a,t,4),onInput:a=>e.handleBudgetInput(a,t,4)},null,8,["value","cell-class","onChange","onBlur","onInput"])],2)]))),128)),s("tr",_t,[e.isHospitality?(r(),n("td",Ft," TOTAL ")):c("",!0),e.isHospitality?c("",!0):(r(),n("td",Ht)),s("td",wt," $"+o(d(i)(e.getTotalQ1())),1),s("td",St," $"+o(d(i)(e.getTotalQ2())),1),s("td",It," $"+o(d(i)(e.getTotalQ3())),1),s("td",zt," $"+o(d(i)(e.getTotalQ4())),1),s("td",Tt," $"+o(d(i)(e.getTotalSales())),1),e.isHospitality?(r(),n("td",Qt," $"+o(d(i)(e.getTotalZeroPercent()))+" ("+o(e.getZeroPercentRate().toFixed(2))+"%) ",1)):c("",!0),s("td",Vt," $"+o(d(i)(e.getTotalQ1Budget())),1),s("td",Et," $"+o(d(i)(e.getTotalQ2Budget())),1),s("td",Nt," $"+o(d(i)(e.getTotalQ3Budget())),1),s("td",At," $"+o(d(i)(e.getTotalQ4Budget())),1)])])],512)])]))}},Dt={key:0,class:"modal modal-open"},Lt={class:"modal-box w-11/12 max-w-2xl"},Ut={key:0,class:"space-y-4"},Ot={class:"form-control"},Mt={id:"customer-classes"},Rt=["value"],jt={key:0,class:"label"},Pt={class:"label-text-alt text-error"},Zt={class:"form-control"},Kt={id:"customer-names"},Wt=["value"],Gt={key:0,class:"label"},Jt={class:"label-text-alt text-error"},Xt={key:1,class:"space-y-4"},Yt={class:"form-control"},te={id:"brands"},ee=["value"],se={key:0,class:"label"},le={class:"label-text-alt text-error"},ae={class:"form-control"},oe={id:"flags"},ne=["value"],re={key:0,class:"label"},ue={class:"label-text-alt text-error"},de={class:"modal-action"},ie=["disabled"],ce=["disabled"],ge={key:0,class:"loading loading-spinner loading-sm"},he={__name:"AddCustomBudgetModal",props:{isOpen:{type:Boolean,default:!1},isHospitality:{type:Boolean,default:!1},autosuggestData:{type:Object,default:()=>({customer_classes:[],customer_names:[],brands:[],flags:[]})}},emits:["close","created","fetch-autosuggest"],setup(e,{emit:v}){const b=e,x=v,C=H(!1),k=H(null),y=H(null),l=I({customer_name:"",customer_class:"",brand:"",flag:""}),t=I({customer_name:"",customer_class:"",brand:"",flag:""}),a=()=>{Object.keys(t).forEach(h=>t[h]="");let u=!0;return b.isHospitality?(l.brand.trim()||(t.brand="Brand is required",u=!1),l.flag.trim()||(t.flag="Flag is required",u=!1)):(l.customer_name.trim()||(t.customer_name="Customer name is required",u=!1),l.customer_class.trim()||(t.customer_class="Customer class is required",u=!1)),u},m=async()=>{if(console.log("handleSubmit called",{isHospitality:b.isHospitality,form:{...l}}),!a()){console.log("Form validation failed",t);return}console.log("Form validation passed, proceeding with submission"),C.value=!0;try{const u={customer_name:b.isHospitality?null:l.customer_name,customer_class:b.isHospitality?"Hospitality":l.customer_class,brand:b.isHospitality?l.brand.toUpperCase():null,flag:b.isHospitality?l.flag.toUpperCase():null,is_custom:!0};console.log("Emitting budget data:",u),x("created",u),g(),x("close")}catch(u){console.error("Error creating custom budget:",u)}finally{C.value=!1}},q=()=>{g(),x("close")},g=()=>{l.customer_name="",l.customer_class="",l.brand="",l.flag="",Object.keys(t).forEach(u=>t[u]="")};return N(()=>b.isOpen,async u=>{u&&(x("fetch-autosuggest"),await A(),b.isHospitality&&y.value?y.value.focus():!b.isHospitality&&k.value&&k.value.focus())}),(u,h)=>e.isOpen?(r(),n("div",Dt,[s("div",Lt,[h[9]||(h[9]=s("h3",{class:"font-bold text-lg mb-4"},"Add Custom Row",-1)),s("form",{onSubmit:D(m,["prevent"]),class:"space-y-4"},[e.isHospitality?(r(),n("div",Xt,[s("div",Yt,[h[6]||(h[6]=s("label",{class:"label"},[s("span",{class:"label-text"},"Brand")],-1)),w(s("input",{ref_key:"brandInput",ref:y,"onUpdate:modelValue":h[2]||(h[2]=f=>l.brand=f),type:"text",list:"brands",placeholder:"Enter or select brand",class:B(["input input-bordered w-full",{"input-error":t.brand}]),required:""},null,2),[[S,l.brand]]),s("datalist",te,[(r(!0),n(_,null,F(b.autosuggestData.brands,f=>(r(),n("option",{key:f,value:f},null,8,ee))),128))]),t.brand?(r(),n("label",se,[s("span",le,o(t.brand),1)])):c("",!0)]),s("div",ae,[h[7]||(h[7]=s("label",{class:"label"},[s("span",{class:"label-text"},"Flag")],-1)),w(s("input",{"onUpdate:modelValue":h[3]||(h[3]=f=>l.flag=f),type:"text",list:"flags",placeholder:"Enter or select flag",class:B(["input input-bordered w-full",{"input-error":t.flag}]),required:""},null,2),[[S,l.flag]]),s("datalist",oe,[(r(!0),n(_,null,F(b.autosuggestData.flags,f=>(r(),n("option",{key:f,value:f},null,8,ne))),128))]),t.flag?(r(),n("label",re,[s("span",ue,o(t.flag),1)])):c("",!0)]),h[8]||(h[8]=s("div",{class:"form-control hidden"},[s("label",{class:"label"},[s("span",{class:"label-text"},"Customer Class")]),s("input",{type:"text",value:"Hospitality",class:"input input-bordered w-full input-disabled",disabled:""})],-1))])):(r(),n("div",Ut,[s("div",Ot,[h[4]||(h[4]=s("label",{class:"label"},[s("span",{class:"label-text"},"Customer Class")],-1)),w(s("input",{"onUpdate:modelValue":h[0]||(h[0]=f=>l.customer_class=f),type:"text",list:"customer-classes",placeholder:"Enter or select customer class",class:B(["input input-bordered w-full",{"input-error":t.customer_class}]),required:""},null,2),[[S,l.customer_class]]),s("datalist",Mt,[(r(!0),n(_,null,F(b.autosuggestData.customer_classes,f=>(r(),n("option",{key:f,value:f},null,8,Rt))),128))]),t.customer_class?(r(),n("label",jt,[s("span",Pt,o(t.customer_class),1)])):c("",!0)]),s("div",Zt,[h[5]||(h[5]=s("label",{class:"label"},[s("span",{class:"label-text"},"Customer Name")],-1)),w(s("input",{ref_key:"customerNameInput",ref:k,"onUpdate:modelValue":h[1]||(h[1]=f=>l.customer_name=f),type:"text",list:"customer-names",placeholder:"Enter or select customer name",class:B(["input input-bordered w-full",{"input-error":t.customer_name}]),required:""},null,2),[[S,l.customer_name]]),s("datalist",Kt,[(r(!0),n(_,null,F(b.autosuggestData.customer_names,f=>(r(),n("option",{key:f,value:f},null,8,Wt))),128))]),t.customer_name?(r(),n("label",Gt,[s("span",Jt,o(t.customer_name),1)])):c("",!0)])])),s("div",de,[s("button",{type:"button",onClick:q,class:"btn btn-ghost",disabled:C.value}," Cancel ",8,ie),s("button",{type:"submit",class:"btn btn-primary",disabled:C.value},[C.value?(r(),n("span",ge)):c("",!0),L(" "+o(C.value?"Creating...":"Add Budget"),1)],8,ce)])],32)])])):c("",!0)}};export{ye as _,he as a};
