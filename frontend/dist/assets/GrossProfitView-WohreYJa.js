import{u as N,r as P,c as w,_ as F,a as b,g as k,e as s,t as u,w as S,b as v,j as J,F as R,h as H,d as E,y as A,i as I,A as U,o as O,f as T}from"./index-5HnzLnCl.js";import{L as K}from"./LoadingError-CcIY0GoQ.js";function B(){const h=N(),n=P(!1),i=P([]),e=w(()=>{const t={};for(const a of i.value){const _=`${a.salesperson_id}-${a.customer_class}-${a.group_key}`;t[_]||(t[_]={salesperson_id:a.salesperson_id,salesperson_name:a.salesperson_name,customer_class:a.customer_class,group_key:a.group_key,brand:a.brand,display_key:a.customer_class==="Hospitality"&&a.brand?`${a.group_key} (${a.brand})`:a.group_key,effective_gp_percent:a.effective_gp_percent,is_custom:a.is_custom,quarters:[{label:"Q1",sales_2025:a.q1_sales_2025,sales:a.quarter_1_sales,gp_percent:a.q1_gp_percent,gp_value:a.q1_gp_value},{label:"Q2",sales_2025:a.q2_sales_2025,sales:a.quarter_2_sales,gp_percent:a.q2_gp_percent,gp_value:a.q2_gp_value},{label:"Q3",sales_2025:a.q3_sales_2025,sales:a.quarter_3_sales,gp_percent:a.q3_gp_percent,gp_value:a.q3_gp_value},{label:"Q4",sales_2025:a.q4_sales_2025,sales:a.quarter_4_sales,gp_percent:a.q4_gp_percent,gp_value:a.q4_gp_value}]})}return Object.values(t)});async function y(){n.value=!0;const a=await(await h.apiCall("/api/gross-profit")).json();i.value=a.data||[],n.value=!1}async function d(t,a,_){const m=await h.apiCall(`/api/gross-profit/${t}/${encodeURIComponent(a)}/${encodeURIComponent(_)}`);if(!m.ok)throw new Error("Failed to fetch group");return(await m.json()).data||[]}async function o(t){const a=Math.min(Math.max(t.effective_gp_percent,0),1),_=[{salesperson_id:t.salesperson_id,salesperson_name:t.salesperson_name,customer_class:t.customer_class,group_key:t.group_key,custom_gp_percent:a}];await h.apiCall("/api/gross-profit/save-overrides",{method:"POST",body:JSON.stringify({overrides:_})});const m=await d(t.salesperson_id,t.customer_class,t.group_key),r=[...i.value];if(r.filter(c=>c.group_key===t.group_key&&c.salesperson_id===t.salesperson_id).length>0){const c=r.findIndex(x=>x.group_key===t.group_key&&x.salesperson_id===t.salesperson_id),p=r.filter(x=>!(x.group_key===t.group_key&&x.salesperson_id===t.salesperson_id));p.splice(c,0,...m),i.value=p}else i.value=[...i.value.filter(c=>!(c.group_key===t.group_key&&c.salesperson_id===t.salesperson_id)),...m]}async function g(t){await h.apiCall(`/api/gross-profit/reset/${t.salesperson_id}/${encodeURIComponent(t.customer_class)}/${encodeURIComponent(t.group_key)}`,{method:"DELETE"});const a=await d(t.salesperson_id,t.customer_class,t.group_key),_=[...i.value];if(_.filter(r=>r.group_key===t.group_key&&r.salesperson_id===t.salesperson_id).length>0){const r=_.findIndex(c=>c.group_key===t.group_key&&c.salesperson_id===t.salesperson_id),G=_.filter(c=>!(c.group_key===t.group_key&&c.salesperson_id===t.salesperson_id));G.splice(r,0,...a),i.value=G}else i.value=[...i.value.filter(r=>!(r.group_key===t.group_key&&r.salesperson_id===t.salesperson_id)),...a]}async function f(){await h.apiCall("/api/gross-profit/reset-all",{method:"DELETE"});const t=e.value.filter(r=>r.is_custom),a=t.map(r=>d(r.salesperson_id,r.customer_class,r.group_key)),_=await Promise.all(a);let m=[...i.value];t.forEach((r,G)=>{const c=_[G];m=m.filter(p=>!(p.group_key===r.group_key&&p.salesperson_id===r.salesperson_id)),m.push(...c)}),i.value=m}return{grouped:e,fetch:y,save:o,reset:g,resetAll:f,loading:n}}const W={__name:"GrossProfitSlider",props:{modelValue:Number},emits:["update:modelValue"],setup(h,{expose:n,emit:i}){n();const e=h,y=i,d=P((e.modelValue||0)*100),o=w(()=>{const f=d.value;return typeof f!="number"||isNaN(f)?"0.0":f.toFixed(1)});S(d,f=>{if(typeof f=="number"&&!isNaN(f)){const t=f/100;y("update:modelValue",t)}}),S(()=>e.modelValue,f=>{typeof f=="number"&&!isNaN(f)?d.value=f*100:d.value=0});const g={props:e,emit:y,internal:d,displayValue:o,ref:P,watch:S,computed:w};return Object.defineProperty(g,"__isScriptSetup",{enumerable:!1,value:!0}),g}},X={class:"flex items-center space-x-3 w-full"},Y=["value"],Z={class:"badge badge-sm badge-primary"};function ee(h,n,i,e,y,d){return k(),b("div",X,[s("input",{type:"range",min:"0",max:"100",step:"0.1",value:typeof e.internal=="number"&&!isNaN(e.internal)?e.internal:0,onInput:n[0]||(n[0]=o=>e.internal=parseFloat(o.target.value)||0),class:"range range-sm range-primary flex-grow"},null,40,Y),s("span",Z,u(e.displayValue)+"% ",1)])}const se=F(W,[["render",ee],["__file","G:/ProjectsPARA/Projects/budget-2026/frontend/src/components/GrossProfitSlider.vue"]]),te={__name:"GrossProfitGroupCard",props:{group:Object,onSave:Function,onReset:Function},emits:["collapse"],setup(h,{expose:n,emit:i}){n();const e=h,y=i,d=P(!1),o=A({...e.group}),g=P(e.group.effective_gp_percent);S(()=>e.group,p=>{Object.assign(o,p),d.value||(g.value=p.effective_gp_percent)},{deep:!0});const f=w(()=>{const p=o.effective_gp_percent,x=g.value;return Math.abs(p-x)>.001}),t=w(()=>o.is_custom||f.value);async function a(){d.value=!0;try{await e.onSave(o),g.value=o.effective_gp_percent}finally{d.value=!1}}async function _(){d.value=!0;try{await e.onReset(o),g.value=o.effective_gp_percent}finally{d.value=!1}}function m(p){return p==null?"-":(p*100).toFixed(1)+"%"}function r(p){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(p||0)}const c={props:e,emit:y,saving:d,localGroup:o,lastSavedValue:g,hasChanges:f,canReset:t,handleSave:a,handleReset:_,fmtPct:m,fmtMoney:r,handleCollapse:()=>{y("collapse")},GrossProfitSlider:se,ref:P,computed:w,watch:S,reactive:A};return Object.defineProperty(c,"__isScriptSetup",{enumerable:!1,value:!0}),c}},ae={class:"card bg-base-100 shadow-xl border border-base-300 transition-all duration-200 hover:shadow-2xl"},oe={class:"card-body"},ne={class:"flex items-center justify-between mb-4"},re={class:"card-title text-lg"},le={class:"flex items-center gap-2"},ie=["disabled"],ce=["disabled"],de={key:0,class:"loading loading-spinner loading-xs"},ue={class:"overflow-x-auto"},_e={class:"table w-full text-sm"},pe={class:"font-medium"},fe={class:"font-mono"},me={class:"flex justify-between items-center mt-4"},ge={class:"w-full max-w-sm"},ve={class:"flex items-center space-x-2"},he={class:"text-sm opacity-70"},ye={key:0,class:"badge badge-sm badge-primary ml-2"};function be(h,n,i,e,y,d){return k(),b("div",ae,[s("div",oe,[v(" Group Header "),s("div",ne,[s("h3",re,u(e.localGroup.customer_class)+" › "+u(e.localGroup.salesperson_name)+" › "+u(e.localGroup.display_key),1),s("div",le,[s("button",{class:"btn btn-sm btn-ghost",disabled:e.saving||!e.canReset,onClick:e.handleReset}," Reset ",8,ie),s("button",{class:"btn btn-sm btn-primary",disabled:e.saving||!e.hasChanges,onClick:e.handleSave},[e.saving?(k(),b("span",de)):v("v-if",!0),n[1]||(n[1]=J(" Save Changes ",-1))],8,ce)])]),v(" Data Table "),s("div",ue,[s("table",_e,[n[2]||(n[2]=s("thead",null,[s("tr",null,[s("th",null,"Quarter"),s("th",null,"2025 Sales"),s("th",null,"2026 Budget"),s("th",null,"Historical GP%"),s("th",null,"GP $ (Est.)")])],-1)),s("tbody",null,[(k(!0),b(R,null,H(e.localGroup.quarters,o=>(k(),b("tr",{key:o.label},[s("td",pe,u(o.label),1),s("td",null,u(e.fmtMoney(o.sales_2025)),1),s("td",null,u(e.fmtMoney(o.sales)),1),s("td",null,u(e.fmtPct(o.gp_percent)),1),s("td",fe,u(e.fmtMoney(o.gp_value)),1)]))),128))])])]),v(" GP% Override Section "),s("div",me,[s("div",ge,[n[3]||(n[3]=s("label",{class:"text-sm font-medium mb-2 block"}," Effective GP% ",-1)),s("div",ve,[E(e.GrossProfitSlider,{modelValue:e.localGroup.effective_gp_percent,"onUpdate:modelValue":n[0]||(n[0]=o=>e.localGroup.effective_gp_percent=o)},null,8,["modelValue"]),s("div",he,[e.localGroup.is_custom?(k(),b("span",ye,"Custom")):v("v-if",!0)])])])])])])}const ke=F(te,[["render",be],["__file","G:/ProjectsPARA/Projects/budget-2026/frontend/src/components/GrossProfitGroupCard.vue"]]),xe={__name:"GrossProfitView",setup(h,{expose:n}){n();const i=I("navActions"),{grouped:e,fetch:y,save:d,reset:o,resetAll:g,loading:f}=B(),t=N(),{adminStatus:a,superadminStatus:_}=U(t),m=async()=>{try{await g()}catch(l){console.error("Error resetting all overrides:",l)}},r={id:"reset-all-overrides",text:"Reset All Overrides",class:"btn btn-warning mr-2",handler:m,icon:'<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>'},G={id:"back-to-admin",text:"Back to Admin",class:"btn btn-ghost",handler:()=>{window.history.back()},icon:'<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>'},c=()=>{const l=[];_.value&&l.push(r),(a.value||_.value)&&l.push(G),i.set(l)};S([a,_],()=>c(),{immediate:!0});const p=A({}),x=l=>`${l.salesperson_id}-${l.customer_class}-${l.group_key}`,j=l=>({...l.quarters.reduce((C,D)=>(C.sales2025+=D.sales_2025||0,C.budget2026+=D.sales||0,C.gpValue+=D.gp_value||0,C),{sales2025:0,budget2026:0,gpValue:0}),effectiveGp:l.effective_gp_percent||0}),M=w(()=>e.value?.length?e.value.map(l=>({key:x(l),group:l,summary:j(l)})):[]),L=w(()=>e.value?.length?e.value.reduce((V,C)=>V+(C.effective_gp_percent||0),0)/e.value.length:0),$=l=>{p[l]=!p[l]},Q=l=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(l||0),z=l=>`${((l||0)*100).toFixed(1)}%`;O(()=>{c(),y()}),T(()=>i.clear());const q={navActions:i,grouped:e,fetch:y,save:d,reset:o,resetAll:g,loading:f,authStore:t,adminStatus:a,superadminStatus:_,handleResetAll:m,resetAllAction:r,backAction:G,updateNavActions:c,expandedGroups:p,makeGroupKey:x,computeSummary:j,groupRows:M,averageGpPercent:L,toggleGroup:$,formatCurrency:Q,formatPercent:z,onMounted:O,onUnmounted:T,inject:I,computed:w,reactive:A,watch:S,get storeToRefs(){return U},get useGrossProfitData(){return B},GrossProfitGroupCard:ke,LoadingError:K,get useAuthStore(){return N}};return Object.defineProperty(q,"__isScriptSetup",{enumerable:!1,value:!0}),q}},Ge={class:"p-6 space-y-6"},we={key:0,class:"stats shadow mb-6"},Pe={class:"stat"},Se={class:"stat-value text-primary"},Ce={class:"stat"},Re={class:"stat-value text-secondary"},Ae={class:"stat"},je={class:"stat-value text-accent"},Ve={key:1},De={class:"overflow-x-auto"},Ne={class:"table table-zebra w-full"},Ee=["onClick"],Fe={class:"font-semibold"},Me={class:"text-xs opacity-70"},qe={class:"text-right font-mono"},Ie={class:"text-right font-mono"},Ue={class:"text-right font-mono"},Oe={class:"text-right font-mono font-semibold"},Te={key:0},Be={colspan:"100%"};function He(h,n,i,e,y,d){return k(),b("div",Ge,[v(" Header "),v(` <div class="hero bg-base-200 rounded-lg">
            <div class="hero-content text-center">
                <div class="max-w-4xl">
                    <h1 class="text-5xl font-bold">Gross Profit Management</h1>
                    <p class="py-6">
                        Adjust effective GP% overrides for budget allocation.
                        Use sliders to modify gross profit percentages and save
                        changes.
                    </p>
                </div>
            </div>
        </div> `),v(" Loading and Error States "),E(e.LoadingError,{loading:e.loading,error:null,onRetry:e.fetch},null,8,["loading","onRetry"]),v(" Stats Summary "),!e.loading&&e.grouped.length>0?(k(),b("div",we,[n[3]||(n[3]=s("div",{class:"stat"},[s("div",{class:"stat-title"},"Module"),s("div",{class:"stat-value text-primary"}," Gross Profit Management ")],-1)),s("div",Pe,[n[0]||(n[0]=s("div",{class:"stat-title"},"Total Groups",-1)),s("div",Se,u(e.grouped.length),1)]),s("div",Ce,[n[1]||(n[1]=s("div",{class:"stat-title"},"Groups with Custom GP%",-1)),s("div",Re,u(e.grouped.filter(o=>o.is_custom).length),1)]),s("div",Ae,[n[2]||(n[2]=s("div",{class:"stat-title"},"Average GP%",-1)),s("div",je,u(e.formatPercent(e.averageGpPercent)),1)])])):v("v-if",!0),v(" Gross Profit Groups "),!e.loading&&e.groupRows.length>0?(k(),b("div",Ve,[s("div",De,[s("table",Ne,[n[4]||(n[4]=s("thead",null,[s("tr",null,[s("th",{class:"w-20"},"Action"),s("th",null,"Group"),s("th",{class:"text-right"},"2025 Sales"),s("th",{class:"text-right"},"2026 Budget"),s("th",{class:"text-right"},"Historical GP%"),s("th",{class:"text-right"},"GP $ Est.")])],-1)),s("tbody",null,[(k(!0),b(R,null,H(e.groupRows,o=>(k(),b(R,{key:o.key},[s("tr",null,[s("td",null,[s("button",{class:"btn btn-outline btn-xs",type:"button",onClick:g=>e.toggleGroup(o.key)},u(e.expandedGroups[o.key]?"Collapse":"Expand"),9,Ee)]),s("td",null,[s("div",Fe,u(o.group.display_key),1),s("div",Me,u(o.group.customer_class)+" - "+u(o.group.salesperson_name),1)]),s("td",qe,u(e.formatCurrency(o.summary.sales2025)),1),s("td",Ie,u(e.formatCurrency(o.summary.budget2026)),1),s("td",Ue,u(e.formatPercent(o.summary.effectiveGp)),1),s("td",Oe,u(e.formatCurrency(o.summary.gpValue)),1)]),e.expandedGroups[o.key]?(k(),b("tr",Te,[v(" <td></td> "),s("td",Be,[E(e.GrossProfitGroupCard,{group:o.group,onSave:e.save,onReset:e.reset,onCollapse:g=>e.toggleGroup(o.key)},null,8,["group","onSave","onReset","onCollapse"])])])):v("v-if",!0)],64))),128))])])])])):!e.loading&&e.grouped.length===0?(k(),b(R,{key:2},[v(" No Data State "),n[5]||(n[5]=s("div",{class:"alert alert-info"},[s("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",class:"stroke-current shrink-0 w-6 h-6"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]),s("span",null,"No gross profit data available. Please check your data sources.")],-1))],2112)):v("v-if",!0)])}const Qe=F(xe,[["render",He],["__file","G:/ProjectsPARA/Projects/budget-2026/frontend/src/views/GrossProfitView.vue"]]);export{Qe as default};
