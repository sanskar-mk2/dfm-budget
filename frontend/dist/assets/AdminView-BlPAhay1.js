import{c as v,b as k,g as D,f as t,t as l,h as T,F as st,j as at,k as j,u as ot,r as Q,o as lt,i as nt,l as rt,a as dt,d as O,e as q,m as W}from"./index-B6ztc34b.js";import{g as K,d as Z,f as _,_ as it}from"./downloadUtils-_K93Qbmf.js";const ut={class:"grid sm:grid-cols-2 lg:grid-cols-4 gap-4"},_t={class:"stat bg-base-100 shadow rounded-xl"},ct={class:"stat-value text-primary"},ht={class:"stat bg-base-100 shadow rounded-xl"},gt={class:"stat-value text-primary"},mt={class:"stat bg-base-100 shadow rounded-xl"},bt={class:"stat-value text-primary"},qt={class:"stat bg-base-100 shadow rounded-xl"},pt={class:"stat-value text-primary"},yt={__name:"AdminStats",props:{summaryData:{type:Array,required:!0,default:()=>[]}},setup(r){const g=r,b=v(()=>g.summaryData.reduce((n,c)=>n+c.total_sales,0)),a=v(()=>g.summaryData.reduce((n,c)=>n+c.total_budget,0)),y=v(()=>b.value===0?0:(a.value-b.value)/b.value*100),p=n=>new Intl.NumberFormat("en-US",{minimumFractionDigits:0,maximumFractionDigits:0}).format(n||0);return(n,c)=>(D(),k("div",ut,[t("div",_t,[c[0]||(c[0]=t("div",{class:"stat-title"},"Total Salespeople",-1)),t("div",ct,l(r.summaryData.length),1)]),t("div",ht,[c[1]||(c[1]=t("div",{class:"stat-title"},"Total Sales",-1)),t("div",gt," $"+l(p(b.value)),1)]),t("div",mt,[c[2]||(c[2]=t("div",{class:"stat-title"},"Total Budget",-1)),t("div",bt," $"+l(p(a.value)),1)]),t("div",qt,[c[3]||(c[3]=t("div",{class:"stat-title"},"Growth",-1)),t("div",pt,l(y.value.toFixed(2))+"% ",1)])]))}},ft={key:0,class:"mt-10 bg-base-100 shadow-md rounded-xl"},vt={class:"text-lg px-6 py-3 bg-primary text-primary-content rounded-t-xl"},xt={class:"overflow-x-auto rounded-xl"},wt={class:"table table-zebra text-sm"},St={class:"join"},$t=["onClick"],Ft=["onClick"],Dt={class:"text-xs opacity-70"},kt={class:"text-right"},Bt={class:"text-right"},Nt={class:"text-right"},zt={class:"text-right"},Vt={class:"text-right"},Ct={class:"text-right font-bold"},Ht={class:"text-right"},Mt={class:"text-xs opacity-60"},Tt={class:"text-right"},At={class:"text-right"},jt={class:"text-right"},Qt={class:"text-right"},Pt={class:"text-right"},Rt={class:"text-right font-bold"},Lt={class:"text-right"},Ut={class:"font-bold bg-secondary text-secondary-content [&:nth-child(even)]:bg-secondary [&:nth-child(odd)]:bg-secondary"},Et={class:"text-right"},Gt={class:"text-right"},It={class:"text-right"},Ot={class:"text-right"},Wt={class:"text-right"},Kt={class:"text-right"},Zt={class:"text-right"},Jt={class:"text-xs opacity-70"},Xt={class:"text-right"},Yt={class:"text-right"},te={class:"text-right"},ee={class:"text-right"},se={class:"text-right"},ae={class:"text-right"},oe={class:"text-right"},J={__name:"SalespersonTable",props:{data:{type:Array,required:!0,default:()=>[]},subtotals:{type:Object,required:!0},title:{type:String,required:!0},type:{type:String,required:!0,validator:r=>["hospitality","non-hospitality"].includes(r)}},emits:["view-salesperson","download-salesperson"],setup(r,{emit:g}){const b=g,a=y=>new Intl.NumberFormat("en-US",{minimumFractionDigits:0,maximumFractionDigits:0}).format(y||0);return(y,p)=>r.data.length?(D(),k("div",ft,[t("h2",vt,l(r.title)+" ("+l(r.data.length)+") ",1),t("div",xt,[t("table",wt,[p[1]||(p[1]=t("thead",null,[t("tr",null,[t("th"),t("th",null,"Salesperson"),t("th",null,"Q1 Sales"),t("th",null,"Q2 Sales"),t("th",null,"Q3 Sales"),t("th",null,"Q4 Sales"),t("th",null,"Q4 Orders"),t("th",null,"Total Sales"),t("th",null,"0% Sales (Rate)"),t("th",null,"2026 Open"),t("th",null,"Q1 Budget"),t("th",null,"Q2 Budget"),t("th",null,"Q3 Budget"),t("th",null,"Q4 Budget"),t("th",null,"Total Budget"),t("th",null,"Growth")])],-1)),t("tbody",null,[(D(!0),k(st,null,at(r.data,n=>(D(),k("tr",{key:n.salesperson_id,class:"hover"},[t("td",null,[t("div",St,[t("button",{onClick:c=>b("view-salesperson",n.salesperson_id),class:"btn btn-xs btn-ghost join-item",title:"View"}," ðŸ‘ï¸ ",8,$t),t("button",{onClick:c=>b("download-salesperson",n.salesperson_id,n.salesperson_name),class:"btn btn-xs btn-ghost join-item",title:"Download"}," â¬‡ï¸ ",8,Ft)])]),t("td",null,[j(l(n.salesperson_name)+" ",1),t("div",Dt," ID: "+l(n.salesperson_id),1)]),t("td",kt," $"+l(a(n.q1_sales)),1),t("td",Bt," $"+l(a(n.q2_sales)),1),t("td",Nt," $"+l(a(n.q3_sales)),1),t("td",zt," $"+l(a(n.q4_sales)),1),t("td",Vt," $"+l(a(n.q4_orders)),1),t("td",Ct," $"+l(a(n.total_sales)),1),t("td",Ht,[j(" $"+l(a(n.zero_perc_sales))+" ",1),t("div",Mt," ("+l(n.zero_perc_sales_percent.toFixed(2))+"%) ",1)]),t("td",Tt," $"+l(a(n.open_2026)),1),t("td",At," $"+l(a(n.q1_budget)),1),t("td",jt," $"+l(a(n.q2_budget)),1),t("td",Qt," $"+l(a(n.q3_budget)),1),t("td",Pt," $"+l(a(n.q4_budget)),1),t("td",Rt," $"+l(a(n.total_budget)),1),t("td",Lt,l(n.total_sales!==0?((n.total_budget-n.total_sales)/n.total_sales*100).toFixed(2):"0.00")+"% ",1)]))),128)),t("tr",Ut,[p[0]||(p[0]=t("td",{colspan:"2",class:"text-center"},"Subtotal",-1)),t("td",Et," $"+l(a(r.subtotals.q1_sales)),1),t("td",Gt," $"+l(a(r.subtotals.q2_sales)),1),t("td",It," $"+l(a(r.subtotals.q3_sales)),1),t("td",Ot," $"+l(a(r.subtotals.q4_sales)),1),t("td",Wt," $"+l(a(r.subtotals.q4_orders)),1),t("td",Kt," $"+l(a(r.subtotals.total_sales)),1),t("td",Zt,[j(" $"+l(a(r.subtotals.zero_perc_sales))+" ",1),t("div",Jt," ("+l(r.subtotals.zero_perc_sales_percent.toFixed(2))+"%) ",1)]),t("td",Xt," $"+l(a(r.subtotals.open_2026)),1),t("td",Yt," $"+l(a(r.subtotals.q1_budget)),1),t("td",te," $"+l(a(r.subtotals.q2_budget)),1),t("td",ee," $"+l(a(r.subtotals.q3_budget)),1),t("td",se," $"+l(a(r.subtotals.q4_budget)),1),t("td",ae," $"+l(a(r.subtotals.total_budget)),1),t("td",oe,l(r.subtotals.total_sales!==0?((r.subtotals.total_budget-r.subtotals.total_sales)/r.subtotals.total_sales*100).toFixed(2):"0.00")+"% ",1)])])])])])):T("",!0)}};function le(){const r=ot(),g=Q(!1),b=Q(null),a=Q([]),y=v(()=>a.value.reduce((e,s)=>e+s.total_sales,0)),p=v(()=>a.value.reduce((e,s)=>e+s.total_budget,0)),n=v(()=>y.value===0?0:(p.value-y.value)/y.value*100),c=v(()=>a.value.filter(e=>e.role&&e.role.toLowerCase().startsWith("hospitality"))),z=v(()=>a.value.filter(e=>!e.role||!e.role.toLowerCase().startsWith("hospitality")));function V(e){if(!e.length)return{q1_sales:0,q2_sales:0,q3_sales:0,q4_sales:0,q4_orders:0,total_sales:0,zero_perc_sales:0,zero_perc_sales_percent:0,open_2026:0,q1_budget:0,q2_budget:0,q3_budget:0,q4_budget:0,total_budget:0,growth_percent:0};const s=e.reduce((i,u)=>(i.q1_sales+=u.q1_sales,i.q2_sales+=u.q2_sales,i.q3_sales+=u.q3_sales,i.q4_sales+=u.q4_sales,i.q4_orders+=u.q4_orders,i.zero_perc_sales+=u.zero_perc_sales,i.open_2026+=u.open_2026,i.q1_budget+=u.q1_budget,i.q2_budget+=u.q2_budget,i.q3_budget+=u.q3_budget,i.q4_budget+=u.q4_budget,i),{q1_sales:0,q2_sales:0,q3_sales:0,q4_sales:0,q4_orders:0,zero_perc_sales:0,open_2026:0,q1_budget:0,q2_budget:0,q3_budget:0,q4_budget:0});return s.total_sales=s.q1_sales+s.q2_sales+s.q3_sales+s.q4_sales+s.q4_orders,s.total_budget=s.q1_budget+s.q2_budget+s.q3_budget+s.q4_budget,s.growth_percent=s.total_sales!==0?(s.total_budget-s.total_sales)/s.total_sales*100:0,s.zero_perc_sales_percent=s.total_sales?s.zero_perc_sales/s.total_sales*100:0,s}const C=v(()=>V(c.value)),H=v(()=>V(z.value)),A=e=>{if(e==null)return 0;if(typeof e=="number")return e;if(typeof e=="string"){const s=e.replace(/[%$,]/g,"").trim(),i=parseFloat(s);return Number.isNaN(i)?0:i}return 0},h=(e,s)=>{const i=Array.isArray(s)?s:[s];return e.reduce((u,f)=>{for(const m of i)if(f[m]!==void 0&&f[m]!==null){u+=A(f[m]);break}return u},0)},B=(e,s={})=>{if(!e?.length)return null;const i={salesperson_name:"Total",salesperson_id:"",role:"",brand:"",flag:"",derived_customer_class:"",customer_name:""},u=h(e,"q1_sales"),f=h(e,"q2_sales"),m=h(e,"q3_sales"),w=h(e,"q4_sales"),x=h(e,"q4_orders"),S=h(e,"total_sales"),o=u+f+m+w+x,d=S!==0?S:o,$=h(e,["zero_perc_sales_total","zero_perc_sales"]),M=h(e,"open_2026"),N=h(e,"q1_budget"),F=h(e,"q2_budget"),L=h(e,"q3_budget"),U=h(e,"q4_budget"),E=N+F+L+U,tt=h(e,"total_budget"),et=E!==0?E:tt,G=d!==0?$/d*100:0,I=d!==0?((et||0)-d)/d*100:0;return{...i,...s,q1_sales:_(u),q2_sales:_(f),q3_sales:_(m),q4_sales:_(w),q4_orders:_(x),total_sales:_(d),zero_perc_sales_total:_($),zero_perc_sales_percent:Number.isFinite(G)?G.toFixed(2):"0.00",open_2026:_(M),q1_budget:_(N),q2_budget:_(F),q3_budget:_(L),q4_budget:_(U),growth_percent:Number.isFinite(I)?I.toFixed(2):"0.00"}};async function P(){g.value=!0,b.value=null;try{const e=await r.apiCall("/api/admin/summary");if(!e.ok)throw new Error("Failed to fetch admin summary");const s=await e.json();a.value=s.data||[]}catch(e){b.value=e.message,console.error(e)}finally{g.value=!1}}async function R(e){try{const s=await r.apiCall(`/api/sales/${e}`);if(!s.ok)throw new Error("Failed to fetch sales data");const i=await s.json(),u=await r.apiCall(`/api/budget/${e}`);if(!u.ok)throw new Error("Failed to fetch budget data");const f=await u.json(),m=a.value.find(o=>o.salesperson_id===e),w=new Set,x=i.data.map(o=>{const d=f.data.find(F=>F.brand===o.brand&&F.flag===o.flag&&F.customer_name===o.customer_name);if(d){const F=`${d.brand||"null"}_${d.flag||"null"}_${d.customer_name||"null"}`;w.add(F)}const $=(parseFloat(o.q1_sales)||0)+(parseFloat(o.q2_sales)||0)+(parseFloat(o.q3_sales)||0)+(parseFloat(o.q4_sales)||0)+(parseFloat(o.q4_orders)||0),M=d?(parseFloat(d.quarter_1_sales)||0)+(parseFloat(d.quarter_2_sales)||0)+(parseFloat(d.quarter_3_sales)||0)+(parseFloat(d.quarter_4_sales)||0):0,N=$!==0&&!isNaN($)&&!isNaN(M)?(M-$)/$*100:0;return{...o,salesperson_id:e,salesperson_name:m?.salesperson_name||"Unknown",role:m?.role||"Unknown",q1_budget:d?_(d.quarter_1_sales):"0.00",q2_budget:d?_(d.quarter_2_sales):"0.00",q3_budget:d?_(d.quarter_3_sales):"0.00",q4_budget:d?_(d.quarter_4_sales):"0.00",open_2026:_(o.open_2026),growth_percent:isNaN(N)?"0.00":N.toFixed(2)}}),S=f.data.filter(o=>{if(!o.is_custom)return!1;const d=`${o.brand||"null"}_${o.flag||"null"}_${o.customer_name||"null"}`;return!w.has(d)}).map(o=>{const d=(parseFloat(o.quarter_1_sales)||0)+(parseFloat(o.quarter_2_sales)||0)+(parseFloat(o.quarter_3_sales)||0)+(parseFloat(o.quarter_4_sales)||0),$=o.customer_class&&o.customer_class.toLowerCase().startsWith("hospitality");return{salesperson_id:e,salesperson_name:m?.salesperson_name||"Unknown",role:m?.role||"Unknown",brand:o.brand||"",flag:o.flag||"",derived_customer_class:o.customer_class||"",customer_name:o.customer_name||"",q1_sales:"0.00",q2_sales:"0.00",q3_sales:"0.00",q4_sales:"0.00",q4_orders:"0.00",total_sales:"0.00",zero_perc_sales_total:"0.00",zero_perc_sales_percent:"0.00",open_2026:"0.00",q1_budget:_(o.quarter_1_sales),q2_budget:_(o.quarter_2_sales),q3_budget:_(o.quarter_3_sales),q4_budget:_(o.quarter_4_sales),growth_percent:d>0?"100.00":"0.00"}});return[...x,...S]}catch(s){return console.error(s),[]}}async function X(e,s){const i=await R(e);if(!i.length)return alert("No data available");const f=a.value.find(o=>o.salesperson_id===e)?.role?.toLowerCase().startsWith("hospitality"),m=K(f),w=`${s.replace(/[^a-zA-Z0-9]/g,"_")}_budget_${new Date().toISOString().split("T")[0]}.csv`,x=B(i,{salesperson_name:"Total",role:""}),S=x?[...i,x]:i;Z(S,m,w)}async function Y(){if(!a.value.length)return alert("No data available");try{const e=g.value;g.value=!0;const s=[];for(const o of a.value){const d=await R(o.salesperson_id);s.push(...d)}if(!s.length){alert("No data available");return}const i=s.some(o=>o.role?.toLowerCase().startsWith("hospitality")),u=s.some(o=>!o.role?.toLowerCase().startsWith("hospitality")),m=K(i,i&&u),w=`full_budget_sheet_${new Date().toISOString().split("T")[0]}.csv`,x=B(s,{salesperson_name:"Grand Total"}),S=x?[...s,x]:s;Z(S,m,w)}catch(e){console.error("Error downloading full budget sheet:",e),alert("Error downloading budget sheet. Please try again.")}finally{g.value=!1}}return{loading:g,error:b,summaryData:a,totalSales:y,totalBudget:p,totalGrowthPercent:n,hospitalityData:c,nonHospitalityData:z,hospitalitySubtotals:C,nonHospitalitySubtotals:H,fetchAdminSummary:P,downloadSalespersonData:X,downloadFullBudgetSheet:Y}}const ne={class:"p-6 space-y-6"},re={key:0},ue={__name:"AdminView",setup(r){const g=rt(),b=nt("navActions"),{loading:a,error:y,summaryData:p,hospitalityData:n,nonHospitalityData:c,hospitalitySubtotals:z,nonHospitalitySubtotals:V,fetchAdminSummary:C,downloadSalespersonData:H,downloadFullBudgetSheet:A}=le();function h(B){g.push(`/salesperson/${B}`)}return lt(()=>{C(),b.set([{id:"division-view",text:"Division View",class:"btn btn-secondary mr-2",handler:()=>g.push("/division"),icon:'<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>'},{id:"gross-profit-view",text:"Gross Profit View",class:"btn btn-accent mr-2",handler:()=>g.push("/gross-profit"),icon:'<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"/>'},{id:"download-full-budget",text:"Download Full Budget Sheet",class:"btn btn-primary",disabled:v(()=>a.value||!p.value.length),handler:A,icon:'<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>'}])}),dt(()=>b.clear()),(B,P)=>(D(),k("div",ne,[O(it,{loading:q(a),error:q(y),onRetry:q(C)},null,8,["loading","error","onRetry"]),!q(a)&&!q(y)?(D(),k("div",re,[O(yt,{"summary-data":q(p)},null,8,["summary-data"]),q(n).length?(D(),W(J,{key:0,data:q(n),subtotals:q(z),title:"Hospitality Salespeople",type:"hospitality",onViewSalesperson:h,onDownloadSalesperson:q(H)},null,8,["data","subtotals","onDownloadSalesperson"])):T("",!0),q(c).length?(D(),W(J,{key:1,data:q(c),subtotals:q(V),title:"Non-Hospitality Salespeople",type:"non-hospitality",onViewSalesperson:h,onDownloadSalesperson:q(H)},null,8,["data","subtotals","onDownloadSalesperson"])):T("",!0)])):T("",!0)]))}};export{ue as default};
