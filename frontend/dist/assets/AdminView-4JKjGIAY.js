import{c as y,b as f,g as p,f as t,t as o,h as w,F as I,j as O,k as z,u as G,r as Q,o as W,i as M,a as P,d as V,e as m,l as H,m as Z}from"./index-BwlVtp6Q.js";const J={class:"grid sm:grid-cols-2 lg:grid-cols-4 gap-4"},K={class:"stat bg-base-100 shadow rounded-xl"},X={class:"stat-value text-primary"},Y={class:"stat bg-base-100 shadow rounded-xl"},tt={class:"stat-value text-primary"},et={class:"stat bg-base-100 shadow rounded-xl"},st={class:"stat-value text-primary"},at={class:"stat bg-base-100 shadow rounded-xl"},lt={class:"stat-value text-primary"},ot={__name:"AdminStats",props:{summaryData:{type:Array,required:!0,default:()=>[]}},setup(e){const d=e,n=y(()=>d.summaryData.reduce((a,c)=>a+c.total_sales,0)),s=y(()=>d.summaryData.reduce((a,c)=>a+c.total_budget,0)),_=y(()=>n.value===0?0:(s.value-n.value)/n.value*100),i=a=>new Intl.NumberFormat("en-US",{minimumFractionDigits:0,maximumFractionDigits:0}).format(a||0);return(a,c)=>(p(),f("div",J,[t("div",K,[c[0]||(c[0]=t("div",{class:"stat-title"},"Total Salespeople",-1)),t("div",X,o(e.summaryData.length),1)]),t("div",Y,[c[1]||(c[1]=t("div",{class:"stat-title"},"Total Sales",-1)),t("div",tt," $"+o(i(n.value)),1)]),t("div",et,[c[2]||(c[2]=t("div",{class:"stat-title"},"Total Budget",-1)),t("div",st," $"+o(i(s.value)),1)]),t("div",at,[c[3]||(c[3]=t("div",{class:"stat-title"},"Growth",-1)),t("div",lt,o(_.value.toFixed(2))+"% ",1)])]))}},nt={key:0,class:"flex flex-col items-center justify-center py-20"},rt={key:1,class:"alert alert-error flex flex-col items-center text-center"},it={class:"text-sm mb-4"},dt={__name:"LoadingError",props:{loading:{type:Boolean,required:!0},error:{type:String,default:null}},emits:["retry"],setup(e){return(d,n)=>e.loading?(p(),f("div",nt,[...n[1]||(n[1]=[t("span",{class:"loading loading-spinner loading-lg text-primary"},null,-1),t("p",{class:"mt-4 text-base text-gray-600 dark:text-gray-300"}," Loading admin summary... ",-1)])])):e.error?(p(),f("div",rt,[n[2]||(n[2]=t("h3",{class:"font-bold text-lg"},"Error loading data",-1)),t("p",it,o(e.error),1),t("button",{class:"btn btn-sm btn-error",onClick:n[0]||(n[0]=s=>d.$emit("retry"))}," Retry ")])):w("",!0)}},ut={key:0,class:"mt-10 bg-base-100 shadow-md rounded-xl"},ct={class:"text-lg px-6 py-3 bg-primary text-primary-content rounded-t-xl"},_t={class:"overflow-x-auto rounded-xl"},gt={class:"table table-zebra text-sm"},bt={class:"join"},ht=["onClick"],mt=["onClick"],yt={class:"text-xs opacity-70"},pt={class:"text-right"},ft={class:"text-right"},qt={class:"text-right"},vt={class:"text-right"},xt={class:"text-right font-bold"},wt={class:"text-right"},St={class:"text-xs opacity-60"},$t={class:"text-right"},kt={class:"text-right"},Ft={class:"text-right"},Dt={class:"text-right"},Ct={class:"text-right font-bold"},Bt={class:"text-right"},Nt={class:"font-bold bg-secondary text-secondary-content [&:nth-child(even)]:bg-secondary [&:nth-child(odd)]:bg-secondary"},jt={class:"text-right"},zt={class:"text-right"},Qt={class:"text-right"},Rt={class:"text-right"},At={class:"text-right"},Lt={class:"text-right"},Vt={class:"text-xs opacity-70"},Ht={class:"text-right"},Tt={class:"text-right"},Et={class:"text-right"},Ut={class:"text-right"},It={class:"text-right"},Ot={class:"text-right"},T={__name:"SalespersonTable",props:{data:{type:Array,required:!0,default:()=>[]},subtotals:{type:Object,required:!0},title:{type:String,required:!0},type:{type:String,required:!0,validator:e=>["hospitality","non-hospitality"].includes(e)}},emits:["view-salesperson","download-salesperson"],setup(e,{emit:d}){const n=d,s=_=>new Intl.NumberFormat("en-US",{minimumFractionDigits:0,maximumFractionDigits:0}).format(_||0);return(_,i)=>e.data.length?(p(),f("div",ut,[t("h2",ct,o(e.title)+" ("+o(e.data.length)+") ",1),t("div",_t,[t("table",gt,[i[1]||(i[1]=t("thead",null,[t("tr",null,[t("th"),t("th",null,"Salesperson"),t("th",null,"Q1 Sales"),t("th",null,"Q2 Sales"),t("th",null,"Q3 Sales"),t("th",null,"Q4 Orders"),t("th",null,"Total Sales"),t("th",null,"0% Sales (Rate)"),t("th",null,"Q1 Budget"),t("th",null,"Q2 Budget"),t("th",null,"Q3 Budget"),t("th",null,"Q4 Budget"),t("th",null,"Total Budget"),t("th",null,"Growth")])],-1)),t("tbody",null,[(p(!0),f(I,null,O(e.data,a=>(p(),f("tr",{key:a.salesperson_id,class:"hover"},[t("td",null,[t("div",bt,[t("button",{onClick:c=>n("view-salesperson",a.salesperson_id),class:"btn btn-xs btn-ghost join-item",title:"View"}," 👁️ ",8,ht),t("button",{onClick:c=>n("download-salesperson",a.salesperson_id,a.salesperson_name),class:"btn btn-xs btn-ghost join-item",title:"Download"}," ⬇️ ",8,mt)])]),t("td",null,[z(o(a.salesperson_name)+" ",1),t("div",yt," ID: "+o(a.salesperson_id),1)]),t("td",pt," $"+o(s(a.q1_sales)),1),t("td",ft," $"+o(s(a.q2_sales)),1),t("td",qt," $"+o(s(a.q3_sales)),1),t("td",vt," $"+o(s(a.q4_sales)),1),t("td",xt," $"+o(s(a.total_sales)),1),t("td",wt,[z(" $"+o(s(a.zero_perc_sales))+" ",1),t("div",St," ("+o(a.zero_perc_sales_percent.toFixed(2))+"%) ",1)]),t("td",$t," $"+o(s(a.q1_budget)),1),t("td",kt," $"+o(s(a.q2_budget)),1),t("td",Ft," $"+o(s(a.q3_budget)),1),t("td",Dt," $"+o(s(a.q4_budget)),1),t("td",Ct," $"+o(s(a.total_budget)),1),t("td",Bt,o(a.total_sales!==0?((a.total_budget-a.total_sales)/a.total_sales*100).toFixed(2):"0.00")+"% ",1)]))),128)),t("tr",Nt,[i[0]||(i[0]=t("td",{colspan:"2",class:"text-center"},"Subtotal",-1)),t("td",jt," $"+o(s(e.subtotals.q1_sales)),1),t("td",zt," $"+o(s(e.subtotals.q2_sales)),1),t("td",Qt," $"+o(s(e.subtotals.q3_sales)),1),t("td",Rt," $"+o(s(e.subtotals.q4_sales)),1),t("td",At," $"+o(s(e.subtotals.total_sales)),1),t("td",Lt,[z(" $"+o(s(e.subtotals.zero_perc_sales))+" ",1),t("div",Vt," ("+o(e.subtotals.zero_perc_sales_percent.toFixed(2))+"%) ",1)]),t("td",Ht," $"+o(s(e.subtotals.q1_budget)),1),t("td",Tt," $"+o(s(e.subtotals.q2_budget)),1),t("td",Et," $"+o(s(e.subtotals.q3_budget)),1),t("td",Ut," $"+o(s(e.subtotals.q4_budget)),1),t("td",It," $"+o(s(e.subtotals.total_budget)),1),t("td",Ot,o(e.subtotals.total_sales!==0?((e.subtotals.total_budget-e.subtotals.total_sales)/e.subtotals.total_sales*100).toFixed(2):"0.00")+"% ",1)])])])])])):w("",!0)}};function Gt(e,d){if(!e||e.length===0)return"";const n=d.map(_=>`"${_.label}"`).join(","),s=e.map(_=>d.map(i=>{const a=_[i.key];return a==null?'""':`"${String(a).replace(/"/g,'""')}"`}).join(","));return[n,...s].join(`
`)}function E(e,d,n){const s=Gt(e,d),_=new Blob([s],{type:"text/csv;charset=utf-8;"}),i=document.createElement("a");if(i.download!==void 0){const a=URL.createObjectURL(_);i.setAttribute("href",a),i.setAttribute("download",n),i.style.visibility="hidden",document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(a)}}function B(e){return e==null||isNaN(e)?"0.00":parseFloat(e).toFixed(2)}function U(e,d=!1){const n=[{key:"salesperson_name",label:"Salesperson Name"},{key:"salesperson_id",label:"Salesperson ID"},{key:"role",label:"Role"}];return d?n.push({key:"brand",label:"Brand"},{key:"flag",label:"Flag"},{key:"derived_customer_class",label:"Customer Class"},{key:"customer_name",label:"Customer Name"}):e?n.push({key:"brand",label:"Brand"},{key:"flag",label:"Flag"}):n.push({key:"derived_customer_class",label:"Customer Class"},{key:"customer_name",label:"Customer Name"}),n.push({key:"q1_sales",label:"Q1 Sales"},{key:"q2_sales",label:"Q2 Sales"},{key:"q3_sales",label:"Q3 Sales"},{key:"q4_sales",label:"Q4 Sales"},{key:"total_sales",label:"Total Sales"},{key:"zero_perc_sales_total",label:"Zero % Sales"},{key:"zero_perc_sales_percent",label:"Zero % %"},{key:"q1_budget",label:"Q1 Budget"},{key:"q2_budget",label:"Q2 Budget"},{key:"q3_budget",label:"Q3 Budget"},{key:"q4_budget",label:"Q4 Budget"},{key:"growth_percent",label:"Growth"}),n}function Wt(){const e=G(),d=Q(!1),n=Q(null),s=Q([]),_=y(()=>s.value.reduce((r,l)=>r+l.total_sales,0)),i=y(()=>s.value.reduce((r,l)=>r+l.total_budget,0)),a=y(()=>_.value===0?0:(i.value-_.value)/_.value*100),c=y(()=>s.value.filter(r=>r.role&&r.role.toLowerCase().startsWith("hospitality"))),S=y(()=>s.value.filter(r=>!r.role||!r.role.toLowerCase().startsWith("hospitality")));function $(r){if(!r.length)return{q1_sales:0,q2_sales:0,q3_sales:0,q4_sales:0,total_sales:0,zero_perc_sales:0,zero_perc_sales_percent:0,q1_budget:0,q2_budget:0,q3_budget:0,q4_budget:0,total_budget:0,growth_percent:0};const l=r.reduce((g,b)=>(g.q1_sales+=b.q1_sales,g.q2_sales+=b.q2_sales,g.q3_sales+=b.q3_sales,g.q4_sales+=b.q4_sales,g.zero_perc_sales+=b.zero_perc_sales,g.q1_budget+=b.q1_budget,g.q2_budget+=b.q2_budget,g.q3_budget+=b.q3_budget,g.q4_budget+=b.q4_budget,g),{q1_sales:0,q2_sales:0,q3_sales:0,q4_sales:0,zero_perc_sales:0,q1_budget:0,q2_budget:0,q3_budget:0,q4_budget:0});return l.total_sales=l.q1_sales+l.q2_sales+l.q3_sales+l.q4_sales,l.total_budget=l.q1_budget+l.q2_budget+l.q3_budget+l.q4_budget,l.growth_percent=l.total_sales!==0?(l.total_budget-l.total_sales)/l.total_sales*100:0,l.zero_perc_sales_percent=l.total_sales?l.zero_perc_sales/l.total_sales*100:0,l}const k=y(()=>$(c.value)),F=y(()=>$(S.value));async function N(){d.value=!0,n.value=null;try{const r=await e.apiCall("/api/admin/summary");if(!r.ok)throw new Error("Failed to fetch admin summary");const l=await r.json();s.value=l.data||[]}catch(r){n.value=r.message,console.error(r)}finally{d.value=!1}}async function x(r){try{const l=await e.apiCall(`/api/sales/${r}`);if(!l.ok)throw new Error("Failed to fetch sales data");const g=await l.json(),b=await e.apiCall(`/api/budget/${r}`);if(!b.ok)throw new Error("Failed to fetch budget data");const C=await b.json(),q=s.value.find(h=>h.salesperson_id===r);return g.data.map(h=>{const u=C.data.find(j=>j.brand===h.brand&&j.flag===h.flag&&j.customer_name===h.customer_name),v=(parseFloat(h.q1_sales)||0)+(parseFloat(h.q2_sales)||0)+(parseFloat(h.q3_sales)||0)+(parseFloat(h.q4_sales)||0),A=u?(parseFloat(u.quarter_1_sales)||0)+(parseFloat(u.quarter_2_sales)||0)+(parseFloat(u.quarter_3_sales)||0)+(parseFloat(u.quarter_4_sales)||0):0,L=v!==0&&!isNaN(v)&&!isNaN(A)?(A-v)/v*100:0;return{...h,salesperson_id:r,salesperson_name:q?.salesperson_name||"Unknown",role:q?.role||"Unknown",q1_budget:u?B(u.quarter_1_sales):"0.00",q2_budget:u?B(u.quarter_2_sales):"0.00",q3_budget:u?B(u.quarter_3_sales):"0.00",q4_budget:u?B(u.quarter_4_sales):"0.00",growth_percent:isNaN(L)?"0.00":L.toFixed(2)}})}catch(l){return console.error(l),[]}}async function D(r,l){const g=await x(r);if(!g.length)return alert("No data available");const C=s.value.find(u=>u.salesperson_id===r)?.role?.toLowerCase().startsWith("hospitality"),q=U(C),h=`${l.replace(/[^a-zA-Z0-9]/g,"_")}_budget_${new Date().toISOString().split("T")[0]}.csv`;E(g,q,h)}async function R(){if(!s.value.length)return alert("No data available");try{const r=d.value;d.value=!0;const l=[];for(const u of s.value){const v=await x(u.salesperson_id);l.push(...v)}if(!l.length){alert("No data available");return}const g=l.some(u=>u.role?.toLowerCase().startsWith("hospitality")),b=l.some(u=>!u.role?.toLowerCase().startsWith("hospitality")),q=U(g,g&&b),h=`full_budget_sheet_${new Date().toISOString().split("T")[0]}.csv`;E(l,q,h)}catch(r){console.error("Error downloading full budget sheet:",r),alert("Error downloading budget sheet. Please try again.")}finally{d.value=!1}}return{loading:d,error:n,summaryData:s,totalSales:_,totalBudget:i,totalGrowthPercent:a,hospitalityData:c,nonHospitalityData:S,hospitalitySubtotals:k,nonHospitalitySubtotals:F,fetchAdminSummary:N,downloadSalespersonData:D,downloadFullBudgetSheet:R}}const Mt={class:"p-6 space-y-6"},Pt={key:0},Jt={__name:"AdminView",setup(e){const d=Z(),n=M("navActions"),{loading:s,error:_,summaryData:i,hospitalityData:a,nonHospitalityData:c,hospitalitySubtotals:S,nonHospitalitySubtotals:$,fetchAdminSummary:k,downloadSalespersonData:F,downloadFullBudgetSheet:N}=Wt();function x(D){d.push(`/salesperson/${D}`)}return W(()=>{k(),n.set([{id:"download-full-budget",text:"Download Full Budget Sheet",class:"btn btn-primary",disabled:y(()=>s.value||!i.value.length),handler:N,icon:'<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>'}])}),P(()=>n.clear()),(D,R)=>(p(),f("div",Mt,[V(dt,{loading:m(s),error:m(_),onRetry:m(k)},null,8,["loading","error","onRetry"]),!m(s)&&!m(_)?(p(),f("div",Pt,[V(ot,{"summary-data":m(i)},null,8,["summary-data"]),m(a).length?(p(),H(T,{key:0,data:m(a),subtotals:m(S),title:"Hospitality Salespeople",type:"hospitality",onViewSalesperson:x,onDownloadSalesperson:m(F)},null,8,["data","subtotals","onDownloadSalesperson"])):w("",!0),m(c).length?(p(),H(T,{key:1,data:m(c),subtotals:m($),title:"Non-Hospitality Salespeople",type:"non-hospitality",onViewSalesperson:x,onDownloadSalesperson:m(F)},null,8,["data","subtotals","onDownloadSalesperson"])):w("",!0)])):w("",!0)]))}};export{Jt as default};
