import{c as S,b as D,g as $,f as t,t as o,h as C,F as st,j as at,k as M,u as ot,r as T,o as lt,i as nt,l as rt,a as dt,d as O,e as m,m as U}from"./index-UPDjkweO.js";import{g as W,d as K,f as _,_ as it}from"./downloadUtils-B60Cz8UM.js";const ut={class:"grid sm:grid-cols-2 lg:grid-cols-4 gap-4"},ct={class:"stat bg-base-100 shadow rounded-xl"},_t={class:"stat-value text-primary"},ht={class:"stat bg-base-100 shadow rounded-xl"},gt={class:"stat-value text-primary"},bt={class:"stat bg-base-100 shadow rounded-xl"},mt={class:"stat-value text-primary"},qt={class:"stat bg-base-100 shadow rounded-xl"},pt={class:"stat-value text-primary"},yt={__name:"AdminStats",props:{summaryData:{type:Array,required:!0,default:()=>[]}},setup(n){const g=n,b=S(()=>g.summaryData.reduce((l,u)=>l+u.total_sales,0)),a=S(()=>g.summaryData.reduce((l,u)=>l+u.total_budget,0)),y=S(()=>b.value===0?0:(a.value-b.value)/b.value*100),q=l=>new Intl.NumberFormat("en-US",{minimumFractionDigits:0,maximumFractionDigits:0}).format(l||0);return(l,u)=>($(),D("div",ut,[t("div",ct,[u[0]||(u[0]=t("div",{class:"stat-title"},"Total Salespeople",-1)),t("div",_t,o(n.summaryData.length),1)]),t("div",ht,[u[1]||(u[1]=t("div",{class:"stat-title"},"Total Sales",-1)),t("div",gt," $"+o(q(b.value)),1)]),t("div",bt,[u[2]||(u[2]=t("div",{class:"stat-title"},"Total Budget",-1)),t("div",mt," $"+o(q(a.value)),1)]),t("div",qt,[u[3]||(u[3]=t("div",{class:"stat-title"},"Growth",-1)),t("div",pt,o(y.value.toFixed(2))+"% ",1)])]))}},ft={key:0,class:"mt-10 bg-base-100 shadow-md rounded-xl"},vt={class:"text-lg px-6 py-3 bg-primary text-primary-content rounded-t-xl"},xt={class:"overflow-x-auto rounded-xl"},wt={class:"table table-zebra text-sm"},St={class:"join"},$t=["onClick"],Ft=["onClick"],Dt={class:"text-xs opacity-70"},kt={class:"text-right"},Nt={class:"text-right"},Bt={class:"text-right"},zt={class:"text-right"},Vt={class:"text-right"},Ct={class:"text-right font-bold"},Ht={class:"text-right"},Mt={class:"text-xs opacity-60"},Tt={class:"text-right"},At={class:"text-right"},jt={class:"text-right"},Qt={class:"text-right"},Pt={class:"text-right"},Rt={class:"text-right font-bold"},Lt={class:"text-right"},Et={class:"font-bold bg-secondary text-secondary-content [&:nth-child(even)]:bg-secondary [&:nth-child(odd)]:bg-secondary"},Gt={class:"text-right"},It={class:"text-right"},Ot={class:"text-right"},Ut={class:"text-right"},Wt={class:"text-right"},Kt={class:"text-right"},Zt={class:"text-right"},Jt={class:"text-xs opacity-70"},Xt={class:"text-right"},Yt={class:"text-right"},te={class:"text-right"},ee={class:"text-right"},se={class:"text-right"},ae={class:"text-right"},oe={class:"text-right"},Z={__name:"SalespersonTable",props:{data:{type:Array,required:!0,default:()=>[]},subtotals:{type:Object,required:!0},title:{type:String,required:!0},type:{type:String,required:!0,validator:n=>["hospitality","non-hospitality"].includes(n)}},emits:["view-salesperson","download-salesperson"],setup(n,{emit:g}){const b=g,a=y=>new Intl.NumberFormat("en-US",{minimumFractionDigits:0,maximumFractionDigits:0}).format(y||0);return(y,q)=>n.data.length?($(),D("div",ft,[t("h2",vt,o(n.title)+" ("+o(n.data.length)+") ",1),t("div",xt,[t("table",wt,[q[1]||(q[1]=t("thead",null,[t("tr",null,[t("th"),t("th",null,"Salesperson"),t("th",null,"Q1 Sales"),t("th",null,"Q2 Sales"),t("th",null,"Q3 Sales"),t("th",null,"Q4 Sales"),t("th",null,"Q4 Orders"),t("th",null,"Total Sales"),t("th",null,"0% Sales (Rate)"),t("th",null,"2026 Open"),t("th",null,"Q1 Budget"),t("th",null,"Q2 Budget"),t("th",null,"Q3 Budget"),t("th",null,"Q4 Budget"),t("th",null,"Total Budget"),t("th",null,"Growth")])],-1)),t("tbody",null,[($(!0),D(st,null,at(n.data,l=>($(),D("tr",{key:l.salesperson_id,class:"hover"},[t("td",null,[t("div",St,[t("button",{onClick:u=>b("view-salesperson",l.salesperson_id),class:"btn btn-xs btn-ghost join-item",title:"View"}," ðŸ‘ï¸ ",8,$t),t("button",{onClick:u=>b("download-salesperson",l.salesperson_id,l.salesperson_name),class:"btn btn-xs btn-ghost join-item",title:"Download"}," â¬‡ï¸ ",8,Ft)])]),t("td",null,[M(o(l.salesperson_name)+" ",1),t("div",Dt," ID: "+o(l.salesperson_id),1)]),t("td",kt," $"+o(a(l.q1_sales)),1),t("td",Nt," $"+o(a(l.q2_sales)),1),t("td",Bt," $"+o(a(l.q3_sales)),1),t("td",zt," $"+o(a(l.q4_sales)),1),t("td",Vt," $"+o(a(l.q4_orders)),1),t("td",Ct," $"+o(a(l.total_sales)),1),t("td",Ht,[M(" $"+o(a(l.zero_perc_sales))+" ",1),t("div",Mt," ("+o(l.zero_perc_sales_percent.toFixed(2))+"%) ",1)]),t("td",Tt," $"+o(a(l.open_2026)),1),t("td",At," $"+o(a(l.q1_budget)),1),t("td",jt," $"+o(a(l.q2_budget)),1),t("td",Qt," $"+o(a(l.q3_budget)),1),t("td",Pt," $"+o(a(l.q4_budget)),1),t("td",Rt," $"+o(a(l.total_budget)),1),t("td",Lt,o(l.total_sales!==0?((l.total_budget-l.total_sales)/l.total_sales*100).toFixed(2):"0.00")+"% ",1)]))),128)),t("tr",Et,[q[0]||(q[0]=t("td",{colspan:"2",class:"text-center"},"Subtotal",-1)),t("td",Gt," $"+o(a(n.subtotals.q1_sales)),1),t("td",It," $"+o(a(n.subtotals.q2_sales)),1),t("td",Ot," $"+o(a(n.subtotals.q3_sales)),1),t("td",Ut," $"+o(a(n.subtotals.q4_sales)),1),t("td",Wt," $"+o(a(n.subtotals.q4_orders)),1),t("td",Kt," $"+o(a(n.subtotals.total_sales)),1),t("td",Zt,[M(" $"+o(a(n.subtotals.zero_perc_sales))+" ",1),t("div",Jt," ("+o(n.subtotals.zero_perc_sales_percent.toFixed(2))+"%) ",1)]),t("td",Xt," $"+o(a(n.subtotals.open_2026)),1),t("td",Yt," $"+o(a(n.subtotals.q1_budget)),1),t("td",te," $"+o(a(n.subtotals.q2_budget)),1),t("td",ee," $"+o(a(n.subtotals.q3_budget)),1),t("td",se," $"+o(a(n.subtotals.q4_budget)),1),t("td",ae," $"+o(a(n.subtotals.total_budget)),1),t("td",oe,o(n.subtotals.total_sales!==0?((n.subtotals.total_budget-n.subtotals.total_sales)/n.subtotals.total_sales*100).toFixed(2):"0.00")+"% ",1)])])])])])):C("",!0)}};function le(){const n=ot(),g=T(!1),b=T(null),a=T([]),y=S(()=>a.value.reduce((e,s)=>e+s.total_sales,0)),q=S(()=>a.value.reduce((e,s)=>e+s.total_budget,0)),l=S(()=>y.value===0?0:(q.value-y.value)/y.value*100),u=S(()=>a.value.filter(e=>e.role&&e.role.toLowerCase().startsWith("hospitality"))),N=S(()=>a.value.filter(e=>!e.role||!e.role.toLowerCase().startsWith("hospitality")));function B(e){if(!e.length)return{q1_sales:0,q2_sales:0,q3_sales:0,q4_sales:0,q4_orders:0,total_sales:0,zero_perc_sales:0,zero_perc_sales_percent:0,open_2026:0,q1_budget:0,q2_budget:0,q3_budget:0,q4_budget:0,total_budget:0,growth_percent:0};const s=e.reduce((r,d)=>(r.q1_sales+=d.q1_sales,r.q2_sales+=d.q2_sales,r.q3_sales+=d.q3_sales,r.q4_sales+=d.q4_sales,r.q4_orders+=d.q4_orders,r.zero_perc_sales+=d.zero_perc_sales,r.open_2026+=d.open_2026,r.q1_budget+=d.q1_budget,r.q2_budget+=d.q2_budget,r.q3_budget+=d.q3_budget,r.q4_budget+=d.q4_budget,r),{q1_sales:0,q2_sales:0,q3_sales:0,q4_sales:0,q4_orders:0,zero_perc_sales:0,open_2026:0,q1_budget:0,q2_budget:0,q3_budget:0,q4_budget:0});return s.total_sales=s.q1_sales+s.q2_sales+s.q3_sales+s.q4_sales+s.q4_orders,s.total_budget=s.q1_budget+s.q2_budget+s.q3_budget+s.q4_budget,s.growth_percent=s.total_sales!==0?(s.total_budget-s.total_sales)/s.total_sales*100:0,s.zero_perc_sales_percent=s.total_sales?s.zero_perc_sales/s.total_sales*100:0,s}const z=S(()=>B(u.value)),V=S(()=>B(N.value)),H=e=>{if(e==null)return 0;if(typeof e=="number")return e;if(typeof e=="string"){const s=e.replace(/[%$,]/g,"").trim(),r=parseFloat(s);return Number.isNaN(r)?0:r}return 0},h=(e,s)=>{const r=Array.isArray(s)?s:[s];return e.reduce((d,v)=>{for(const p of r)if(v[p]!==void 0&&v[p]!==null){d+=H(v[p]);break}return d},0)},k=(e,s={})=>{if(!e?.length)return null;const r={salesperson_name:"Total",salesperson_id:"",role:"",brand:"",flag:"",derived_customer_class:"",customer_name:""},d=h(e,"q1_sales"),v=h(e,"q2_sales"),p=h(e,"q3_sales"),c=h(e,"q4_sales"),i=h(e,"q4_orders"),x=h(e,"total_sales"),f=d+v+p+c+i,w=x!==0?x:f,F=h(e,["zero_perc_sales_total","zero_perc_sales"]),Y=h(e,"open_2026"),Q=h(e,"q1_budget"),P=h(e,"q2_budget"),R=h(e,"q3_budget"),L=h(e,"q4_budget"),E=Q+P+R+L,tt=h(e,"total_budget"),et=E!==0?E:tt,G=w!==0?F/w*100:0,I=w!==0?((et||0)-w)/w*100:0;return{...r,...s,q1_sales:_(d),q2_sales:_(v),q3_sales:_(p),q4_sales:_(c),q4_orders:_(i),total_sales:_(w),zero_perc_sales_total:_(F),zero_perc_sales_percent:Number.isFinite(G)?G.toFixed(2):"0.00",open_2026:_(Y),q1_budget:_(Q),q2_budget:_(P),q3_budget:_(R),q4_budget:_(L),growth_percent:Number.isFinite(I)?I.toFixed(2):"0.00"}};async function A(){g.value=!0,b.value=null;try{const e=await n.apiCall("/api/admin/summary");if(!e.ok)throw new Error("Failed to fetch admin summary");const s=await e.json();a.value=s.data||[]}catch(e){b.value=e.message,console.error(e)}finally{g.value=!1}}async function j(e){try{const s=await n.apiCall(`/api/sales/${e}`);if(!s.ok)throw new Error("Failed to fetch sales data");const r=await s.json(),d=await n.apiCall(`/api/budget/${e}`);if(!d.ok)throw new Error("Failed to fetch budget data");const v=await d.json(),p=a.value.find(c=>c.salesperson_id===e);return r.data.map(c=>{const i=v.data.find(F=>F.brand===c.brand&&F.flag===c.flag&&F.customer_name===c.customer_name),x=(parseFloat(c.q1_sales)||0)+(parseFloat(c.q2_sales)||0)+(parseFloat(c.q3_sales)||0)+(parseFloat(c.q4_sales)||0)+(parseFloat(c.q4_orders)||0),f=i?(parseFloat(i.quarter_1_sales)||0)+(parseFloat(i.quarter_2_sales)||0)+(parseFloat(i.quarter_3_sales)||0)+(parseFloat(i.quarter_4_sales)||0):0,w=x!==0&&!isNaN(x)&&!isNaN(f)?(f-x)/x*100:0;return{...c,salesperson_id:e,salesperson_name:p?.salesperson_name||"Unknown",role:p?.role||"Unknown",q1_budget:i?_(i.quarter_1_sales):"0.00",q2_budget:i?_(i.quarter_2_sales):"0.00",q3_budget:i?_(i.quarter_3_sales):"0.00",q4_budget:i?_(i.quarter_4_sales):"0.00",open_2026:_(c.open_2026),growth_percent:isNaN(w)?"0.00":w.toFixed(2)}})}catch(s){return console.error(s),[]}}async function J(e,s){const r=await j(e);if(!r.length)return alert("No data available");const v=a.value.find(f=>f.salesperson_id===e)?.role?.toLowerCase().startsWith("hospitality"),p=W(v),c=`${s.replace(/[^a-zA-Z0-9]/g,"_")}_budget_${new Date().toISOString().split("T")[0]}.csv`,i=k(r,{salesperson_name:"Total",role:""}),x=i?[...r,i]:r;K(x,p,c)}async function X(){if(!a.value.length)return alert("No data available");try{const e=g.value;g.value=!0;const s=[];for(const f of a.value){const w=await j(f.salesperson_id);s.push(...w)}if(!s.length){alert("No data available");return}const r=s.some(f=>f.role?.toLowerCase().startsWith("hospitality")),d=s.some(f=>!f.role?.toLowerCase().startsWith("hospitality")),p=W(r,r&&d),c=`full_budget_sheet_${new Date().toISOString().split("T")[0]}.csv`,i=k(s,{salesperson_name:"Grand Total"}),x=i?[...s,i]:s;K(x,p,c)}catch(e){console.error("Error downloading full budget sheet:",e),alert("Error downloading budget sheet. Please try again.")}finally{g.value=!1}}return{loading:g,error:b,summaryData:a,totalSales:y,totalBudget:q,totalGrowthPercent:l,hospitalityData:u,nonHospitalityData:N,hospitalitySubtotals:z,nonHospitalitySubtotals:V,fetchAdminSummary:A,downloadSalespersonData:J,downloadFullBudgetSheet:X}}const ne={class:"p-6 space-y-6"},re={key:0},ue={__name:"AdminView",setup(n){const g=rt(),b=nt("navActions"),{loading:a,error:y,summaryData:q,hospitalityData:l,nonHospitalityData:u,hospitalitySubtotals:N,nonHospitalitySubtotals:B,fetchAdminSummary:z,downloadSalespersonData:V,downloadFullBudgetSheet:H}=le();function h(k){g.push(`/salesperson/${k}`)}return lt(()=>{z(),b.set([{id:"division-view",text:"Division View",class:"btn btn-secondary mr-2",handler:()=>g.push("/division"),icon:'<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>'},{id:"gross-profit-view",text:"Gross Profit View",class:"btn btn-accent mr-2",handler:()=>g.push("/gross-profit"),icon:'<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"/>'},{id:"download-full-budget",text:"Download Full Budget Sheet",class:"btn btn-primary",disabled:S(()=>a.value||!q.value.length),handler:H,icon:'<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>'}])}),dt(()=>b.clear()),(k,A)=>($(),D("div",ne,[O(it,{loading:m(a),error:m(y),onRetry:m(z)},null,8,["loading","error","onRetry"]),!m(a)&&!m(y)?($(),D("div",re,[O(yt,{"summary-data":m(q)},null,8,["summary-data"]),m(l).length?($(),U(Z,{key:0,data:m(l),subtotals:m(N),title:"Hospitality Salespeople",type:"hospitality",onViewSalesperson:h,onDownloadSalesperson:m(V)},null,8,["data","subtotals","onDownloadSalesperson"])):C("",!0),m(u).length?($(),U(Z,{key:1,data:m(u),subtotals:m(B),title:"Non-Hospitality Salespeople",type:"non-hospitality",onViewSalesperson:h,onDownloadSalesperson:m(V)},null,8,["data","subtotals","onDownloadSalesperson"])):C("",!0)])):C("",!0)]))}};export{ue as default};
