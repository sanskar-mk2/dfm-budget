import{c as x,b as N,g as D,f as t,t as l,h as R,F as st,j as at,k as E,u as ot,r as I,o as lt,i as nt,l as rt,a as dt,d as K,e as p,m as Z}from"./index-BLyOduZl.js";import{g as J,d as X,f as u,_ as it}from"./downloadUtils-CgUiZzHL.js";const ut={class:"grid sm:grid-cols-2 lg:grid-cols-4 gap-4"},_t={class:"stat bg-base-100 shadow rounded-xl"},ct={class:"stat-value text-primary"},ht={class:"stat bg-base-100 shadow rounded-xl"},gt={class:"stat-value text-primary"},mt={class:"stat bg-base-100 shadow rounded-xl"},bt={class:"stat-value text-primary"},qt={class:"stat bg-base-100 shadow rounded-xl"},pt={class:"stat-value text-primary"},yt={__name:"AdminStats",props:{summaryData:{type:Array,required:!0,default:()=>[]}},setup(r){const m=r,q=x(()=>m.summaryData.reduce((n,_)=>n+_.total_sales,0)),a=x(()=>m.summaryData.reduce((n,_)=>n+_.total_budget,0)),f=x(()=>q.value===0?0:(a.value-q.value)/q.value*100),y=n=>new Intl.NumberFormat("en-US",{minimumFractionDigits:0,maximumFractionDigits:0}).format(n||0);return(n,_)=>(D(),N("div",ut,[t("div",_t,[_[0]||(_[0]=t("div",{class:"stat-title"},"Total Salespeople",-1)),t("div",ct,l(r.summaryData.length),1)]),t("div",ht,[_[1]||(_[1]=t("div",{class:"stat-title"},"Total Sales",-1)),t("div",gt," $"+l(y(q.value)),1)]),t("div",mt,[_[2]||(_[2]=t("div",{class:"stat-title"},"Total Budget",-1)),t("div",bt," $"+l(y(a.value)),1)]),t("div",qt,[_[3]||(_[3]=t("div",{class:"stat-title"},"Growth",-1)),t("div",pt,l(f.value.toFixed(2))+"% ",1)])]))}},ft={key:0,class:"mt-10 bg-base-100 shadow-md rounded-xl"},vt={class:"text-lg px-6 py-3 bg-primary text-primary-content rounded-t-xl"},xt={class:"overflow-x-auto rounded-xl"},wt={class:"table table-zebra text-sm"},St={class:"join"},$t=["onClick"],Ft=["onClick"],Dt={class:"text-xs opacity-70"},kt={class:"text-right"},Bt={class:"text-right"},Nt={class:"text-right"},zt={class:"text-right"},Vt={class:"text-right"},Ct={class:"text-right font-bold"},Ht={class:"text-right"},Mt={class:"text-xs opacity-60"},Qt={class:"text-right"},Tt={class:"text-right"},At={class:"text-right"},jt={class:"text-right"},Pt={class:"text-right"},Rt={class:"text-right font-bold"},Lt={class:"text-right"},Et={class:"font-bold bg-secondary text-secondary-content [&:nth-child(even)]:bg-secondary [&:nth-child(odd)]:bg-secondary"},It={class:"text-right"},Ut={class:"text-right"},Gt={class:"text-right"},Ot={class:"text-right"},Wt={class:"text-right"},Kt={class:"text-right"},Zt={class:"text-right"},Jt={class:"text-xs opacity-70"},Xt={class:"text-right"},Yt={class:"text-right"},te={class:"text-right"},ee={class:"text-right"},se={class:"text-right"},ae={class:"text-right"},oe={class:"text-right"},Y={__name:"SalespersonTable",props:{data:{type:Array,required:!0,default:()=>[]},subtotals:{type:Object,required:!0},title:{type:String,required:!0},type:{type:String,required:!0,validator:r=>["hospitality","non-hospitality"].includes(r)}},emits:["view-salesperson","download-salesperson"],setup(r,{emit:m}){const q=m,a=f=>new Intl.NumberFormat("en-US",{minimumFractionDigits:0,maximumFractionDigits:0}).format(f||0);return(f,y)=>r.data.length?(D(),N("div",ft,[t("h2",vt,l(r.title)+" ("+l(r.data.length)+") ",1),t("div",xt,[t("table",wt,[y[1]||(y[1]=t("thead",null,[t("tr",null,[t("th"),t("th",null,"Salesperson"),t("th",null,"Q1 Sales"),t("th",null,"Q2 Sales"),t("th",null,"Q3 Sales"),t("th",null,"Q4 Sales"),t("th",null,"Q4 Orders"),t("th",null,"Total Sales"),t("th",null,"0% Sales (Rate)"),t("th",null,"2026 Open"),t("th",null,"Q1 Budget"),t("th",null,"Q2 Budget"),t("th",null,"Q3 Budget"),t("th",null,"Q4 Budget"),t("th",null,"Total Budget"),t("th",null,"Growth")])],-1)),t("tbody",null,[(D(!0),N(st,null,at(r.data,n=>(D(),N("tr",{key:n.salesperson_id,class:"hover"},[t("td",null,[t("div",St,[t("button",{onClick:_=>q("view-salesperson",n.salesperson_id),class:"btn btn-xs btn-ghost join-item",title:"View"}," ðŸ‘ï¸ ",8,$t),t("button",{onClick:_=>q("download-salesperson",n.salesperson_id,n.salesperson_name),class:"btn btn-xs btn-ghost join-item",title:"Download"}," â¬‡ï¸ ",8,Ft)])]),t("td",null,[E(l(n.salesperson_name)+" ",1),t("div",Dt," ID: "+l(n.salesperson_id),1)]),t("td",kt," $"+l(a(n.q1_sales)),1),t("td",Bt," $"+l(a(n.q2_sales)),1),t("td",Nt," $"+l(a(n.q3_sales)),1),t("td",zt," $"+l(a(n.q4_sales)),1),t("td",Vt," $"+l(a(n.q4_orders)),1),t("td",Ct," $"+l(a(n.total_sales)),1),t("td",Ht,[E(" $"+l(a(n.zero_perc_sales))+" ",1),t("div",Mt," ("+l(n.zero_perc_sales_percent.toFixed(2))+"%) ",1)]),t("td",Qt," $"+l(a(n.open_2026)),1),t("td",Tt," $"+l(a(n.q1_budget)),1),t("td",At," $"+l(a(n.q2_budget)),1),t("td",jt," $"+l(a(n.q3_budget)),1),t("td",Pt," $"+l(a(n.q4_budget)),1),t("td",Rt," $"+l(a(n.total_budget)),1),t("td",Lt,l(n.total_sales!==0?((n.total_budget-n.total_sales)/n.total_sales*100).toFixed(2):"0.00")+"% ",1)]))),128)),t("tr",Et,[y[0]||(y[0]=t("td",{colspan:"2",class:"text-center"},"Subtotal",-1)),t("td",It," $"+l(a(r.subtotals.q1_sales)),1),t("td",Ut," $"+l(a(r.subtotals.q2_sales)),1),t("td",Gt," $"+l(a(r.subtotals.q3_sales)),1),t("td",Ot," $"+l(a(r.subtotals.q4_sales)),1),t("td",Wt," $"+l(a(r.subtotals.q4_orders)),1),t("td",Kt," $"+l(a(r.subtotals.total_sales)),1),t("td",Zt,[E(" $"+l(a(r.subtotals.zero_perc_sales))+" ",1),t("div",Jt," ("+l(r.subtotals.zero_perc_sales_percent.toFixed(2))+"%) ",1)]),t("td",Xt," $"+l(a(r.subtotals.open_2026)),1),t("td",Yt," $"+l(a(r.subtotals.q1_budget)),1),t("td",te," $"+l(a(r.subtotals.q2_budget)),1),t("td",ee," $"+l(a(r.subtotals.q3_budget)),1),t("td",se," $"+l(a(r.subtotals.q4_budget)),1),t("td",ae," $"+l(a(r.subtotals.total_budget)),1),t("td",oe,l(r.subtotals.total_sales!==0?((r.subtotals.total_budget-r.subtotals.total_sales)/r.subtotals.total_sales*100).toFixed(2):"0.00")+"% ",1)])])])])])):R("",!0)}};function le(){const r=ot(),m=I(!1),q=I(null),a=I([]),f=x(()=>a.value.reduce((e,s)=>e+s.total_sales,0)),y=x(()=>a.value.reduce((e,s)=>e+s.total_budget,0)),n=x(()=>f.value===0?0:(y.value-f.value)/f.value*100),_=x(()=>a.value.filter(e=>e.role&&e.role.toLowerCase().startsWith("hospitality"))),Q=x(()=>a.value.filter(e=>!e.role||!e.role.toLowerCase().startsWith("hospitality")));function T(e){if(!e.length)return{q1_sales:0,q2_sales:0,q3_sales:0,q4_sales:0,q4_orders:0,total_sales:0,zero_perc_sales:0,zero_perc_sales_percent:0,open_2026:0,q1_budget:0,q2_budget:0,q3_budget:0,q4_budget:0,total_budget:0,growth_percent:0};const s=e.reduce((d,i)=>(d.q1_sales+=i.q1_sales,d.q2_sales+=i.q2_sales,d.q3_sales+=i.q3_sales,d.q4_sales+=i.q4_sales,d.q4_orders+=i.q4_orders,d.zero_perc_sales+=i.zero_perc_sales,d.open_2026+=i.open_2026,d.q1_budget+=i.q1_budget,d.q2_budget+=i.q2_budget,d.q3_budget+=i.q3_budget,d.q4_budget+=i.q4_budget,d),{q1_sales:0,q2_sales:0,q3_sales:0,q4_sales:0,q4_orders:0,zero_perc_sales:0,open_2026:0,q1_budget:0,q2_budget:0,q3_budget:0,q4_budget:0});return s.total_sales=s.q1_sales+s.q2_sales+s.q3_sales+s.q4_sales+s.q4_orders,s.total_budget=s.q1_budget+s.q2_budget+s.q3_budget+s.q4_budget,s.growth_percent=s.total_sales!==0?(s.total_budget-s.total_sales)/s.total_sales*100:0,s.zero_perc_sales_percent=s.total_sales?s.zero_perc_sales/s.total_sales*100:0,s}const A=x(()=>T(_.value)),j=x(()=>T(Q.value)),L=e=>{if(e==null)return 0;if(typeof e=="number")return e;if(typeof e=="string"){const s=e.replace(/[%$,]/g,"").trim(),d=parseFloat(s);return Number.isNaN(d)?0:d}return 0},h=(e,s)=>{const d=Array.isArray(s)?s:[s];return e.reduce((i,v)=>{for(const b of d)if(v[b]!==void 0&&v[b]!==null){i+=L(v[b]);break}return i},0)},z=(e,s={})=>{if(!e?.length)return null;const d={salesperson_name:"Total",salesperson_id:"",role:"",brand:"",flag:"",derived_customer_class:"",customer_name:""},i=h(e,"q1_sales"),v=h(e,"q2_sales"),b=h(e,"q3_sales"),w=h(e,"q4_sales"),S=h(e,"q4_orders"),F=h(e,"total_sales"),o=i+v+b+w+S,g=F!==0?F:o,B=h(e,["zero_perc_sales_total","zero_perc_sales"]),P=h(e,"open_2026"),V=h(e,"q1_budget"),C=h(e,"q2_budget"),k=h(e,"q3_budget"),H=h(e,"q4_budget"),M=V+C+k+H,c=h(e,"total_budget"),$=M!==0?M:c,O=g!==0?B/g*100:0,W=g!==0?(($||0)-g)/g*100:0;return{...d,...s,q1_sales:u(i),q2_sales:u(v),q3_sales:u(b),q4_sales:u(w),q4_orders:u(S),total_sales:u(g),zero_perc_sales_total:u(B),zero_perc_sales_percent:Number.isFinite(O)?O.toFixed(2):"0.00",open_2026:u(P),q1_budget:u(V),q2_budget:u(C),q3_budget:u(k),q4_budget:u(H),growth_percent:Number.isFinite(W)?W.toFixed(2):"0.00"}};async function U(){m.value=!0,q.value=null;try{const e=await r.apiCall("/api/admin/summary");if(!e.ok)throw new Error("Failed to fetch admin summary");const s=await e.json();a.value=s.data||[]}catch(e){q.value=e.message,console.error(e)}finally{m.value=!1}}async function G(e){try{const s=await r.apiCall(`/api/sales/${e}`);if(!s.ok)throw new Error("Failed to fetch sales data");const d=await s.json(),i=await r.apiCall(`/api/budget/${e}`);if(!i.ok)throw new Error("Failed to fetch budget data");const v=await i.json(),b=a.value.find(o=>o.salesperson_id===e),w=new Set,S=d.data.map(o=>{const g=v.data.filter(c=>c.brand===o.brand&&c.flag===o.flag&&c.customer_name===o.customer_name&&!w.has(c.id)),B=g.reduce((c,$)=>c+(parseFloat($.quarter_1_sales)||0),0),P=g.reduce((c,$)=>c+(parseFloat($.quarter_2_sales)||0),0),V=g.reduce((c,$)=>c+(parseFloat($.quarter_3_sales)||0),0),C=g.reduce((c,$)=>c+(parseFloat($.quarter_4_sales)||0),0);g.forEach(c=>{c.id&&w.add(c.id)});const k=(parseFloat(o.q1_sales)||0)+(parseFloat(o.q2_sales)||0)+(parseFloat(o.q3_sales)||0)+(parseFloat(o.q4_sales)||0)+(parseFloat(o.q4_orders)||0),H=B+P+V+C,M=k!==0&&!isNaN(k)&&!isNaN(H)?(H-k)/k*100:0;return{...o,salesperson_id:e,salesperson_name:b?.salesperson_name||"Unknown",role:b?.role||"Unknown",q1_budget:u(B),q2_budget:u(P),q3_budget:u(V),q4_budget:u(C),open_2026:u(o.open_2026),growth_percent:isNaN(M)?"0.00":M.toFixed(2)}}),F=v.data.filter(o=>!w.has(o.id)).map(o=>{const g=(parseFloat(o.quarter_1_sales)||0)+(parseFloat(o.quarter_2_sales)||0)+(parseFloat(o.quarter_3_sales)||0)+(parseFloat(o.quarter_4_sales)||0),B=o.customer_class&&o.customer_class.toLowerCase().startsWith("hospitality");return{salesperson_id:e,salesperson_name:b?.salesperson_name||"Unknown",role:b?.role||"Unknown",brand:o.brand||"",flag:o.flag||"",derived_customer_class:o.customer_class||"",customer_name:o.customer_name||"",q1_sales:"0.00",q2_sales:"0.00",q3_sales:"0.00",q4_sales:"0.00",q4_orders:"0.00",total_sales:"0.00",zero_perc_sales_total:"0.00",zero_perc_sales_percent:"0.00",open_2026:"0.00",q1_budget:u(o.quarter_1_sales),q2_budget:u(o.quarter_2_sales),q3_budget:u(o.quarter_3_sales),q4_budget:u(o.quarter_4_sales),growth_percent:g>0?"100.00":"0.00"}});return[...S,...F]}catch(s){return console.error(s),[]}}async function tt(e,s){const d=await G(e);if(!d.length)return alert("No data available");const v=a.value.find(o=>o.salesperson_id===e)?.role?.toLowerCase().startsWith("hospitality"),b=J(v),w=`${s.replace(/[^a-zA-Z0-9]/g,"_")}_budget_${new Date().toISOString().split("T")[0]}.csv`,S=z(d,{salesperson_name:"Total",role:""}),F=S?[...d,S]:d;X(F,b,w)}async function et(){if(!a.value.length)return alert("No data available");try{const e=m.value;m.value=!0;const s=[];for(const o of a.value){const g=await G(o.salesperson_id);s.push(...g)}if(!s.length){alert("No data available");return}const d=s.some(o=>o.role?.toLowerCase().startsWith("hospitality")),i=s.some(o=>!o.role?.toLowerCase().startsWith("hospitality")),b=J(d,d&&i),w=`full_budget_sheet_${new Date().toISOString().split("T")[0]}.csv`,S=z(s,{salesperson_name:"Grand Total"}),F=S?[...s,S]:s;X(F,b,w)}catch(e){console.error("Error downloading full budget sheet:",e),alert("Error downloading budget sheet. Please try again.")}finally{m.value=!1}}return{loading:m,error:q,summaryData:a,totalSales:f,totalBudget:y,totalGrowthPercent:n,hospitalityData:_,nonHospitalityData:Q,hospitalitySubtotals:A,nonHospitalitySubtotals:j,fetchAdminSummary:U,downloadSalespersonData:tt,downloadFullBudgetSheet:et}}const ne={class:"p-6 space-y-6"},re={key:0},ue={__name:"AdminView",setup(r){const m=rt(),q=nt("navActions"),{loading:a,error:f,summaryData:y,hospitalityData:n,nonHospitalityData:_,hospitalitySubtotals:Q,nonHospitalitySubtotals:T,fetchAdminSummary:A,downloadSalespersonData:j,downloadFullBudgetSheet:L}=le();function h(z){m.push(`/salesperson/${z}`)}return lt(()=>{A(),q.set([{id:"division-view",text:"Division View",class:"btn btn-secondary mr-2",handler:()=>m.push("/division"),icon:'<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>'},{id:"gross-profit-view",text:"Gross Profit View",class:"btn btn-accent mr-2",handler:()=>m.push("/gross-profit"),icon:'<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"/>'},{id:"download-full-budget",text:"Download Full Budget Sheet",class:"btn btn-primary",disabled:x(()=>a.value||!y.value.length),handler:L,icon:'<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>'}])}),dt(()=>q.clear()),(z,U)=>(D(),N("div",ne,[K(it,{loading:p(a),error:p(f),onRetry:p(A)},null,8,["loading","error","onRetry"]),!p(a)&&!p(f)?(D(),N("div",re,[K(yt,{"summary-data":p(y)},null,8,["summary-data"]),p(n).length?(D(),Z(Y,{key:0,data:p(n),subtotals:p(Q),title:"Hospitality Salespeople",type:"hospitality",onViewSalesperson:h,onDownloadSalesperson:p(j)},null,8,["data","subtotals","onDownloadSalesperson"])):R("",!0),p(_).length?(D(),Z(Y,{key:1,data:p(_),subtotals:p(T),title:"Non-Hospitality Salespeople",type:"non-hospitality",onViewSalesperson:h,onDownloadSalesperson:p(j)},null,8,["data","subtotals","onDownloadSalesperson"])):R("",!0)])):R("",!0)]))}};export{ue as default};
