import{c as w,b as F,g as k,f as t,t as n,h as V,F as st,j as at,k as j,u as lt,r as R,o as ot,i as nt,l as rt,a as dt,d as G,e as q,m as I}from"./index-CZli52jM.js";import{_ as it}from"./LoadingError-DzrLYv93.js";const ut={class:"grid sm:grid-cols-2 lg:grid-cols-4 gap-4"},ct={class:"stat bg-base-100 shadow rounded-xl"},_t={class:"stat-value text-primary"},ht={class:"stat bg-base-100 shadow rounded-xl"},bt={class:"stat-value text-primary"},gt={class:"stat bg-base-100 shadow rounded-xl"},mt={class:"stat-value text-primary"},pt={class:"stat bg-base-100 shadow rounded-xl"},qt={class:"stat-value text-primary"},yt={__name:"AdminStats",props:{summaryData:{type:Array,required:!0,default:()=>[]}},setup(l){const c=l,d=w(()=>c.summaryData.reduce((o,h)=>o+h.total_sales,0)),a=w(()=>c.summaryData.reduce((o,h)=>o+h.total_budget,0)),g=w(()=>d.value===0?0:(a.value-d.value)/d.value*100),i=o=>new Intl.NumberFormat("en-US",{minimumFractionDigits:0,maximumFractionDigits:0}).format(o||0);return(o,h)=>(k(),F("div",ut,[t("div",ct,[h[0]||(h[0]=t("div",{class:"stat-title"},"Total Salespeople",-1)),t("div",_t,n(l.summaryData.length),1)]),t("div",ht,[h[1]||(h[1]=t("div",{class:"stat-title"},"Total Sales",-1)),t("div",bt," $"+n(i(d.value)),1)]),t("div",gt,[h[2]||(h[2]=t("div",{class:"stat-title"},"Total Budget",-1)),t("div",mt," $"+n(i(a.value)),1)]),t("div",pt,[h[3]||(h[3]=t("div",{class:"stat-title"},"Growth",-1)),t("div",qt,n(g.value.toFixed(2))+"% ",1)])]))}},ft={key:0,class:"mt-10 bg-base-100 shadow-md rounded-xl"},vt={class:"text-lg px-6 py-3 bg-primary text-primary-content rounded-t-xl"},xt={class:"overflow-x-auto rounded-xl"},St={class:"table table-zebra text-sm"},wt={class:"join"},kt=["onClick"],$t=["onClick"],Ft={class:"text-xs opacity-70"},Dt={class:"text-right"},Bt={class:"text-right"},Nt={class:"text-right"},Ct={class:"text-right"},zt={class:"text-right"},Vt={class:"text-right font-bold"},Qt={class:"text-right"},jt={class:"text-xs opacity-60"},Rt={class:"text-right"},Tt={class:"text-right"},At={class:"text-right"},Ht={class:"text-right"},Mt={class:"text-right"},Lt={class:"text-right font-bold"},Ot={class:"text-right"},Pt={class:"font-bold bg-secondary text-secondary-content [&:nth-child(even)]:bg-secondary [&:nth-child(odd)]:bg-secondary"},Ut={class:"text-right"},Et={class:"text-right"},Gt={class:"text-right"},It={class:"text-right"},Wt={class:"text-right"},Zt={class:"text-right"},Kt={class:"text-right"},Jt={class:"text-xs opacity-70"},Xt={class:"text-right"},Yt={class:"text-right"},te={class:"text-right"},ee={class:"text-right"},se={class:"text-right"},ae={class:"text-right"},le={class:"text-right"},W={__name:"SalespersonTable",props:{data:{type:Array,required:!0,default:()=>[]},subtotals:{type:Object,required:!0},title:{type:String,required:!0},type:{type:String,required:!0,validator:l=>["hospitality","non-hospitality"].includes(l)}},emits:["view-salesperson","download-salesperson"],setup(l,{emit:c}){const d=c,a=g=>new Intl.NumberFormat("en-US",{minimumFractionDigits:0,maximumFractionDigits:0}).format(g||0);return(g,i)=>l.data.length?(k(),F("div",ft,[t("h2",vt,n(l.title)+" ("+n(l.data.length)+") ",1),t("div",xt,[t("table",St,[i[1]||(i[1]=t("thead",null,[t("tr",null,[t("th"),t("th",null,"Salesperson"),t("th",null,"Q1 Sales"),t("th",null,"Q2 Sales"),t("th",null,"Q3 Sales"),t("th",null,"Q4 Sales"),t("th",null,"Q4 Orders"),t("th",null,"Total Sales"),t("th",null,"0% Sales (Rate)"),t("th",null,"2026 Open"),t("th",null,"Q1 Budget"),t("th",null,"Q2 Budget"),t("th",null,"Q3 Budget"),t("th",null,"Q4 Budget"),t("th",null,"Total Budget"),t("th",null,"Growth")])],-1)),t("tbody",null,[(k(!0),F(st,null,at(l.data,o=>(k(),F("tr",{key:o.salesperson_id,class:"hover"},[t("td",null,[t("div",wt,[t("button",{onClick:h=>d("view-salesperson",o.salesperson_id),class:"btn btn-xs btn-ghost join-item",title:"View"}," 👁️ ",8,kt),t("button",{onClick:h=>d("download-salesperson",o.salesperson_id,o.salesperson_name),class:"btn btn-xs btn-ghost join-item",title:"Download"}," ⬇️ ",8,$t)])]),t("td",null,[j(n(o.salesperson_name)+" ",1),t("div",Ft," ID: "+n(o.salesperson_id),1)]),t("td",Dt," $"+n(a(o.q1_sales)),1),t("td",Bt," $"+n(a(o.q2_sales)),1),t("td",Nt," $"+n(a(o.q3_sales)),1),t("td",Ct," $"+n(a(o.q4_sales)),1),t("td",zt," $"+n(a(o.q4_orders)),1),t("td",Vt," $"+n(a(o.total_sales)),1),t("td",Qt,[j(" $"+n(a(o.zero_perc_sales))+" ",1),t("div",jt," ("+n(o.zero_perc_sales_percent.toFixed(2))+"%) ",1)]),t("td",Rt," $"+n(a(o.open_2026)),1),t("td",Tt," $"+n(a(o.q1_budget)),1),t("td",At," $"+n(a(o.q2_budget)),1),t("td",Ht," $"+n(a(o.q3_budget)),1),t("td",Mt," $"+n(a(o.q4_budget)),1),t("td",Lt," $"+n(a(o.total_budget)),1),t("td",Ot,n(o.total_sales!==0?((o.total_budget-o.total_sales)/o.total_sales*100).toFixed(2):"0.00")+"% ",1)]))),128)),t("tr",Pt,[i[0]||(i[0]=t("td",{colspan:"2",class:"text-center"},"Subtotal",-1)),t("td",Ut," $"+n(a(l.subtotals.q1_sales)),1),t("td",Et," $"+n(a(l.subtotals.q2_sales)),1),t("td",Gt," $"+n(a(l.subtotals.q3_sales)),1),t("td",It," $"+n(a(l.subtotals.q4_sales)),1),t("td",Wt," $"+n(a(l.subtotals.q4_orders)),1),t("td",Zt," $"+n(a(l.subtotals.total_sales)),1),t("td",Kt,[j(" $"+n(a(l.subtotals.zero_perc_sales))+" ",1),t("div",Jt," ("+n(l.subtotals.zero_perc_sales_percent.toFixed(2))+"%) ",1)]),t("td",Xt," $"+n(a(l.subtotals.open_2026)),1),t("td",Yt," $"+n(a(l.subtotals.q1_budget)),1),t("td",te," $"+n(a(l.subtotals.q2_budget)),1),t("td",ee," $"+n(a(l.subtotals.q3_budget)),1),t("td",se," $"+n(a(l.subtotals.q4_budget)),1),t("td",ae," $"+n(a(l.subtotals.total_budget)),1),t("td",le,n(l.subtotals.total_sales!==0?((l.subtotals.total_budget-l.subtotals.total_sales)/l.subtotals.total_sales*100).toFixed(2):"0.00")+"% ",1)])])])])])):V("",!0)}};function oe(l,c){if(!l||l.length===0)return"";const d=c.map(g=>`"${g.label}"`).join(","),a=l.map(g=>c.map(i=>{const o=g[i.key];return o==null?'""':`"${String(o).replace(/"/g,'""')}"`}).join(","));return[d,...a].join(`
`)}function Z(l,c,d){const a=oe(l,c),g=new Blob([a],{type:"text/csv;charset=utf-8;"}),i=document.createElement("a");if(i.download!==void 0){const o=URL.createObjectURL(g);i.setAttribute("href",o),i.setAttribute("download",d),i.style.visibility="hidden",document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(o)}}function m(l){return l==null||isNaN(l)?"0.00":parseFloat(l).toFixed(2)}function K(l,c=!1){const d=[{key:"salesperson_name",label:"Salesperson Name"},{key:"salesperson_id",label:"Salesperson ID"},{key:"role",label:"Role"}];return c?d.push({key:"brand",label:"Brand"},{key:"flag",label:"Flag"},{key:"derived_customer_class",label:"Customer Class"},{key:"customer_name",label:"Customer Name"}):l?d.push({key:"brand",label:"Brand"},{key:"flag",label:"Flag"}):d.push({key:"derived_customer_class",label:"Customer Class"},{key:"customer_name",label:"Customer Name"}),d.push({key:"q1_sales",label:"Q1 Sales"},{key:"q2_sales",label:"Q2 Sales"},{key:"q3_sales",label:"Q3 Sales"},{key:"q4_sales",label:"Q4 Sales"},{key:"q4_orders",label:"Q4 Orders"},{key:"total_sales",label:"Total Sales"},{key:"zero_perc_sales_total",label:"Zero % Sales"},{key:"zero_perc_sales_percent",label:"Zero % %"},{key:"open_2026",label:"2026 Open"},{key:"q1_budget",label:"Q1 Budget"},{key:"q2_budget",label:"Q2 Budget"},{key:"q3_budget",label:"Q3 Budget"},{key:"q4_budget",label:"Q4 Budget"},{key:"growth_percent",label:"Growth"}),d}function ne(){const l=lt(),c=R(!1),d=R(null),a=R([]),g=w(()=>a.value.reduce((e,s)=>e+s.total_sales,0)),i=w(()=>a.value.reduce((e,s)=>e+s.total_budget,0)),o=w(()=>g.value===0?0:(i.value-g.value)/g.value*100),h=w(()=>a.value.filter(e=>e.role&&e.role.toLowerCase().startsWith("hospitality"))),B=w(()=>a.value.filter(e=>!e.role||!e.role.toLowerCase().startsWith("hospitality")));function N(e){if(!e.length)return{q1_sales:0,q2_sales:0,q3_sales:0,q4_sales:0,q4_orders:0,total_sales:0,zero_perc_sales:0,zero_perc_sales_percent:0,open_2026:0,q1_budget:0,q2_budget:0,q3_budget:0,q4_budget:0,total_budget:0,growth_percent:0};const s=e.reduce((r,u)=>(r.q1_sales+=u.q1_sales,r.q2_sales+=u.q2_sales,r.q3_sales+=u.q3_sales,r.q4_sales+=u.q4_sales,r.q4_orders+=u.q4_orders,r.zero_perc_sales+=u.zero_perc_sales,r.open_2026+=u.open_2026,r.q1_budget+=u.q1_budget,r.q2_budget+=u.q2_budget,r.q3_budget+=u.q3_budget,r.q4_budget+=u.q4_budget,r),{q1_sales:0,q2_sales:0,q3_sales:0,q4_sales:0,q4_orders:0,zero_perc_sales:0,open_2026:0,q1_budget:0,q2_budget:0,q3_budget:0,q4_budget:0});return s.total_sales=s.q1_sales+s.q2_sales+s.q3_sales+s.q4_sales+s.q4_orders,s.total_budget=s.q1_budget+s.q2_budget+s.q3_budget+s.q4_budget,s.growth_percent=s.total_sales!==0?(s.total_budget-s.total_sales)/s.total_sales*100:0,s.zero_perc_sales_percent=s.total_sales?s.zero_perc_sales/s.total_sales*100:0,s}const C=w(()=>N(h.value)),z=w(()=>N(B.value)),Q=e=>{if(e==null)return 0;if(typeof e=="number")return e;if(typeof e=="string"){const s=e.replace(/[%$,]/g,"").trim(),r=parseFloat(s);return Number.isNaN(r)?0:r}return 0},p=(e,s)=>{const r=Array.isArray(s)?s:[s];return e.reduce((u,v)=>{for(const y of r)if(v[y]!==void 0&&v[y]!==null){u+=Q(v[y]);break}return u},0)},D=(e,s={})=>{if(!e?.length)return null;const r={salesperson_name:"Total",salesperson_id:"",role:"",brand:"",flag:"",derived_customer_class:"",customer_name:""},u=p(e,"q1_sales"),v=p(e,"q2_sales"),y=p(e,"q3_sales"),b=p(e,"q4_sales"),_=p(e,"q4_orders"),x=p(e,"total_sales"),f=u+v+y+b+_,S=x!==0?x:f,$=p(e,["zero_perc_sales_total","zero_perc_sales"]),Y=p(e,"open_2026"),H=p(e,"q1_budget"),M=p(e,"q2_budget"),L=p(e,"q3_budget"),O=p(e,"q4_budget"),P=H+M+L+O,tt=p(e,"total_budget"),et=P!==0?P:tt,U=S!==0?$/S*100:0,E=S!==0?((et||0)-S)/S*100:0;return{...r,...s,q1_sales:m(u),q2_sales:m(v),q3_sales:m(y),q4_sales:m(b),q4_orders:m(_),total_sales:m(S),zero_perc_sales_total:m($),zero_perc_sales_percent:Number.isFinite(U)?U.toFixed(2):"0.00",open_2026:m(Y),q1_budget:m(H),q2_budget:m(M),q3_budget:m(L),q4_budget:m(O),growth_percent:Number.isFinite(E)?E.toFixed(2):"0.00"}};async function T(){c.value=!0,d.value=null;try{const e=await l.apiCall("/api/admin/summary");if(!e.ok)throw new Error("Failed to fetch admin summary");const s=await e.json();a.value=s.data||[]}catch(e){d.value=e.message,console.error(e)}finally{c.value=!1}}async function A(e){try{const s=await l.apiCall(`/api/sales/${e}`);if(!s.ok)throw new Error("Failed to fetch sales data");const r=await s.json(),u=await l.apiCall(`/api/budget/${e}`);if(!u.ok)throw new Error("Failed to fetch budget data");const v=await u.json(),y=a.value.find(b=>b.salesperson_id===e);return r.data.map(b=>{const _=v.data.find($=>$.brand===b.brand&&$.flag===b.flag&&$.customer_name===b.customer_name),x=(parseFloat(b.q1_sales)||0)+(parseFloat(b.q2_sales)||0)+(parseFloat(b.q3_sales)||0)+(parseFloat(b.q4_sales)||0)+(parseFloat(b.q4_orders)||0),f=_?(parseFloat(_.quarter_1_sales)||0)+(parseFloat(_.quarter_2_sales)||0)+(parseFloat(_.quarter_3_sales)||0)+(parseFloat(_.quarter_4_sales)||0):0,S=x!==0&&!isNaN(x)&&!isNaN(f)?(f-x)/x*100:0;return{...b,salesperson_id:e,salesperson_name:y?.salesperson_name||"Unknown",role:y?.role||"Unknown",q1_budget:_?m(_.quarter_1_sales):"0.00",q2_budget:_?m(_.quarter_2_sales):"0.00",q3_budget:_?m(_.quarter_3_sales):"0.00",q4_budget:_?m(_.quarter_4_sales):"0.00",open_2026:m(b.open_2026),growth_percent:isNaN(S)?"0.00":S.toFixed(2)}})}catch(s){return console.error(s),[]}}async function J(e,s){const r=await A(e);if(!r.length)return alert("No data available");const v=a.value.find(f=>f.salesperson_id===e)?.role?.toLowerCase().startsWith("hospitality"),y=K(v),b=`${s.replace(/[^a-zA-Z0-9]/g,"_")}_budget_${new Date().toISOString().split("T")[0]}.csv`,_=D(r,{salesperson_name:"Total",role:""}),x=_?[...r,_]:r;Z(x,y,b)}async function X(){if(!a.value.length)return alert("No data available");try{const e=c.value;c.value=!0;const s=[];for(const f of a.value){const S=await A(f.salesperson_id);s.push(...S)}if(!s.length){alert("No data available");return}const r=s.some(f=>f.role?.toLowerCase().startsWith("hospitality")),u=s.some(f=>!f.role?.toLowerCase().startsWith("hospitality")),y=K(r,r&&u),b=`full_budget_sheet_${new Date().toISOString().split("T")[0]}.csv`,_=D(s,{salesperson_name:"Grand Total"}),x=_?[...s,_]:s;Z(x,y,b)}catch(e){console.error("Error downloading full budget sheet:",e),alert("Error downloading budget sheet. Please try again.")}finally{c.value=!1}}return{loading:c,error:d,summaryData:a,totalSales:g,totalBudget:i,totalGrowthPercent:o,hospitalityData:h,nonHospitalityData:B,hospitalitySubtotals:C,nonHospitalitySubtotals:z,fetchAdminSummary:T,downloadSalespersonData:J,downloadFullBudgetSheet:X}}const re={class:"p-6 space-y-6"},de={key:0},ce={__name:"AdminView",setup(l){const c=rt(),d=nt("navActions"),{loading:a,error:g,summaryData:i,hospitalityData:o,nonHospitalityData:h,hospitalitySubtotals:B,nonHospitalitySubtotals:N,fetchAdminSummary:C,downloadSalespersonData:z,downloadFullBudgetSheet:Q}=ne();function p(D){c.push(`/salesperson/${D}`)}return ot(()=>{C(),d.set([{id:"division-view",text:"Division View",class:"btn btn-secondary mr-2",handler:()=>c.push("/division"),icon:'<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>'},{id:"gross-profit-view",text:"Gross Profit View",class:"btn btn-accent mr-2",handler:()=>c.push("/gross-profit"),icon:'<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"/>'},{id:"download-full-budget",text:"Download Full Budget Sheet",class:"btn btn-primary",disabled:w(()=>a.value||!i.value.length),handler:Q,icon:'<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>'}])}),dt(()=>d.clear()),(D,T)=>(k(),F("div",re,[G(it,{loading:q(a),error:q(g),onRetry:q(C)},null,8,["loading","error","onRetry"]),!q(a)&&!q(g)?(k(),F("div",de,[G(yt,{"summary-data":q(i)},null,8,["summary-data"]),q(o).length?(k(),I(W,{key:0,data:q(o),subtotals:q(B),title:"Hospitality Salespeople",type:"hospitality",onViewSalesperson:p,onDownloadSalesperson:q(z)},null,8,["data","subtotals","onDownloadSalesperson"])):V("",!0),q(h).length?(k(),I(W,{key:1,data:q(h),subtotals:q(N),title:"Non-Hospitality Salespeople",type:"non-hospitality",onViewSalesperson:p,onDownloadSalesperson:q(z)},null,8,["data","subtotals","onDownloadSalesperson"])):V("",!0)])):V("",!0)]))}};export{ce as default};
