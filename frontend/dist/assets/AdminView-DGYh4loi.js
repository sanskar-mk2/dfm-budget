import{c as y,b as q,g as p,f as t,t as o,h as S,F as U,j as I,k as j,u as G,r as z,o as W,i as M,a as P,d as V,e as m,l as H,m as Z}from"./index-CYLtyuQj.js";const J={class:"grid sm:grid-cols-2 lg:grid-cols-4 gap-4"},K={class:"stat bg-base-100 shadow rounded-xl"},X={class:"stat-value text-primary"},Y={class:"stat bg-base-100 shadow rounded-xl"},tt={class:"stat-value text-primary"},et={class:"stat bg-base-100 shadow rounded-xl"},st={class:"stat-value text-primary"},at={class:"stat bg-base-100 shadow rounded-xl"},lt={class:"stat-value text-primary"},ot={__name:"AdminStats",props:{summaryData:{type:Array,required:!0,default:()=>[]}},setup(e){const i=e,n=y(()=>i.summaryData.reduce((a,c)=>a+c.total_sales,0)),s=y(()=>i.summaryData.reduce((a,c)=>a+c.total_budget,0)),h=y(()=>n.value===0?0:(s.value-n.value)/n.value*100),d=a=>new Intl.NumberFormat("en-US",{minimumFractionDigits:0,maximumFractionDigits:0}).format(a||0);return(a,c)=>(p(),q("div",J,[t("div",K,[c[0]||(c[0]=t("div",{class:"stat-title"},"Total Salespeople",-1)),t("div",X,o(e.summaryData.length),1)]),t("div",Y,[c[1]||(c[1]=t("div",{class:"stat-title"},"Total Sales",-1)),t("div",tt," $"+o(d(n.value)),1)]),t("div",et,[c[2]||(c[2]=t("div",{class:"stat-title"},"Total Budget",-1)),t("div",st," $"+o(d(s.value)),1)]),t("div",at,[c[3]||(c[3]=t("div",{class:"stat-title"},"Growth",-1)),t("div",lt,o(h.value.toFixed(2))+"% ",1)])]))}},nt={key:0,class:"flex flex-col items-center justify-center py-20"},rt={key:1,class:"alert alert-error flex flex-col items-center text-center"},dt={class:"text-sm mb-4"},it={__name:"LoadingError",props:{loading:{type:Boolean,required:!0},error:{type:String,default:null}},emits:["retry"],setup(e){return(i,n)=>e.loading?(p(),q("div",nt,[...n[1]||(n[1]=[t("span",{class:"loading loading-spinner loading-lg text-primary"},null,-1),t("p",{class:"mt-4 text-base text-gray-600 dark:text-gray-300"}," Loading admin summary... ",-1)])])):e.error?(p(),q("div",rt,[n[2]||(n[2]=t("h3",{class:"font-bold text-lg"},"Error loading data",-1)),t("p",dt,o(e.error),1),t("button",{class:"btn btn-sm btn-error",onClick:n[0]||(n[0]=s=>i.$emit("retry"))}," Retry ")])):S("",!0)}},ut={key:0,class:"mt-10 bg-base-100 shadow-md rounded-xl"},ct={class:"text-lg px-6 py-3 bg-primary text-primary-content rounded-t-xl"},_t={class:"overflow-x-auto rounded-xl"},ht={class:"table table-zebra text-sm"},gt={class:"join"},bt=["onClick"],mt=["onClick"],yt={class:"text-xs opacity-70"},pt={class:"text-right"},qt={class:"text-right"},ft={class:"text-right"},vt={class:"text-right"},xt={class:"text-right"},wt={class:"text-right font-bold"},St={class:"text-right"},$t={class:"text-xs opacity-60"},kt={class:"text-right"},Ft={class:"text-right"},Dt={class:"text-right"},Ct={class:"text-right"},Bt={class:"text-right"},Nt={class:"text-right font-bold"},Qt={class:"text-right"},jt={class:"font-bold bg-secondary text-secondary-content [&:nth-child(even)]:bg-secondary [&:nth-child(odd)]:bg-secondary"},zt={class:"text-right"},Rt={class:"text-right"},At={class:"text-right"},Lt={class:"text-right"},Vt={class:"text-right"},Ht={class:"text-right"},Tt={class:"text-right"},Et={class:"text-xs opacity-70"},Ot={class:"text-right"},Ut={class:"text-right"},It={class:"text-right"},Gt={class:"text-right"},Wt={class:"text-right"},Mt={class:"text-right"},Pt={class:"text-right"},T={__name:"SalespersonTable",props:{data:{type:Array,required:!0,default:()=>[]},subtotals:{type:Object,required:!0},title:{type:String,required:!0},type:{type:String,required:!0,validator:e=>["hospitality","non-hospitality"].includes(e)}},emits:["view-salesperson","download-salesperson"],setup(e,{emit:i}){const n=i,s=h=>new Intl.NumberFormat("en-US",{minimumFractionDigits:0,maximumFractionDigits:0}).format(h||0);return(h,d)=>e.data.length?(p(),q("div",ut,[t("h2",ct,o(e.title)+" ("+o(e.data.length)+") ",1),t("div",_t,[t("table",ht,[d[1]||(d[1]=t("thead",null,[t("tr",null,[t("th"),t("th",null,"Salesperson"),t("th",null,"Q1 Sales"),t("th",null,"Q2 Sales"),t("th",null,"Q3 Sales"),t("th",null,"Q4 Sales"),t("th",null,"Q4 Orders"),t("th",null,"Total Sales"),t("th",null,"0% Sales (Rate)"),t("th",null,"2026 Open"),t("th",null,"Q1 Budget"),t("th",null,"Q2 Budget"),t("th",null,"Q3 Budget"),t("th",null,"Q4 Budget"),t("th",null,"Total Budget"),t("th",null,"Growth")])],-1)),t("tbody",null,[(p(!0),q(U,null,I(e.data,a=>(p(),q("tr",{key:a.salesperson_id,class:"hover"},[t("td",null,[t("div",gt,[t("button",{onClick:c=>n("view-salesperson",a.salesperson_id),class:"btn btn-xs btn-ghost join-item",title:"View"}," 👁️ ",8,bt),t("button",{onClick:c=>n("download-salesperson",a.salesperson_id,a.salesperson_name),class:"btn btn-xs btn-ghost join-item",title:"Download"}," ⬇️ ",8,mt)])]),t("td",null,[j(o(a.salesperson_name)+" ",1),t("div",yt," ID: "+o(a.salesperson_id),1)]),t("td",pt," $"+o(s(a.q1_sales)),1),t("td",qt," $"+o(s(a.q2_sales)),1),t("td",ft," $"+o(s(a.q3_sales)),1),t("td",vt," $"+o(s(a.q4_sales)),1),t("td",xt," $"+o(s(a.q4_orders)),1),t("td",wt," $"+o(s(a.total_sales)),1),t("td",St,[j(" $"+o(s(a.zero_perc_sales))+" ",1),t("div",$t," ("+o(a.zero_perc_sales_percent.toFixed(2))+"%) ",1)]),t("td",kt," $"+o(s(a.open_2026)),1),t("td",Ft," $"+o(s(a.q1_budget)),1),t("td",Dt," $"+o(s(a.q2_budget)),1),t("td",Ct," $"+o(s(a.q3_budget)),1),t("td",Bt," $"+o(s(a.q4_budget)),1),t("td",Nt," $"+o(s(a.total_budget)),1),t("td",Qt,o(a.total_sales!==0?((a.total_budget-a.total_sales)/a.total_sales*100).toFixed(2):"0.00")+"% ",1)]))),128)),t("tr",jt,[d[0]||(d[0]=t("td",{colspan:"2",class:"text-center"},"Subtotal",-1)),t("td",zt," $"+o(s(e.subtotals.q1_sales)),1),t("td",Rt," $"+o(s(e.subtotals.q2_sales)),1),t("td",At," $"+o(s(e.subtotals.q3_sales)),1),t("td",Lt," $"+o(s(e.subtotals.q4_sales)),1),t("td",Vt," $"+o(s(e.subtotals.q4_orders)),1),t("td",Ht," $"+o(s(e.subtotals.total_sales)),1),t("td",Tt,[j(" $"+o(s(e.subtotals.zero_perc_sales))+" ",1),t("div",Et," ("+o(e.subtotals.zero_perc_sales_percent.toFixed(2))+"%) ",1)]),t("td",Ot," $"+o(s(e.subtotals.open_2026)),1),t("td",Ut," $"+o(s(e.subtotals.q1_budget)),1),t("td",It," $"+o(s(e.subtotals.q2_budget)),1),t("td",Gt," $"+o(s(e.subtotals.q3_budget)),1),t("td",Wt," $"+o(s(e.subtotals.q4_budget)),1),t("td",Mt," $"+o(s(e.subtotals.total_budget)),1),t("td",Pt,o(e.subtotals.total_sales!==0?((e.subtotals.total_budget-e.subtotals.total_sales)/e.subtotals.total_sales*100).toFixed(2):"0.00")+"% ",1)])])])])])):S("",!0)}};function Zt(e,i){if(!e||e.length===0)return"";const n=i.map(h=>`"${h.label}"`).join(","),s=e.map(h=>i.map(d=>{const a=h[d.key];return a==null?'""':`"${String(a).replace(/"/g,'""')}"`}).join(","));return[n,...s].join(`
`)}function E(e,i,n){const s=Zt(e,i),h=new Blob([s],{type:"text/csv;charset=utf-8;"}),d=document.createElement("a");if(d.download!==void 0){const a=URL.createObjectURL(h);d.setAttribute("href",a),d.setAttribute("download",n),d.style.visibility="hidden",document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(a)}}function w(e){return e==null||isNaN(e)?"0.00":parseFloat(e).toFixed(2)}function O(e,i=!1){const n=[{key:"salesperson_name",label:"Salesperson Name"},{key:"salesperson_id",label:"Salesperson ID"},{key:"role",label:"Role"}];return i?n.push({key:"brand",label:"Brand"},{key:"flag",label:"Flag"},{key:"derived_customer_class",label:"Customer Class"},{key:"customer_name",label:"Customer Name"}):e?n.push({key:"brand",label:"Brand"},{key:"flag",label:"Flag"}):n.push({key:"derived_customer_class",label:"Customer Class"},{key:"customer_name",label:"Customer Name"}),n.push({key:"q1_sales",label:"Q1 Sales"},{key:"q2_sales",label:"Q2 Sales"},{key:"q3_sales",label:"Q3 Sales"},{key:"q4_sales",label:"Q4 Sales"},{key:"q4_orders",label:"Q4 Orders"},{key:"total_sales",label:"Total Sales"},{key:"zero_perc_sales_total",label:"Zero % Sales"},{key:"zero_perc_sales_percent",label:"Zero % %"},{key:"open_2026",label:"2026 Open"},{key:"q1_budget",label:"Q1 Budget"},{key:"q2_budget",label:"Q2 Budget"},{key:"q3_budget",label:"Q3 Budget"},{key:"q4_budget",label:"Q4 Budget"},{key:"growth_percent",label:"Growth"}),n}function Jt(){const e=G(),i=z(!1),n=z(null),s=z([]),h=y(()=>s.value.reduce((r,l)=>r+l.total_sales,0)),d=y(()=>s.value.reduce((r,l)=>r+l.total_budget,0)),a=y(()=>h.value===0?0:(d.value-h.value)/h.value*100),c=y(()=>s.value.filter(r=>r.role&&r.role.toLowerCase().startsWith("hospitality"))),$=y(()=>s.value.filter(r=>!r.role||!r.role.toLowerCase().startsWith("hospitality")));function k(r){if(!r.length)return{q1_sales:0,q2_sales:0,q3_sales:0,q4_sales:0,q4_orders:0,total_sales:0,zero_perc_sales:0,zero_perc_sales_percent:0,open_2026:0,q1_budget:0,q2_budget:0,q3_budget:0,q4_budget:0,total_budget:0,growth_percent:0};const l=r.reduce((_,g)=>(_.q1_sales+=g.q1_sales,_.q2_sales+=g.q2_sales,_.q3_sales+=g.q3_sales,_.q4_sales+=g.q4_sales,_.q4_orders+=g.q4_orders,_.zero_perc_sales+=g.zero_perc_sales,_.open_2026+=g.open_2026,_.q1_budget+=g.q1_budget,_.q2_budget+=g.q2_budget,_.q3_budget+=g.q3_budget,_.q4_budget+=g.q4_budget,_),{q1_sales:0,q2_sales:0,q3_sales:0,q4_sales:0,q4_orders:0,zero_perc_sales:0,open_2026:0,q1_budget:0,q2_budget:0,q3_budget:0,q4_budget:0});return l.total_sales=l.q1_sales+l.q2_sales+l.q3_sales+l.q4_sales+l.q4_orders,l.total_budget=l.q1_budget+l.q2_budget+l.q3_budget+l.q4_budget,l.growth_percent=l.total_sales!==0?(l.total_budget-l.total_sales)/l.total_sales*100:0,l.zero_perc_sales_percent=l.total_sales?l.zero_perc_sales/l.total_sales*100:0,l}const F=y(()=>k(c.value)),D=y(()=>k($.value));async function N(){i.value=!0,n.value=null;try{const r=await e.apiCall("/api/admin/summary");if(!r.ok)throw new Error("Failed to fetch admin summary");const l=await r.json();s.value=l.data||[]}catch(r){n.value=r.message,console.error(r)}finally{i.value=!1}}async function x(r){try{const l=await e.apiCall(`/api/sales/${r}`);if(!l.ok)throw new Error("Failed to fetch sales data");const _=await l.json(),g=await e.apiCall(`/api/budget/${r}`);if(!g.ok)throw new Error("Failed to fetch budget data");const B=await g.json(),f=s.value.find(b=>b.salesperson_id===r);return _.data.map(b=>{const u=B.data.find(Q=>Q.brand===b.brand&&Q.flag===b.flag&&Q.customer_name===b.customer_name),v=(parseFloat(b.q1_sales)||0)+(parseFloat(b.q2_sales)||0)+(parseFloat(b.q3_sales)||0)+(parseFloat(b.q4_sales)||0)+(parseFloat(b.q4_orders)||0),A=u?(parseFloat(u.quarter_1_sales)||0)+(parseFloat(u.quarter_2_sales)||0)+(parseFloat(u.quarter_3_sales)||0)+(parseFloat(u.quarter_4_sales)||0):0,L=v!==0&&!isNaN(v)&&!isNaN(A)?(A-v)/v*100:0;return{...b,salesperson_id:r,salesperson_name:f?.salesperson_name||"Unknown",role:f?.role||"Unknown",q1_budget:u?w(u.quarter_1_sales):"0.00",q2_budget:u?w(u.quarter_2_sales):"0.00",q3_budget:u?w(u.quarter_3_sales):"0.00",q4_budget:u?w(u.quarter_4_sales):"0.00",open_2026:w(b.open_2026),growth_percent:isNaN(L)?"0.00":L.toFixed(2)}})}catch(l){return console.error(l),[]}}async function C(r,l){const _=await x(r);if(!_.length)return alert("No data available");const B=s.value.find(u=>u.salesperson_id===r)?.role?.toLowerCase().startsWith("hospitality"),f=O(B),b=`${l.replace(/[^a-zA-Z0-9]/g,"_")}_budget_${new Date().toISOString().split("T")[0]}.csv`;E(_,f,b)}async function R(){if(!s.value.length)return alert("No data available");try{const r=i.value;i.value=!0;const l=[];for(const u of s.value){const v=await x(u.salesperson_id);l.push(...v)}if(!l.length){alert("No data available");return}const _=l.some(u=>u.role?.toLowerCase().startsWith("hospitality")),g=l.some(u=>!u.role?.toLowerCase().startsWith("hospitality")),f=O(_,_&&g),b=`full_budget_sheet_${new Date().toISOString().split("T")[0]}.csv`;E(l,f,b)}catch(r){console.error("Error downloading full budget sheet:",r),alert("Error downloading budget sheet. Please try again.")}finally{i.value=!1}}return{loading:i,error:n,summaryData:s,totalSales:h,totalBudget:d,totalGrowthPercent:a,hospitalityData:c,nonHospitalityData:$,hospitalitySubtotals:F,nonHospitalitySubtotals:D,fetchAdminSummary:N,downloadSalespersonData:C,downloadFullBudgetSheet:R}}const Kt={class:"p-6 space-y-6"},Xt={key:0},te={__name:"AdminView",setup(e){const i=Z(),n=M("navActions"),{loading:s,error:h,summaryData:d,hospitalityData:a,nonHospitalityData:c,hospitalitySubtotals:$,nonHospitalitySubtotals:k,fetchAdminSummary:F,downloadSalespersonData:D,downloadFullBudgetSheet:N}=Jt();function x(C){i.push(`/salesperson/${C}`)}return W(()=>{F(),n.set([{id:"download-full-budget",text:"Download Full Budget Sheet",class:"btn btn-primary",disabled:y(()=>s.value||!d.value.length),handler:N,icon:'<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>'}])}),P(()=>n.clear()),(C,R)=>(p(),q("div",Kt,[V(it,{loading:m(s),error:m(h),onRetry:m(F)},null,8,["loading","error","onRetry"]),!m(s)&&!m(h)?(p(),q("div",Xt,[V(ot,{"summary-data":m(d)},null,8,["summary-data"]),m(a).length?(p(),H(T,{key:0,data:m(a),subtotals:m($),title:"Hospitality Salespeople",type:"hospitality",onViewSalesperson:x,onDownloadSalesperson:m(D)},null,8,["data","subtotals","onDownloadSalesperson"])):S("",!0),m(c).length?(p(),H(T,{key:1,data:m(c),subtotals:m(k),title:"Non-Hospitality Salespeople",type:"non-hospitality",onViewSalesperson:x,onDownloadSalesperson:m(D)},null,8,["data","subtotals","onDownloadSalesperson"])):S("",!0)])):S("",!0)]))}};export{te as default};
