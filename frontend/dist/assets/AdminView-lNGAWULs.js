import{c as y,b as f,g as p,f as t,t as o,h as B,F as U,j as E,k as j,u as I,r as z,o as G,i as P,l as W,a as Z,d as A,e as m,m as R}from"./index-OE4JlXoz.js";import{_ as J}from"./LoadingError-C4CRoX5x.js";const K={class:"grid sm:grid-cols-2 lg:grid-cols-4 gap-4"},X={class:"stat bg-base-100 shadow rounded-xl"},Y={class:"stat-value text-primary"},tt={class:"stat bg-base-100 shadow rounded-xl"},et={class:"stat-value text-primary"},st={class:"stat bg-base-100 shadow rounded-xl"},at={class:"stat-value text-primary"},lt={class:"stat bg-base-100 shadow rounded-xl"},ot={class:"stat-value text-primary"},nt={__name:"AdminStats",props:{summaryData:{type:Array,required:!0,default:()=>[]}},setup(s){const d=s,r=y(()=>d.summaryData.reduce((a,c)=>a+c.total_sales,0)),e=y(()=>d.summaryData.reduce((a,c)=>a+c.total_budget,0)),h=y(()=>r.value===0?0:(e.value-r.value)/r.value*100),i=a=>new Intl.NumberFormat("en-US",{minimumFractionDigits:0,maximumFractionDigits:0}).format(a||0);return(a,c)=>(p(),f("div",K,[t("div",X,[c[0]||(c[0]=t("div",{class:"stat-title"},"Total Salespeople",-1)),t("div",Y,o(s.summaryData.length),1)]),t("div",tt,[c[1]||(c[1]=t("div",{class:"stat-title"},"Total Sales",-1)),t("div",et," $"+o(i(r.value)),1)]),t("div",st,[c[2]||(c[2]=t("div",{class:"stat-title"},"Total Budget",-1)),t("div",at," $"+o(i(e.value)),1)]),t("div",lt,[c[3]||(c[3]=t("div",{class:"stat-title"},"Growth",-1)),t("div",ot,o(h.value.toFixed(2))+"% ",1)])]))}},rt={key:0,class:"mt-10 bg-base-100 shadow-md rounded-xl"},it={class:"text-lg px-6 py-3 bg-primary text-primary-content rounded-t-xl"},dt={class:"overflow-x-auto rounded-xl"},ut={class:"table table-zebra text-sm"},ct={class:"join"},_t=["onClick"],ht=["onClick"],bt={class:"text-xs opacity-70"},gt={class:"text-right"},mt={class:"text-right"},yt={class:"text-right"},pt={class:"text-right"},qt={class:"text-right"},vt={class:"text-right font-bold"},ft={class:"text-right"},wt={class:"text-xs opacity-60"},xt={class:"text-right"},St={class:"text-right"},kt={class:"text-right"},$t={class:"text-right"},Ft={class:"text-right"},Dt={class:"text-right font-bold"},Ct={class:"text-right"},Bt={class:"font-bold bg-secondary text-secondary-content [&:nth-child(even)]:bg-secondary [&:nth-child(odd)]:bg-secondary"},Nt={class:"text-right"},Qt={class:"text-right"},jt={class:"text-right"},zt={class:"text-right"},Vt={class:"text-right"},Ht={class:"text-right"},Mt={class:"text-right"},At={class:"text-xs opacity-70"},Rt={class:"text-right"},Lt={class:"text-right"},Tt={class:"text-right"},Ot={class:"text-right"},Ut={class:"text-right"},Et={class:"text-right"},It={class:"text-right"},L={__name:"SalespersonTable",props:{data:{type:Array,required:!0,default:()=>[]},subtotals:{type:Object,required:!0},title:{type:String,required:!0},type:{type:String,required:!0,validator:s=>["hospitality","non-hospitality"].includes(s)}},emits:["view-salesperson","download-salesperson"],setup(s,{emit:d}){const r=d,e=h=>new Intl.NumberFormat("en-US",{minimumFractionDigits:0,maximumFractionDigits:0}).format(h||0);return(h,i)=>s.data.length?(p(),f("div",rt,[t("h2",it,o(s.title)+" ("+o(s.data.length)+") ",1),t("div",dt,[t("table",ut,[i[1]||(i[1]=t("thead",null,[t("tr",null,[t("th"),t("th",null,"Salesperson"),t("th",null,"Q1 Sales"),t("th",null,"Q2 Sales"),t("th",null,"Q3 Sales"),t("th",null,"Q4 Sales"),t("th",null,"Q4 Orders"),t("th",null,"Total Sales"),t("th",null,"0% Sales (Rate)"),t("th",null,"2026 Open"),t("th",null,"Q1 Budget"),t("th",null,"Q2 Budget"),t("th",null,"Q3 Budget"),t("th",null,"Q4 Budget"),t("th",null,"Total Budget"),t("th",null,"Growth")])],-1)),t("tbody",null,[(p(!0),f(U,null,E(s.data,a=>(p(),f("tr",{key:a.salesperson_id,class:"hover"},[t("td",null,[t("div",ct,[t("button",{onClick:c=>r("view-salesperson",a.salesperson_id),class:"btn btn-xs btn-ghost join-item",title:"View"}," ðŸ‘ï¸ ",8,_t),t("button",{onClick:c=>r("download-salesperson",a.salesperson_id,a.salesperson_name),class:"btn btn-xs btn-ghost join-item",title:"Download"}," â¬‡ï¸ ",8,ht)])]),t("td",null,[j(o(a.salesperson_name)+" ",1),t("div",bt," ID: "+o(a.salesperson_id),1)]),t("td",gt," $"+o(e(a.q1_sales)),1),t("td",mt," $"+o(e(a.q2_sales)),1),t("td",yt," $"+o(e(a.q3_sales)),1),t("td",pt," $"+o(e(a.q4_sales)),1),t("td",qt," $"+o(e(a.q4_orders)),1),t("td",vt," $"+o(e(a.total_sales)),1),t("td",ft,[j(" $"+o(e(a.zero_perc_sales))+" ",1),t("div",wt," ("+o(a.zero_perc_sales_percent.toFixed(2))+"%) ",1)]),t("td",xt," $"+o(e(a.open_2026)),1),t("td",St," $"+o(e(a.q1_budget)),1),t("td",kt," $"+o(e(a.q2_budget)),1),t("td",$t," $"+o(e(a.q3_budget)),1),t("td",Ft," $"+o(e(a.q4_budget)),1),t("td",Dt," $"+o(e(a.total_budget)),1),t("td",Ct,o(a.total_sales!==0?((a.total_budget-a.total_sales)/a.total_sales*100).toFixed(2):"0.00")+"% ",1)]))),128)),t("tr",Bt,[i[0]||(i[0]=t("td",{colspan:"2",class:"text-center"},"Subtotal",-1)),t("td",Nt," $"+o(e(s.subtotals.q1_sales)),1),t("td",Qt," $"+o(e(s.subtotals.q2_sales)),1),t("td",jt," $"+o(e(s.subtotals.q3_sales)),1),t("td",zt," $"+o(e(s.subtotals.q4_sales)),1),t("td",Vt," $"+o(e(s.subtotals.q4_orders)),1),t("td",Ht," $"+o(e(s.subtotals.total_sales)),1),t("td",Mt,[j(" $"+o(e(s.subtotals.zero_perc_sales))+" ",1),t("div",At," ("+o(s.subtotals.zero_perc_sales_percent.toFixed(2))+"%) ",1)]),t("td",Rt," $"+o(e(s.subtotals.open_2026)),1),t("td",Lt," $"+o(e(s.subtotals.q1_budget)),1),t("td",Tt," $"+o(e(s.subtotals.q2_budget)),1),t("td",Ot," $"+o(e(s.subtotals.q3_budget)),1),t("td",Ut," $"+o(e(s.subtotals.q4_budget)),1),t("td",Et," $"+o(e(s.subtotals.total_budget)),1),t("td",It,o(s.subtotals.total_sales!==0?((s.subtotals.total_budget-s.subtotals.total_sales)/s.subtotals.total_sales*100).toFixed(2):"0.00")+"% ",1)])])])])])):B("",!0)}};function Gt(s,d){if(!s||s.length===0)return"";const r=d.map(h=>`"${h.label}"`).join(","),e=s.map(h=>d.map(i=>{const a=h[i.key];return a==null?'""':`"${String(a).replace(/"/g,'""')}"`}).join(","));return[r,...e].join(`
`)}function T(s,d,r){const e=Gt(s,d),h=new Blob([e],{type:"text/csv;charset=utf-8;"}),i=document.createElement("a");if(i.download!==void 0){const a=URL.createObjectURL(h);i.setAttribute("href",a),i.setAttribute("download",r),i.style.visibility="hidden",document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(a)}}function x(s){return s==null||isNaN(s)?"0.00":parseFloat(s).toFixed(2)}function O(s,d=!1){const r=[{key:"salesperson_name",label:"Salesperson Name"},{key:"salesperson_id",label:"Salesperson ID"},{key:"role",label:"Role"}];return d?r.push({key:"brand",label:"Brand"},{key:"flag",label:"Flag"},{key:"derived_customer_class",label:"Customer Class"},{key:"customer_name",label:"Customer Name"}):s?r.push({key:"brand",label:"Brand"},{key:"flag",label:"Flag"}):r.push({key:"derived_customer_class",label:"Customer Class"},{key:"customer_name",label:"Customer Name"}),r.push({key:"q1_sales",label:"Q1 Sales"},{key:"q2_sales",label:"Q2 Sales"},{key:"q3_sales",label:"Q3 Sales"},{key:"q4_sales",label:"Q4 Sales"},{key:"q4_orders",label:"Q4 Orders"},{key:"total_sales",label:"Total Sales"},{key:"zero_perc_sales_total",label:"Zero % Sales"},{key:"zero_perc_sales_percent",label:"Zero % %"},{key:"open_2026",label:"2026 Open"},{key:"q1_budget",label:"Q1 Budget"},{key:"q2_budget",label:"Q2 Budget"},{key:"q3_budget",label:"Q3 Budget"},{key:"q4_budget",label:"Q4 Budget"},{key:"growth_percent",label:"Growth"}),r}function Pt(){const s=I(),d=z(!1),r=z(null),e=z([]),h=y(()=>e.value.reduce((n,l)=>n+l.total_sales,0)),i=y(()=>e.value.reduce((n,l)=>n+l.total_budget,0)),a=y(()=>h.value===0?0:(i.value-h.value)/h.value*100),c=y(()=>e.value.filter(n=>n.role&&n.role.toLowerCase().startsWith("hospitality"))),S=y(()=>e.value.filter(n=>!n.role||!n.role.toLowerCase().startsWith("hospitality")));function k(n){if(!n.length)return{q1_sales:0,q2_sales:0,q3_sales:0,q4_sales:0,q4_orders:0,total_sales:0,zero_perc_sales:0,zero_perc_sales_percent:0,open_2026:0,q1_budget:0,q2_budget:0,q3_budget:0,q4_budget:0,total_budget:0,growth_percent:0};const l=n.reduce((_,b)=>(_.q1_sales+=b.q1_sales,_.q2_sales+=b.q2_sales,_.q3_sales+=b.q3_sales,_.q4_sales+=b.q4_sales,_.q4_orders+=b.q4_orders,_.zero_perc_sales+=b.zero_perc_sales,_.open_2026+=b.open_2026,_.q1_budget+=b.q1_budget,_.q2_budget+=b.q2_budget,_.q3_budget+=b.q3_budget,_.q4_budget+=b.q4_budget,_),{q1_sales:0,q2_sales:0,q3_sales:0,q4_sales:0,q4_orders:0,zero_perc_sales:0,open_2026:0,q1_budget:0,q2_budget:0,q3_budget:0,q4_budget:0});return l.total_sales=l.q1_sales+l.q2_sales+l.q3_sales+l.q4_sales+l.q4_orders,l.total_budget=l.q1_budget+l.q2_budget+l.q3_budget+l.q4_budget,l.growth_percent=l.total_sales!==0?(l.total_budget-l.total_sales)/l.total_sales*100:0,l.zero_perc_sales_percent=l.total_sales?l.zero_perc_sales/l.total_sales*100:0,l}const $=y(()=>k(c.value)),F=y(()=>k(S.value));async function N(){d.value=!0,r.value=null;try{const n=await s.apiCall("/api/admin/summary");if(!n.ok)throw new Error("Failed to fetch admin summary");const l=await n.json();e.value=l.data||[]}catch(n){r.value=n.message,console.error(n)}finally{d.value=!1}}async function w(n){try{const l=await s.apiCall(`/api/sales/${n}`);if(!l.ok)throw new Error("Failed to fetch sales data");const _=await l.json(),b=await s.apiCall(`/api/budget/${n}`);if(!b.ok)throw new Error("Failed to fetch budget data");const C=await b.json(),q=e.value.find(g=>g.salesperson_id===n);return _.data.map(g=>{const u=C.data.find(Q=>Q.brand===g.brand&&Q.flag===g.flag&&Q.customer_name===g.customer_name),v=(parseFloat(g.q1_sales)||0)+(parseFloat(g.q2_sales)||0)+(parseFloat(g.q3_sales)||0)+(parseFloat(g.q4_sales)||0)+(parseFloat(g.q4_orders)||0),H=u?(parseFloat(u.quarter_1_sales)||0)+(parseFloat(u.quarter_2_sales)||0)+(parseFloat(u.quarter_3_sales)||0)+(parseFloat(u.quarter_4_sales)||0):0,M=v!==0&&!isNaN(v)&&!isNaN(H)?(H-v)/v*100:0;return{...g,salesperson_id:n,salesperson_name:q?.salesperson_name||"Unknown",role:q?.role||"Unknown",q1_budget:u?x(u.quarter_1_sales):"0.00",q2_budget:u?x(u.quarter_2_sales):"0.00",q3_budget:u?x(u.quarter_3_sales):"0.00",q4_budget:u?x(u.quarter_4_sales):"0.00",open_2026:x(g.open_2026),growth_percent:isNaN(M)?"0.00":M.toFixed(2)}})}catch(l){return console.error(l),[]}}async function D(n,l){const _=await w(n);if(!_.length)return alert("No data available");const C=e.value.find(u=>u.salesperson_id===n)?.role?.toLowerCase().startsWith("hospitality"),q=O(C),g=`${l.replace(/[^a-zA-Z0-9]/g,"_")}_budget_${new Date().toISOString().split("T")[0]}.csv`;T(_,q,g)}async function V(){if(!e.value.length)return alert("No data available");try{const n=d.value;d.value=!0;const l=[];for(const u of e.value){const v=await w(u.salesperson_id);l.push(...v)}if(!l.length){alert("No data available");return}const _=l.some(u=>u.role?.toLowerCase().startsWith("hospitality")),b=l.some(u=>!u.role?.toLowerCase().startsWith("hospitality")),q=O(_,_&&b),g=`full_budget_sheet_${new Date().toISOString().split("T")[0]}.csv`;T(l,q,g)}catch(n){console.error("Error downloading full budget sheet:",n),alert("Error downloading budget sheet. Please try again.")}finally{d.value=!1}}return{loading:d,error:r,summaryData:e,totalSales:h,totalBudget:i,totalGrowthPercent:a,hospitalityData:c,nonHospitalityData:S,hospitalitySubtotals:$,nonHospitalitySubtotals:F,fetchAdminSummary:N,downloadSalespersonData:D,downloadFullBudgetSheet:V}}const Wt={class:"p-6 space-y-6"},Zt={key:0},Xt={__name:"AdminView",setup(s){const d=W(),r=P("navActions"),{loading:e,error:h,summaryData:i,hospitalityData:a,nonHospitalityData:c,hospitalitySubtotals:S,nonHospitalitySubtotals:k,fetchAdminSummary:$,downloadSalespersonData:F,downloadFullBudgetSheet:N}=Pt();function w(D){d.push(`/salesperson/${D}`)}return G(()=>{$(),r.set([{id:"division-view",text:"Division View",class:"btn btn-secondary mr-2",handler:()=>d.push("/division"),icon:'<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>'},{id:"gross-profit-view",text:"Gross Profit View",class:"btn btn-accent mr-2",handler:()=>d.push("/gross-profit"),icon:'<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"/>'},{id:"download-full-budget",text:"Download Full Budget Sheet",class:"btn btn-primary",disabled:y(()=>e.value||!i.value.length),handler:N,icon:'<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>'}])}),Z(()=>r.clear()),(D,V)=>(p(),f("div",Wt,[A(J,{loading:m(e),error:m(h),onRetry:m($)},null,8,["loading","error","onRetry"]),!m(e)&&!m(h)?(p(),f("div",Zt,[A(nt,{"summary-data":m(i)},null,8,["summary-data"]),m(a).length?(p(),R(L,{key:0,data:m(a),subtotals:m(S),title:"Hospitality Salespeople",type:"hospitality",onViewSalesperson:w,onDownloadSalesperson:m(F)},null,8,["data","subtotals","onDownloadSalesperson"])):B("",!0),m(c).length?(p(),R(L,{key:1,data:m(c),subtotals:m(k),title:"Non-Hospitality Salespeople",type:"non-hospitality",onViewSalesperson:w,onDownloadSalesperson:m(F)},null,8,["data","subtotals","onDownloadSalesperson"])):B("",!0)])):B("",!0)]))}};export{Xt as default};
